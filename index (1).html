<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wajha Orders - ูุธุงู ุฅุฏุงุฑุฉ ุทูุจุงุช ุงููุนุงููุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in-right {
            animation: slideInRight 0.3s ease-out;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .bounce-in {
            animation: bounceIn 0.6s ease-out;
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .gradient-orange-red {
            background: linear-gradient(135deg, #f97316 0%, #dc2626 100%);
        }
        
        .gradient-green-blue {
            background: linear-gradient(135deg, #10b981 0%, #3b82f6 100%);
        }
        
        .star-rating {
            display: inline-flex;
            direction: ltr;
        }
        
        .star {
            font-size: 24px;
            color: #d1d5db;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .star.active {
            color: #fbbf24;
        }
        
        .star:hover {
            color: #fbbf24;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
            max-width: 400px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background-color: #10b981;
        }
        
        .notification.warning {
            background-color: #f59e0b;
        }
        
        .notification.error {
            background-color: #ef4444;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .tab-button {
            transition: all 0.3s ease;
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .approval-approved {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .approval-rejected {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        
        .approval-waiting {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }
        
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- ุงูููุฏุฑ ุงูุฑุฆูุณู -->
    <header class="bg-white shadow-lg border-b-4 border-blue-500">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <!-- ุงูุนููุงู ูุงูุดุนุงุฑ -->
                <div class="flex items-center space-x-4 space-x-reverse">
                    <div class="bg-blue-100 p-3 rounded-full">
                        <span class="text-3xl">๐ก</span>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold text-gray-800">Wajha Orders</h1>
                        <div class="flex items-center space-x-2 space-x-reverse mt-1">
                            <span class="bg-purple-500 text-white px-3 py-1 rounded-full text-sm font-semibold">ุงูุฅุตุฏุงุฑ 16</span>
                        </div>
                    </div>
                </div>
                
                <!-- ุงูุฃุฒุฑุงุฑ ุงููุธูููุฉ -->
                <div class="flex items-center space-x-4 space-x-reverse">
                    <button onclick="openGoogleSheets()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-all duration-300 flex items-center space-x-2 space-x-reverse">
                        <span>๐</span>
                        <span>ูุชุญ Google Sheets</span>
                    </button>
                    
                    <button onclick="loadFromGoogleSheets()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-all duration-300 flex items-center space-x-2 space-x-reverse">
                        <span>๐ฅ</span>
                        <span>ูุฑุงุกุฉ ุงูุจูุงูุงุช</span>
                    </button>
                    
                    <button id="exportBtn" onclick="exportData()" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg transition-all duration-300 flex items-center space-x-2 space-x-reverse hidden">
                        <span>๐ค</span>
                        <span>ุชุตุฏูุฑ ูู CSV</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- ุงูุชุจููุจุงุช ุงูุฑุฆูุณูุฉ -->
    <nav class="bg-white shadow-md sticky top-0 z-40">
        <div class="container mx-auto px-6">
            <div class="flex space-x-0 space-x-reverse">
                <button onclick="showTab('new-order')" class="tab-button active px-8 py-4 font-semibold rounded-t-lg">
                    ุทูุจ ูุนุงููุฉ ุฌุฏูุฏ
                </button>
                <button onclick="showTab('pending-orders')" class="tab-button px-8 py-4 font-semibold rounded-t-lg text-gray-600 hover:text-blue-600">
                    ุงูุทูุจุงุช ุงููุนููุฉ
                </button>
                <button onclick="showTab('completed-orders')" class="tab-button px-8 py-4 font-semibold rounded-t-lg text-gray-600 hover:text-blue-600">
                    ุงูุทูุจุงุช ุงูููุชููุฉ
                </button>
            </div>
        </div>
    </nav>

    <!-- ุงููุญุชูู ุงูุฑุฆูุณู -->
    <main class="container mx-auto px-6 py-8">
        <!-- ุชุจููุจ ุทูุจ ูุนุงููุฉ ุฌุฏูุฏ -->
        <div id="new-order" class="tab-content active">
            <!-- ูุณู ุงูุจุญุซ ุนู ุงูุนููู -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">ุงูุจุญุซ ุนู ุงูุนููู</h2>
                
                <div class="flex items-center space-x-4 space-x-reverse mb-4">
                    <input type="text" id="customerSearch" placeholder="ุงุจุญุซ ุจุฑูู ุงูุนููู ุฃู ุงุณู ุงูุนููู..." 
                           class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <button onclick="searchCustomer()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg transition-all duration-300">
                        ุจุญุซ
                    </button>
                </div>
                
                <div id="createNewOrderBtn" class="hidden mb-4">
                    <button onclick="showNewCustomerForm()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg transition-all duration-300">
                        ุฅูุดุงุก ุทูุจ ูุนุงููุฉ ุฌุฏูุฏ
                    </button>
                </div>
                
                <p class="text-gray-600 text-sm">๐ก ูุตูุญุฉ: ููููู ุงูุจุญุซ ุจุฑูู ุงูุนููู ุฃู ุงุณู ุงูุนููู</p>
            </div>

            <!-- ูุณู ุชุงุฑูุฎ ุงูุนููู -->
            <div id="customerHistory" class="bg-white rounded-xl shadow-lg p-6 mb-6 hidden">
                <h3 class="text-lg font-bold text-gray-800 mb-4">ุชุงุฑูุฎ ุงูุนููู</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">ุฑูู ุงููุนุงููุฉ</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">ุงูููุทูุฉ</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">ููุน ุงูุฎุฏูุฉ</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">ุชุงุฑูุฎ ุงููุนุงููุฉ</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">ุงูููุงููุฉ</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">ุงูุญุงูุฉ</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">ุงูุฅุฌุฑุงุกุงุช</th>
                            </tr>
                        </thead>
                        <tbody id="customerHistoryBody" class="bg-white divide-y divide-gray-200">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ูููุฐุฌ ุงูุนููู ุงูุฌุฏูุฏ -->
            <div id="newCustomerForm" class="bg-white rounded-xl shadow-lg p-6 hidden">
                <h3 class="text-xl font-bold text-gray-800 mb-6">ุฅูุดุงุก ุทูุจ ูุนุงููุฉ ุฌุฏูุฏ</h3>
                
                <form id="inspectionForm">
                    <!-- ูุนูููุงุช ุงูุนููู ุงูุฃุณุงุณูุฉ -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold text-gray-700 mb-4">ูุนูููุงุช ุงูุนููู ุงูุฃุณุงุณูุฉ</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">ุฑูู ุงูุนููู</label>
                                <input type="text" id="customerId" readonly class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100">
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">ุงูุงุณู <span class="text-red-500">*</span></label>
                                <input type="text" id="customerName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">ุฑูู ุงูุฌูุงู <span class="text-red-500">*</span></label>
                                <input type="tel" id="customerPhone" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                    </div>

                    <!-- ูุนูููุงุช ุงูุนููุงู -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold text-gray-700 mb-4">ูุนูููุงุช ุงูุนููุงู</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">ุงูููุทูุฉ <span class="text-red-500">*</span></label>
                                <select id="customerArea" required onchange="updateAddressPreview()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">ุงุฎุชุฑ ุงูููุทูุฉ</option>
                                    <option value="ุงููููุช">ุงููููุช</option>
                                    <option value="ุญููู">ุญููู</option>
                                    <option value="ุงููุฑูุงููุฉ">ุงููุฑูุงููุฉ</option>
                                    <option value="ูุจุงุฑู ุงููุจูุฑ">ูุจุงุฑู ุงููุจูุฑ</option>
                                    <option value="ุงูุฃุญูุฏู">ุงูุฃุญูุฏู</option>
                                    <option value="ุงูุฌูุฑุงุก">ุงูุฌูุฑุงุก</option>
                                    <option value="ุงูุณุงูููุฉ">ุงูุณุงูููุฉ</option>
                                    <option value="ุงูุฌุงุจุฑูุฉ">ุงูุฌุงุจุฑูุฉ</option>
                                    <option value="ุจูุงู">ุจูุงู</option>
                                    <option value="ูุดุฑู">ูุดุฑู</option>
                                    <option value="ุงูุฑููุซูุฉ">ุงูุฑููุซูุฉ</option>
                                    <option value="ุงูุดุนุจ">ุงูุดุนุจ</option>
                                    <option value="ุงูุฏุนูุฉ">ุงูุฏุนูุฉ</option>
                                    <option value="ุงูุฏุณูุฉ">ุงูุฏุณูุฉ</option>
                                    <option value="ุงูุดุฑู">ุงูุดุฑู</option>
                                    <option value="ุงููุฑูุงุจ">ุงููุฑูุงุจ</option>
                                    <option value="ุงูุตูุงุจุฑ">ุงูุตูุงุจุฑ</option>
                                    <option value="ุงูููุญุงุก">ุงูููุญุงุก</option>
                                    <option value="ุงูุนุฏูููุฉ">ุงูุนุฏูููุฉ</option>
                                    <option value="ูุฑุทุจุฉ">ูุฑุทุจุฉ</option>
                                    <option value="ุงููุฑููู">ุงููุฑููู</option>
                                    <option value="ุงูุฎุงูุฏูุฉ">ุงูุฎุงูุฏูุฉ</option>
                                    <option value="ุงููุฒูุฉ">ุงููุฒูุฉ</option>
                                    <option value="ุงูุฑูุถุฉ">ุงูุฑูุถุฉ</option>
                                    <option value="ุงูุนุฏุงู">ุงูุนุฏุงู</option>
                                    <option value="ุงูููุจููุฉ">ุงูููุจููุฉ</option>
                                    <option value="ุงูููุทุงุณ">ุงูููุทุงุณ</option>
                                    <option value="ุฃุจู ุญูููุฉ">ุฃุจู ุญูููุฉ</option>
                                    <option value="ุงููุญูุญูู">ุงููุญูุญูู</option>
                                    <option value="ุงููููู">ุงููููู</option>
                                    <option value="ุงูุฃุญูุฏู">ุงูุฃุญูุฏู</option>
                                    <option value="ุงูุฑูุฉ">ุงูุฑูุฉ</option>
                                    <option value="ุงูุตุจุงุญูุฉ">ุงูุตุจุงุญูุฉ</option>
                                    <option value="ุงูุฎูุฑุงู">ุงูุฎูุฑุงู</option>
                                    <option value="ุงูููุฑุฉ">ุงูููุฑุฉ</option>
                                    <option value="ุงูุฒูุฑ">ุงูุฒูุฑ</option>
                                    <option value="ูุจุฏ">ูุจุฏ</option>
                                    <option value="ุงูุฌููุจ">ุงูุฌููุจ</option>
                                    <option value="ุงูุฑู">ุงูุฑู</option>
                                    <option value="ุงูุถุฌูุฌ">ุงูุถุฌูุฌ</option>
                                    <option value="ุงูุฑุงุจูุฉ">ุงูุฑุงุจูุฉ</option>
                                    <option value="ุฅุดุจูููุฉ">ุฅุดุจูููุฉ</option>
                                    <option value="ุงูุฃูุฏูุณ">ุงูุฃูุฏูุณ</option>
                                    <option value="ุงููุฑุฏูุณ">ุงููุฑุฏูุณ</option>
                                    <option value="ุฌููุจ ุงูุดููุฎ">ุฌููุจ ุงูุดููุฎ</option>
                                    <option value="ุงูุฑุญุงุจ">ุงูุฑุญุงุจ</option>
                                    <option value="ุงูุนุงุฑุถูุฉ">ุงูุนุงุฑุถูุฉ</option>
                                    <option value="ุงูุถุงุญูุฉ">ุงูุถุงุญูุฉ</option>
                                    <option value="ุงูุดุฏุงุฏูุฉ">ุงูุดุฏุงุฏูุฉ</option>
                                    <option value="ุงูุตููุจูุฉ">ุงูุตููุจูุฉ</option>
                                    <option value="ุงููุนูู">ุงููุนูู</option>
                                    <option value="ุงููุงุญุฉ">ุงููุงุญุฉ</option>
                                    <option value="ุชููุงุก">ุชููุงุก</option>
                                    <option value="ุงูุตููุจูุฎุงุช">ุงูุตููุจูุฎุงุช</option>
                                    <option value="ุงูุฏูุญุฉ">ุงูุฏูุญุฉ</option>
                                    <option value="ุงูููุฑูุงู">ุงูููุฑูุงู</option>
                                    <option value="ุงููุงุฏุณูุฉ">ุงููุงุฏุณูุฉ</option>
                                    <option value="ุงูุณุฑุฉ">ุงูุณุฑุฉ</option>
                                    <option value="ุงูุฒูุฑุงุก">ุงูุฒูุฑุงุก</option>
                                    <option value="ุงูุดุงููุฉ">ุงูุดุงููุฉ</option>
                                    <option value="ุงูุดููุฎ">ุงูุดููุฎ</option>
                                    <option value="ุงูุตุงูุญูุฉ">ุงูุตุงูุญูุฉ</option>
                                    <option value="ุบุฑูุงุทุฉ">ุบุฑูุงุทุฉ</option>
                                    <option value="ุงูููุตููุฉ">ุงูููุตููุฉ</option>
                                    <option value="ุงูููุถุฉ">ุงูููุถุฉ</option>
                                    <option value="ุงููุทูุฉ">ุงููุทูุฉ</option>
                                    <option value="ุงูุนูุฑูุฉ">ุงูุนูุฑูุฉ</option>
                                    <option value="ุงูุฌุงุจุฑูุฉ">ุงูุฌุงุจุฑูุฉ</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">ุงููุทุนุฉ</label>
                                <input type="text" id="customerBlock" onchange="updateAddressPreview()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">ุงูุฌุงุฏุฉ</label>
                                <input type="text" id="customerAvenue" onchange="updateAddressPreview()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">ุงูุดุงุฑุน</label>
                                <input type="text" id="customerStreet" onchange="updateAddressPreview()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">ุฑูู ุงูููุฒู</label>
                                <input type="text" id="customerHouseNumber" onchange="updateAddressPreview()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        
                        <!-- ูุฑุงุฌุนุฉ ุงูุนููุงู -->
                        <div id="addressPreview" class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg hidden">
                            <h5 class="font-semibold text-blue-800 mb-2">ูุฑุงุฌุนุฉ ุงูุนููุงู:</h5>
                            <p id="fullAddress" class="text-blue-700"></p>
                        </div>
                    </div>

                    <!-- ุชูุงุตูู ุงูุฎุฏูุฉ ุงููุทููุจุฉ -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold text-gray-700 mb-4">ุชูุงุตูู ุงูุฎุฏูุฉ ุงููุทููุจุฉ</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">ููุน ุงูุฎุฏูุฉ <span class="text-red-500">*</span></label>
                                <select id="serviceType" required onchange="toggleOtherService()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">ุงุฎุชุฑ ููุน ุงูุฎุฏูุฉ</option>
                                    <option value="ุชูุธูู ุนุงู">ุชูุธูู ุนุงู</option>
                                    <option value="ุชูุธูู ุนููู">ุชูุธูู ุนููู</option>
                                    <option value="ุชูุธูู ุจุนุฏ ุงูุฏูุงู">ุชูุธูู ุจุนุฏ ุงูุฏูุงู</option>
                                    <option value="ุชูุธูู ุงููุทุจุฎ">ุชูุธูู ุงููุทุจุฎ</option>
                                    <option value="ุชูุธูู ุงูุญูุงูุงุช">ุชูุธูู ุงูุญูุงูุงุช</option>
                                    <option value="ุชูุธูู ุงูููุงูุฐ">ุชูุธูู ุงูููุงูุฐ</option>
                                    <option value="ุชูุธูู ุงูุณุฌุงุฏ ูุงูููููุช">ุชูุธูู ุงูุณุฌุงุฏ ูุงูููููุช</option>
                                    <option value="ุชูุธูู ุงูุฃุซุงุซ">ุชูุธูู ุงูุฃุซุงุซ</option>
                                    <option value="ุฃุฎุฑู">ุฃุฎุฑู</option>
                                </select>
                            </div>
                            <div id="otherServiceDiv" class="hidden">
                                <label class="block text-gray-700 text-sm font-bold mb-2">ุชุญุฏูุฏ ููุน ุงูุฎุฏูุฉ ุงูุฃุฎุฑู</label>
                                <input type="text" id="otherService" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">ููุน ุงูุณูู <span class="text-red-500">*</span></label>
                                <select id="propertyType" required onchange="toggleOtherProperty()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">ุงุฎุชุฑ ููุน ุงูุณูู</option>
                                    <option value="ุดูุฉ">ุดูุฉ</option>
                                    <option value="ูููุง">ูููุง</option>
                                    <option value="ุฏูุจููุณ">ุฏูุจููุณ</option>
                                    <option value="ุงุณุชูุฏูู">ุงุณุชูุฏูู</option>
                                    <option value="ุจูุช ุดุนุจู">ุจูุช ุดุนุจู</option>
                                    <option value="ุฃุฎุฑู">ุฃุฎุฑู</option>
                                </select>
                            </div>
                            <div id="otherPropertyDiv" class="hidden">
                                <label class="block text-gray-700 text-sm font-bold mb-2">ุชุญุฏูุฏ ููุน ุงูุณูู ุงูุขุฎุฑ</label>
                                <input type="text" id="otherProperty" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">ุชุงุฑูุฎ ุงููุนุงููุฉ ุงูููุถู <span class="text-red-500">*</span></label>
                                <input type="date" id="inspectionDate" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">ููุช ุงููุนุงููุฉ ุงูููุถู</label>
                                <select id="inspectionTime" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="ุตุจุงุญุงู (8-12)">ุตุจุงุญุงู (8-12)</option>
                                    <option value="ุธูุฑุงู (12-4)">ุธูุฑุงู (12-4)</option>
                                    <option value="ูุณุงุกู (4-8)">ูุณุงุกู (4-8)</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">ููุงุญุธุงุช ุฅุถุงููุฉ</label>
                            <textarea id="additionalNotes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>
                    </div>

                    <!-- ููุงููุฉ ุงูุนููู ุนูู ุงูุฎุฏูุฉ -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold text-gray-700 mb-4">ููุงููุฉ ุงูุนููู ุนูู ุงูุฎุฏูุฉ</h4>
                        <div class="flex space-x-6 space-x-reverse">
                            <label class="flex items-center">
                                <input type="radio" name="approval" value="ููุงูู" onchange="toggleApprovalSections()" class="ml-2">
                                <span class="px-3 py-1 bg-green-500 text-white rounded-full text-sm">ููุงูู</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="approval" value="ุบูุฑ ููุงูู" onchange="toggleApprovalSections()" class="ml-2">
                                <span class="px-3 py-1 bg-red-500 text-white rounded-full text-sm">ุบูุฑ ููุงูู</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="approval" value="ูู ุงูุงูุชุธุงุฑ" checked onchange="toggleApprovalSections()" class="ml-2">
                                <span class="px-3 py-1 bg-blue-500 text-white rounded-full text-sm">ูู ุงูุงูุชุธุงุฑ</span>
                            </label>
                        </div>
                    </div>

                    <!-- ุฃุณุจุงุจ ุงูุฅูุบุงุก -->
                    <div id="rejectionReasons" class="mb-8 hidden">
                        <h4 class="text-lg font-semibold text-gray-700 mb-4">ุฃุณุจุงุจ ุงูุฅูุบุงุก</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">ุณุจุจ ุงูุฅูุบุงุก</label>
                                <select id="rejectionReason" onchange="toggleOtherRejectionReason()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">ุงุฎุชุฑ ุณุจุจ ุงูุฅูุบุงุก</option>
                                    <option value="ุงูุณุนุฑ ูุฑุชูุน">ุงูุณุนุฑ ูุฑุชูุน</option>
                                    <option value="ุชุบููุฑ ูู ุงูุฎุทุท">ุชุบููุฑ ูู ุงูุฎุทุท</option>
                                    <option value="ูุฌุฏ ุฎุฏูุฉ ุฃุฎุฑู">ูุฌุฏ ุฎุฏูุฉ ุฃุฎุฑู</option>
                                    <option value="ุนุฏู ุชููุฑ ุงูููุช">ุนุฏู ุชููุฑ ุงูููุช</option>
                                    <option value="ุนุฏู ุงูุญุงุฌุฉ ููุฎุฏูุฉ">ุนุฏู ุงูุญุงุฌุฉ ููุฎุฏูุฉ</option>
                                    <option value="ูุดููุฉ ูู ุงูุชูุงุตู">ูุดููุฉ ูู ุงูุชูุงุตู</option>
                                    <option value="ุฃุฎุฑู">ุฃุฎุฑู</option>
                                </select>
                            </div>
                            <div id="otherRejectionDiv" class="hidden">
                                <label class="block text-gray-700 text-sm font-bold mb-2">ุชุญุฏูุฏ ุงูุณุจุจ ุงูุขุฎุฑ</label>
                                <input type="text" id="otherRejectionReason" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">ุชูุงุตูู ุฅุถุงููุฉ ุญูู ุณุจุจ ุงูุฅูุบุงุก</label>
                            <textarea id="rejectionDetails" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="ุงูุชุจ ุชูุงุตูู ุฅุถุงููุฉ ุญูู ุณุจุจ ุงูุฅูุบุงุก..."></textarea>
                        </div>
                    </div>

                    <!-- ูุนูููุงุช ุงูุฏูุน -->
                    <div id="paymentInfo" class="mb-8 hidden">
                        <h4 class="text-lg font-semibold text-gray-700 mb-4">ูุนูููุงุช ุงูุฏูุน</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">ุงููุจูุบ ุงูููู (ุฏ.ู)</label>
                                <input type="number" id="totalAmount" step="0.001" onchange="calculateDiscount()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">ูุณุจุฉ ุงูุฎุตู (%)</label>
                                <input type="number" id="discountPercent" step="0.1" onchange="calculateDiscount()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">ุงููุจูุบ ุจุนุฏ ุงูุฎุตู (ุฏ.ู)</label>
                                <input type="number" id="finalAmount" step="0.001" readonly class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100">
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">ุชุงุฑูุฎ ุชูููุฐ ุงูุฎุฏูุฉ</label>
                                <input type="date" id="serviceDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        <div class="mt-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">ุญุงูุฉ ุงูุฏูุน</label>
                            <select id="paymentStatus" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="ูู ุงูุงูุชุธุงุฑ">ูู ุงูุงูุชุธุงุฑ</option>
                                <option value="ูุฏููุน">ูุฏููุน</option>
                                <option value="ูุฏููุน ุฌุฒุฆูุงู">ูุฏููุน ุฌุฒุฆูุงู</option>
                            </select>
                        </div>
                    </div>

                    <!-- ุชูููู ุฑุถุง ุงูุนููู -->
                    <div id="customerRating" class="mb-8 hidden">
                        <h4 class="text-lg font-semibold text-gray-700 mb-4">ุชูููู ุฑุถุง ุงูุนููู</h4>
                        <div class="mb-4">
                            <div class="star-rating" id="starRating">
                                <span class="star" data-rating="1">โ</span>
                                <span class="star" data-rating="2">โ</span>
                                <span class="star" data-rating="3">โ</span>
                                <span class="star" data-rating="4">โ</span>
                                <span class="star" data-rating="5">โ</span>
                            </div>
                            <p id="ratingText" class="text-gray-600 mt-2">ุงุฎุชุฑ ุงูุชูููู</p>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">ููุงุญุธุฉ ุญูู ุณุจุจ ุงูุชูููู</label>
                            <textarea id="ratingNotes" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>
                    </div>

                    <!-- ููุงุญุธุงุช ุฅุถุงููุฉ -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold text-gray-700 mb-4">ููุงุญุธุงุช ุฅุถุงููุฉ</h4>
                        <textarea id="inspectorNotes" rows="3" placeholder="ููุงุญุธุงุช ุฅุถุงููุฉ ูู ุงูููุชุด..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>

                    <!-- ุฃุฒุฑุงุฑ ุงูุญูุธ -->
                    <div class="flex justify-end space-x-4 space-x-reverse">
                        <button type="button" onclick="resetForm()" class="px-6 py-3 text-gray-600 hover:text-gray-800 transition-colors">
                            ุฅุนุงุฏุฉ ุชุนููู
                        </button>
                        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-lg transition-all duration-300 flex items-center space-x-2 space-x-reverse">
                            <span>ุญูุธ ุงูุทูุจ</span>
                            <div id="saveSpinner" class="loading-spinner hidden"></div>
                        </button>
                    </div>
                </form>
            </div>

            <!-- ูููุฐุฌ ุงูุนููู ุงูููุฌูุฏ -->
            <div id="existingCustomerForm" class="bg-white rounded-xl shadow-lg p-6 hidden">
                <h3 class="text-xl font-bold text-gray-800 mb-6">ุฅุถุงูุฉ ุทูุจ ูุนุงููุฉ ูุนููู ููุฌูุฏ</h3>
                
                <!-- ูุนูููุงุช ุงูุนููู ุงูููุฌูุฏ -->
                <div id="existingCustomerInfo" class="mb-6 p-4 bg-gray-100 rounded-lg">
                    <!-- ุณูุชู ููุคูุง ุฏููุงููููุงู -->
                </div>
                
                <!-- ุจุงูู ุงููููุฐุฌ ูุทุงุจู ููุนููู ุงูุฌุฏูุฏ (ุจุฏูู ูุนูููุงุช ุงูุนููู ุงูุฃุณุงุณูุฉ) -->
                <!-- ูููู ูุณุฎ ุงูุฃูุณุงู ูู ุงููููุฐุฌ ุงูุณุงุจู -->
            </div>
        </div>

        <!-- ุชุจููุจ ุงูุทูุจุงุช ุงููุนููุฉ -->
        <div id="pending-orders" class="tab-content">
            <div class="gradient-orange-red rounded-xl shadow-lg p-6 text-white">
                <h2 class="text-2xl font-bold mb-6">ุงูุทูุจุงุช ุงููุนููุฉ</h2>
                
                <div class="bg-white bg-opacity-10 rounded-lg overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-black bg-opacity-20">
                                <tr>
                                    <th class="px-6 py-3 text-right text-sm font-medium text-white uppercase">ุฑูู ุงููุนุงููุฉ</th>
                                    <th class="px-6 py-3 text-right text-sm font-medium text-white uppercase">ุงุณู ุงูุนููู</th>
                                    <th class="px-6 py-3 text-right text-sm font-medium text-white uppercase">ุงูููุทูุฉ</th>
                                    <th class="px-6 py-3 text-right text-sm font-medium text-white uppercase">ููุน ุงูุฎุฏูุฉ</th>
                                    <th class="px-6 py-3 text-right text-sm font-medium text-white uppercase">ุชุงุฑูุฎ ุงููุนุงููุฉ</th>
                                    <th class="px-6 py-3 text-right text-sm font-medium text-white uppercase">ุงูููุงููุฉ</th>
                                    <th class="px-6 py-3 text-right text-sm font-medium text-white uppercase">ุงูุฅุฌุฑุงุกุงุช</th>
                                </tr>
                            </thead>
                            <tbody id="pendingOrdersBody" class="divide-y divide-white divide-opacity-20">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- ุชุจููุจ ุงูุทูุจุงุช ุงูููุชููุฉ -->
        <div id="completed-orders" class="tab-content">
            <div class="gradient-green-blue rounded-xl shadow-lg p-6 text-white">
                <h2 class="text-2xl font-bold mb-6">ุงูุทูุจุงุช ุงูููุชููุฉ</h2>
                
                <div class="bg-white bg-opacity-10 rounded-lg overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-black bg-opacity-20">
                                <tr>
                                    <th class="px-6 py-3 text-right text-sm font-medium text-white uppercase">ุฑูู ุงููุนุงููุฉ</th>
                                    <th class="px-6 py-3 text-right text-sm font-medium text-white uppercase">ุงุณู ุงูุนููู</th>
                                    <th class="px-6 py-3 text-right text-sm font-medium text-white uppercase">ุงูููุทูุฉ</th>
                                    <th class="px-6 py-3 text-right text-sm font-medium text-white uppercase">ููุน ุงูุฎุฏูุฉ</th>
                                    <th class="px-6 py-3 text-right text-sm font-medium text-white uppercase">ุชุงุฑูุฎ ุงููุนุงููุฉ</th>
                                    <th class="px-6 py-3 text-right text-sm font-medium text-white uppercase">ุงูููุงููุฉ</th>
                                    <th class="px-6 py-3 text-right text-sm font-medium text-white uppercase">ุงูุชูููู</th>
                                    <th class="px-6 py-3 text-right text-sm font-medium text-white uppercase">ุงูุฅุฌุฑุงุกุงุช</th>
                                </tr>
                            </thead>
                            <tbody id="completedOrdersBody" class="divide-y divide-white divide-opacity-20">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- ุงููุงูุฐุฉ ุงูููุจุซูุฉ ูุชูุงุตูู ุงููุนุงููุฉ -->
    <div id="inspectionModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-4xl w-full mx-4 max-h-screen overflow-y-auto bounce-in">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">ุชูุงุตูู ุงููุนุงููุฉ</h3>
                <button onclick="closeInspectionModal()" class="text-gray-500 hover:text-gray-700 text-2xl">ร</button>
            </div>
            
            <div id="inspectionDetails">
                <!-- ุณูุชู ููุก ุงููุญุชูู ุฏููุงููููุงู -->
            </div>
        </div>
    </div>

    <!-- ุงููุงูุฐุฉ ุงูููุจุซูุฉ ูุชุนุฏูู ุงููุนุงููุฉ -->
    <div id="editInspectionModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-4xl w-full mx-4 max-h-screen overflow-y-auto bounce-in">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">ุชุนุฏูู ุงููุนุงููุฉ</h3>
                <button onclick="closeEditInspectionModal()" class="text-gray-500 hover:text-gray-700 text-2xl">ร</button>
            </div>
            
            <form id="editInspectionForm">
                <div id="editInspectionContent">
                    <!-- ุณูุชู ููุก ุงููุญุชูู ุฏููุงููููุงู -->
                </div>
                
                <div class="flex justify-end space-x-4 space-x-reverse mt-6">
                    <button type="button" onclick="closeEditInspectionModal()" class="px-6 py-3 text-gray-600 hover:text-gray-800 transition-colors">
                        ุฅูุบุงุก
                    </button>
                    <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-3 rounded-lg transition-all duration-300">
                        ุญูุธ ุงูุชุนุฏููุงุช
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ูุชุบูุฑุงุช ุงููุธุงู
        let customers = {};
        let inspections = [];
        let inspectionCounter = 1000;
        let currentRating = 0;
        let isExistingCustomer = false;
        let currentCustomerId = null;

        // Google Sheets Configuration
        const GOOGLE_SHEETS_URL = 'https://docs.google.com/spreadsheets/d/14kbGPoC4ld3tkDAuVWGO36FjNtRvY0xKBXc_y0vUkZI/edit';
        const GOOGLE_SHEETS_ID = '14kbGPoC4ld3tkDAuVWGO36FjNtRvY0xKBXc_y0vUkZI';

        // ุชููุฆุฉ ุงููุธุงู
        document.addEventListener('DOMContentLoaded', function() {
            loadLocalData();
            generateCustomerId();
            setupEventListeners();
            setMinDate();
            updateTables();
            
            showNotification('ูุฑุญุจุงู ุจู ูู ูุธุงู Wajha Orders! ๐ก', 'success');
        });

        // ุชุญููู ุงูุจูุงูุงุช ุงููุญููุฉ
        function loadLocalData() {
            const savedCustomers = localStorage.getItem('customers');
            const savedInspections = localStorage.getItem('inspections');
            const savedCounter = localStorage.getItem('inspectionCounter');
            
            if (savedCustomers) {
                customers = JSON.parse(savedCustomers);
            }
            
            if (savedInspections) {
                inspections = JSON.parse(savedInspections);
            }
            
            if (savedCounter) {
                inspectionCounter = parseInt(savedCounter);
            }
        }

        // ุญูุธ ุงูุจูุงูุงุช ูุญููุงู
        function saveLocalData() {
            localStorage.setItem('customers', JSON.stringify(customers));
            localStorage.setItem('inspections', JSON.stringify(inspections));
            localStorage.setItem('inspectionCounter', inspectionCounter.toString());
        }

        // ุฅุนุฏุงุฏ ูุณุชูุนู ุงูุฃุญุฏุงุซ
        function setupEventListeners() {
            // ูุธุงู ุงูุชูููู ุจุงููุฌูู
            document.querySelectorAll('.star').forEach(star => {
                star.addEventListener('click', function() {
                    const rating = parseInt(this.dataset.rating);
                    setRating(rating);
                });
                
                star.addEventListener('mouseover', function() {
                    const rating = parseInt(this.dataset.rating);
                    highlightStars(rating);
                });
            });
            
            document.getElementById('starRating').addEventListener('mouseleave', function() {
                highlightStars(currentRating);
            });

            // ูููุฐุฌ ุงูุฅุฑุณุงู
            document.getElementById('inspectionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveInspection();
            });

            // ุงูุจุญุซ ุนู ุงูุนููู
            document.getElementById('customerSearch').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchCustomer();
                }
            });

            // ุงุฎุชุตุงุฑ Ctrl+Q ูุฅุธูุงุฑ/ุฅุฎูุงุก ุฒุฑ ุงูุชุตุฏูุฑ
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'q') {
                    e.preventDefault();
                    const exportBtn = document.getElementById('exportBtn');
                    exportBtn.classList.toggle('hidden');
                    if (!exportBtn.classList.contains('hidden')) {
                        showNotification('ุชู ุฅุธูุงุฑ ุฒุฑ ุงูุชุตุฏูุฑ! ๐ค', 'success');
                    }
                }
            });
        }

        // ุชุนููู ุงูุญุฏ ุงูุฃุฏูู ููุชุงุฑูุฎ (ุงูููู)
        function setMinDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('inspectionDate').min = today;
            if (document.getElementById('serviceDate')) {
                document.getElementById('serviceDate').min = today;
            }
        }

        // ุฅุธูุงุฑ ุงูุชุจููุจ
        function showTab(tabName) {
            // ุฅุฎูุงุก ุฌููุน ุงูุชุจููุจุงุช
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ุฅุฒุงูุฉ ุงููุฆุฉ ุงููุดุทุฉ ูู ุฌููุน ุงูุฃุฒุฑุงุฑ
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('text-gray-600', 'hover:text-blue-600');
            });
            
            // ุฅุธูุงุฑ ุงูุชุจููุจ ุงููุญุฏุฏ
            document.getElementById(tabName).classList.add('active');
            
            // ุชูุนูู ุงูุฒุฑ ุงููุญุฏุฏ
            event.target.classList.add('active');
            event.target.classList.remove('text-gray-600', 'hover:text-blue-600');
            
            // ุชุญุฏูุซ ุงูุฌุฏุงูู ุญุณุจ ุงูุชุจููุจ
            if (tabName === 'pending-orders') {
                updatePendingOrdersTable();
            } else if (tabName === 'completed-orders') {
                updateCompletedOrdersTable();
            }
        }

        // ุงูุจุญุซ ุนู ุงูุนููู
        function searchCustomer() {
            const searchTerm = document.getElementById('customerSearch').value.trim();
            
            if (!searchTerm) {
                showNotification('ูุฑุฌู ุฅุฏุฎุงู ุฑูู ุงูุนููู ุฃู ุงุณู ุงูุนููู ููุจุญุซ', 'warning');
                return;
            }
            
            // ุงูุจุญุซ ูู ุงูุนููุงุก ุงูููุฌูุฏูู
            const foundCustomer = Object.values(customers).find(customer => 
                customer.id.includes(searchTerm) || 
                customer.name.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            if (foundCustomer) {
                // ุนููู ููุฌูุฏ
                showExistingCustomerHistory(foundCustomer);
                document.getElementById('createNewOrderBtn').classList.remove('hidden');
                isExistingCustomer = true;
                currentCustomerId = foundCustomer.id;
            } else {
                // ุนููู ุฌุฏูุฏ
                document.getElementById('customerHistory').classList.add('hidden');
                document.getElementById('createNewOrderBtn').classList.remove('hidden');
                isExistingCustomer = false;
                currentCustomerId = null;
                
                // ููุก ุญูู ุงูุจุญุซ ูู ุงููููุฐุฌ ุฅุฐุง ูุงู ุงุณูุงู
                if (isNaN(searchTerm)) {
                    document.getElementById('customerName').value = searchTerm;
                }
            }
        }

        // ุฅุธูุงุฑ ุชุงุฑูุฎ ุงูุนููู ุงูููุฌูุฏ
        function showExistingCustomerHistory(customer) {
            const customerInspections = inspections.filter(inspection => 
                inspection.customerId === customer.id
            );
            
            const historyBody = document.getElementById('customerHistoryBody');
            historyBody.innerHTML = '';
            
            customerInspections.forEach(inspection => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                const approvalClass = getApprovalClass(inspection.approval);
                
                row.innerHTML = `
                    <td class="px-6 py-4 text-sm font-medium text-orange-600">${inspection.id}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">${inspection.area}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">${inspection.serviceType}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">${formatDate(inspection.inspectionDate)}</td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${approvalClass}">${inspection.approval}</span>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900">${inspection.status}</td>
                    <td class="px-6 py-4">
                        <button onclick="showInspectionDetails('${inspection.id}')" class="text-blue-600 hover:text-blue-900 text-sm">ุนุฑุถ ุงูุชูุงุตูู</button>
                    </td>
                `;
                
                historyBody.appendChild(row);
            });
            
            document.getElementById('customerHistory').classList.remove('hidden');
        }

        // ุฅุธูุงุฑ ูููุฐุฌ ุงูุนููู ุงูุฌุฏูุฏ
        function showNewCustomerForm() {
            if (isExistingCustomer && currentCustomerId) {
                showExistingCustomerForm();
            } else {
                document.getElementById('newCustomerForm').classList.remove('hidden');
                generateCustomerId();
            }
        }

        // ุฅุธูุงุฑ ูููุฐุฌ ุงูุนููู ุงูููุฌูุฏ
        function showExistingCustomerForm() {
            const customer = customers[currentCustomerId];
            
            // ููุก ูุนูููุงุช ุงูุนููู ุงูููุฌูุฏ
            const customerInfo = document.getElementById('existingCustomerInfo');
            customerInfo.innerHTML = `
                <h4 class="font-semibold text-gray-800 mb-2">ูุนูููุงุช ุงูุนููู</h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <span class="text-sm text-gray-600">ุฑูู ุงูุนููู:</span>
                        <p class="font-medium">${customer.id}</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-600">ุงูุงุณู:</span>
                        <p class="font-medium">${customer.name}</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-600">ุงูุฌูุงู:</span>
                        <p class="font-medium">${customer.phone}</p>
                    </div>
                </div>
            `;
            
            document.getElementById('existingCustomerForm').classList.remove('hidden');
        }

        // ุชูููุฏ ุฑูู ุนููู ุฌุฏูุฏ
        function generateCustomerId() {
            const customerId = 'CUST-' + Date.now();
            document.getElementById('customerId').value = customerId;
        }

        // ุชุญุฏูุซ ูุนุงููุฉ ุงูุนููุงู
        function updateAddressPreview() {
            const area = document.getElementById('customerArea').value;
            const block = document.getElementById('customerBlock').value;
            const avenue = document.getElementById('customerAvenue').value;
            const street = document.getElementById('customerStreet').value;
            const houseNumber = document.getElementById('customerHouseNumber').value;
            
            if (area) {
                let address = area;
                if (block) address += ` - ูุทุนุฉ ${block}`;
                if (avenue) address += ` - ุฌุงุฏุฉ ${avenue}`;
                if (street) address += ` - ุดุงุฑุน ${street}`;
                if (houseNumber) address += ` - ููุฒู ${houseNumber}`;
                
                document.getElementById('fullAddress').textContent = address;
                document.getElementById('addressPreview').classList.remove('hidden');
            } else {
                document.getElementById('addressPreview').classList.add('hidden');
            }
        }

        // ุชุจุฏูู ุญูู ุงูุฎุฏูุฉ ุงูุฃุฎุฑู
        function toggleOtherService() {
            const serviceType = document.getElementById('serviceType').value;
            const otherDiv = document.getElementById('otherServiceDiv');
            
            if (serviceType === 'ุฃุฎุฑู') {
                otherDiv.classList.remove('hidden');
                document.getElementById('otherService').required = true;
            } else {
                otherDiv.classList.add('hidden');
                document.getElementById('otherService').required = false;
            }
        }

        // ุชุจุฏูู ุญูู ููุน ุงูุณูู ุงูุขุฎุฑ
        function toggleOtherProperty() {
            const propertyType = document.getElementById('propertyType').value;
            const otherDiv = document.getElementById('otherPropertyDiv');
            
            if (propertyType === 'ุฃุฎุฑู') {
                otherDiv.classList.remove('hidden');
                document.getElementById('otherProperty').required = true;
            } else {
                otherDiv.classList.add('hidden');
                document.getElementById('otherProperty').required = false;
            }
        }

        // ุชุจุฏูู ุงูุฃูุณุงู ุญุณุจ ุงูููุงููุฉ
        function toggleApprovalSections() {
            const approval = document.querySelector('input[name="approval"]:checked').value;
            const paymentInfo = document.getElementById('paymentInfo');
            const rejectionReasons = document.getElementById('rejectionReasons');
            const customerRating = document.getElementById('customerRating');
            
            // ุฅุฎูุงุก ุฌููุน ุงูุฃูุณุงู ุฃููุงู
            paymentInfo.classList.add('hidden');
            rejectionReasons.classList.add('hidden');
            customerRating.classList.add('hidden');
            
            if (approval === 'ููุงูู') {
                paymentInfo.classList.remove('hidden');
                customerRating.classList.remove('hidden');
            } else if (approval === 'ุบูุฑ ููุงูู') {
                rejectionReasons.classList.remove('hidden');
            }
        }

        // ุชุจุฏูู ุญูู ุงูุณุจุจ ุงูุขุฎุฑ ููุฅูุบุงุก
        function toggleOtherRejectionReason() {
            const rejectionReason = document.getElementById('rejectionReason').value;
            const otherDiv = document.getElementById('otherRejectionDiv');
            
            if (rejectionReason === 'ุฃุฎุฑู') {
                otherDiv.classList.remove('hidden');
                document.getElementById('otherRejectionReason').required = true;
            } else {
                otherDiv.classList.add('hidden');
                document.getElementById('otherRejectionReason').required = false;
            }
        }

        // ุญุณุงุจ ุงูุฎุตู
        function calculateDiscount() {
            const totalAmount = parseFloat(document.getElementById('totalAmount').value) || 0;
            const discountPercent = parseFloat(document.getElementById('discountPercent').value) || 0;
            
            const discountAmount = totalAmount * (discountPercent / 100);
            const finalAmount = totalAmount - discountAmount;
            
            document.getElementById('finalAmount').value = finalAmount.toFixed(3);
        }

        // ุชุนููู ุงูุชูููู
        function setRating(rating) {
            currentRating = rating;
            highlightStars(rating);
            updateRatingText(rating);
        }

        // ุชูููุฒ ุงููุฌูู
        function highlightStars(rating) {
            document.querySelectorAll('.star').forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        // ุชุญุฏูุซ ูุต ุงูุชูููู
        function updateRatingText(rating) {
            const texts = {
                1: 'ุบูุฑ ุฑุงุถู ุชูุงูุงู',
                2: 'ุบูุฑ ุฑุงุถู',
                3: 'ุฑุงุถู ุฅูู ุญุฏ ูุง',
                4: 'ุฑุงุถู',
                5: 'ุฑุงุถู ุฌุฏุงู'
            };
            
            document.getElementById('ratingText').textContent = texts[rating] || 'ุงุฎุชุฑ ุงูุชูููู';
        }

        // ุญูุธ ุงููุนุงููุฉ
        async function saveInspection() {
            const spinner = document.getElementById('saveSpinner');
            spinner.classList.remove('hidden');
            
            try {
                // ุฌูุน ุงูุจูุงูุงุช ูู ุงููููุฐุฌ
                const inspectionData = collectFormData();
                
                // ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
                if (!validateInspectionData(inspectionData)) {
                    return;
                }
                
                // ุญูุธ ุงูุนููู ุฅุฐุง ูุงู ุฌุฏูุฏุงู
                if (!isExistingCustomer) {
                    saveCustomer(inspectionData);
                }
                
                // ุญูุธ ุงููุนุงููุฉ
                const inspectionId = 'INS-' + (++inspectionCounter);
                inspectionData.id = inspectionId;
                inspectionData.status = 'ูุนูู';
                inspectionData.createdAt = new Date().toISOString();
                
                inspections.push(inspectionData);
                
                // ุญูุธ ุงูุจูุงูุงุช ูุญููุงู
                saveLocalData();
                
                // ูุญุงููุฉ ุงูุญูุธ ูู Google Sheets
                await saveToGoogleSheets(inspectionData);
                
                showNotification('ุชู ุญูุธ ุงูุทูุจ ุจูุฌุงุญ! ๐', 'success');
                resetForm();
                updateTables();
                
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุญูุธ ุงููุนุงููุฉ:', error);
                showNotification('ุชู ุญูุธ ุงูุทูุจ ูุญููุงูุ ููู ูุดู ูู ุงูุญูุธ ุงูุณุญุงุจู', 'warning');
            } finally {
                spinner.classList.add('hidden');
            }
        }

        // ุฌูุน ุจูุงูุงุช ุงููููุฐุฌ
        function collectFormData() {
            const serviceType = document.getElementById('serviceType').value;
            const propertyType = document.getElementById('propertyType').value;
            const approval = document.querySelector('input[name="approval"]:checked').value;
            const rejectionReason = document.getElementById('rejectionReason').value;
            
            return {
                customerId: isExistingCustomer ? currentCustomerId : document.getElementById('customerId').value,
                customerName: isExistingCustomer ? customers[currentCustomerId].name : document.getElementById('customerName').value,
                customerPhone: isExistingCustomer ? customers[currentCustomerId].phone : document.getElementById('customerPhone').value,
                area: document.getElementById('customerArea').value,
                block: document.getElementById('customerBlock').value,
                avenue: document.getElementById('customerAvenue').value,
                street: document.getElementById('customerStreet').value,
                houseNumber: document.getElementById('customerHouseNumber').value,
                serviceType: serviceType === 'ุฃุฎุฑู' ? document.getElementById('otherService').value : serviceType,
                propertyType: propertyType === 'ุฃุฎุฑู' ? document.getElementById('otherProperty').value : propertyType,
                inspectionDate: document.getElementById('inspectionDate').value,
                inspectionTime: document.getElementById('inspectionTime').value,
                additionalNotes: document.getElementById('additionalNotes').value,
                approval: approval,
                rejectionReason: approval === 'ุบูุฑ ููุงูู' ? (rejectionReason === 'ุฃุฎุฑู' ? document.getElementById('otherRejectionReason').value : rejectionReason) : '',
                rejectionDetails: approval === 'ุบูุฑ ููุงูู' ? document.getElementById('rejectionDetails').value : '',
                totalAmount: parseFloat(document.getElementById('totalAmount').value) || 0,
                discountPercent: parseFloat(document.getElementById('discountPercent').value) || 0,
                finalAmount: parseFloat(document.getElementById('finalAmount').value) || 0,
                serviceDate: document.getElementById('serviceDate').value,
                paymentStatus: document.getElementById('paymentStatus').value,
                rating: approval === 'ููุงูู' ? currentRating : 0,
                ratingNotes: approval === 'ููุงูู' ? document.getElementById('ratingNotes').value : '',
                inspectorNotes: document.getElementById('inspectorNotes').value
            };
        }

        // ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
        function validateInspectionData(data) {
            if (!data.customerName) {
                showNotification('ูุฑุฌู ุฅุฏุฎุงู ุงุณู ุงูุนููู', 'error');
                return false;
            }
            
            if (!data.customerPhone) {
                showNotification('ูุฑุฌู ุฅุฏุฎุงู ุฑูู ุงูุฌูุงู', 'error');
                return false;
            }
            
            if (!data.area) {
                showNotification('ูุฑุฌู ุงุฎุชูุงุฑ ุงูููุทูุฉ', 'error');
                return false;
            }
            
            if (!data.serviceType) {
                showNotification('ูุฑุฌู ุงุฎุชูุงุฑ ููุน ุงูุฎุฏูุฉ', 'error');
                return false;
            }
            
            if (!data.propertyType) {
                showNotification('ูุฑุฌู ุงุฎุชูุงุฑ ููุน ุงูุณูู', 'error');
                return false;
            }
            
            if (!data.inspectionDate) {
                showNotification('ูุฑุฌู ุงุฎุชูุงุฑ ุชุงุฑูุฎ ุงููุนุงููุฉ', 'error');
                return false;
            }
            
            return true;
        }

        // ุญูุธ ุงูุนููู ุงูุฌุฏูุฏ
        function saveCustomer(inspectionData) {
            const customer = {
                id: inspectionData.customerId,
                name: inspectionData.customerName,
                phone: inspectionData.customerPhone,
                createdAt: new Date().toISOString()
            };
            
            customers[customer.id] = customer;
        }

        // ุญูุธ ูู Google Sheets (ุชู ุชุนุทููู ูุคูุชุงู)
        async function saveToGoogleSheets(data) {
            // ุชู ุชุนุทูู ุงูุญูุธ ุงูุชููุงุฆู ูู Google Sheets
            // ูููู ูููุณุชุฎุฏู ุงุณุชุฎุฏุงู ุฒุฑ ุงูุชุตุฏูุฑ ุซู ูุณุฎ ุงูุจูุงูุงุช ูุฏููุงู
            console.log('ุชู ุญูุธ ุงูุจูุงูุงุช ูุญููุงู:', data);
            return Promise.resolve({ success: true, message: 'ุชู ุงูุญูุธ ูุญููุงู' });
        }

        // ุฅุนุงุฏุฉ ุชุนููู ุงููููุฐุฌ
        function resetForm() {
            document.getElementById('inspectionForm').reset();
            document.getElementById('newCustomerForm').classList.add('hidden');
            document.getElementById('existingCustomerForm').classList.add('hidden');
            document.getElementById('customerHistory').classList.add('hidden');
            document.getElementById('createNewOrderBtn').classList.add('hidden');
            document.getElementById('addressPreview').classList.add('hidden');
            document.getElementById('paymentInfo').classList.add('hidden');
            document.getElementById('rejectionReasons').classList.add('hidden');
            document.getElementById('customerRating').classList.add('hidden');
            document.getElementById('otherServiceDiv').classList.add('hidden');
            document.getElementById('otherPropertyDiv').classList.add('hidden');
            document.getElementById('otherRejectionDiv').classList.add('hidden');
            
            currentRating = 0;
            highlightStars(0);
            updateRatingText(0);
            
            generateCustomerId();
            document.getElementById('customerSearch').value = '';
            
            isExistingCustomer = false;
            currentCustomerId = null;
        }

        // ุชุญุฏูุซ ุงูุฌุฏุงูู
        function updateTables() {
            updatePendingOrdersTable();
            updateCompletedOrdersTable();
        }

        // ุชุญุฏูุซ ุฌุฏูู ุงูุทูุจุงุช ุงููุนููุฉ
        function updatePendingOrdersTable() {
            const tbody = document.getElementById('pendingOrdersBody');
            tbody.innerHTML = '';
            
            const pendingInspections = inspections.filter(inspection => inspection.status === 'ูุนูู');
            
            pendingInspections.forEach(inspection => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-white hover:bg-opacity-10';
                
                const approvalClass = getApprovalClass(inspection.approval);
                
                row.innerHTML = `
                    <td class="px-6 py-4 text-sm font-medium text-orange-300">${inspection.id}</td>
                    <td class="px-6 py-4 text-sm text-white">${inspection.customerName}</td>
                    <td class="px-6 py-4 text-sm text-white">${inspection.area}</td>
                    <td class="px-6 py-4 text-sm text-white">${inspection.serviceType}</td>
                    <td class="px-6 py-4 text-sm text-white">${formatDate(inspection.inspectionDate)}</td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${approvalClass}">${inspection.approval}</span>
                    </td>
                    <td class="px-6 py-4">
                        <button onclick="showInspectionDetails('${inspection.id}')" class="text-yellow-300 hover:text-yellow-100 text-sm ml-2">ุนุฑุถ ุงูุชูุงุตูู</button>
                        <button onclick="editInspection('${inspection.id}')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm ml-2">ุชุนุฏูู</button>
                        <button onclick="markAsCompleted('${inspection.id}')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">ุชู ุงูุงูุชูุงุก</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // ุชุญุฏูุซ ุฌุฏูู ุงูุทูุจุงุช ุงูููุชููุฉ
        function updateCompletedOrdersTable() {
            const tbody = document.getElementById('completedOrdersBody');
            tbody.innerHTML = '';
            
            const completedInspections = inspections.filter(inspection => inspection.status === 'ููุชูู');
            
            completedInspections.forEach(inspection => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-white hover:bg-opacity-10';
                
                const approvalClass = getApprovalClass(inspection.approval);
                const stars = generateStars(inspection.rating);
                
                row.innerHTML = `
                    <td class="px-6 py-4 text-sm font-medium text-green-300">${inspection.id}</td>
                    <td class="px-6 py-4 text-sm text-white">${inspection.customerName}</td>
                    <td class="px-6 py-4 text-sm text-white">${inspection.area}</td>
                    <td class="px-6 py-4 text-sm text-white">${inspection.serviceType}</td>
                    <td class="px-6 py-4 text-sm text-white">${formatDate(inspection.inspectionDate)}</td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${approvalClass}">${inspection.approval}</span>
                    </td>
                    <td class="px-6 py-4 text-sm text-white">${stars}</td>
                    <td class="px-6 py-4">
                        <button onclick="showInspectionDetails('${inspection.id}')" class="text-blue-300 hover:text-blue-100 text-sm">ุนุฑุถ ุงูุชูุงุตูู</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // ุงูุญุตูู ุนูู ูุฆุฉ ุงูููุงููุฉ
        function getApprovalClass(approval) {
            switch (approval) {
                case 'ููุงูู':
                    return 'approval-approved';
                case 'ุบูุฑ ููุงูู':
                    return 'approval-rejected';
                default:
                    return 'approval-waiting';
            }
        }

        // ุชูููุฏ ุงููุฌูู ููุชูููู
        function generateStars(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= rating) {
                    stars += '<span class="text-yellow-400">โ</span>';
                } else {
                    stars += '<span class="text-gray-400">โ</span>';
                }
            }
            return stars;
        }

        // ุชูุณูู ุงูุชุงุฑูุฎ
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('ar-SA');
        }

        // ุชุญุฏูุฏ ุงููุนุงููุฉ ูููุชููุฉ
        function markAsCompleted(inspectionId) {
            const inspection = inspections.find(i => i.id === inspectionId);
            if (inspection) {
                inspection.status = 'ููุชูู';
                saveLocalData();
                updateTables();
                showNotification('ุชู ุชุญุฏูุซ ุญุงูุฉ ุงููุนุงููุฉ ุฅูู ููุชููุฉ', 'success');
            }
        }

        // ุนุฑุถ ุชูุงุตูู ุงููุนุงููุฉ
        function showInspectionDetails(inspectionId) {
            const inspection = inspections.find(i => i.id === inspectionId);
            if (!inspection) return;
            
            const customer = customers[inspection.customerId];
            
            const detailsHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- ูุนูููุงุช ุงูุนููู -->
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <h4 class="font-semibold text-blue-800 mb-3">ูุนูููุงุช ุงูุนููู</h4>
                        <div class="space-y-2 text-sm">
                            <p><span class="font-medium">ุฑูู ุงูุนููู:</span> ${inspection.customerId}</p>
                            <p><span class="font-medium">ุงูุงุณู:</span> ${inspection.customerName}</p>
                            <p><span class="font-medium">ุงูุฌูุงู:</span> ${inspection.customerPhone}</p>
                            <p><span class="font-medium">ุฑูู ุงููุนุงููุฉ:</span> ${inspection.id}</p>
                        </div>
                    </div>
                    
                    <!-- ูุนูููุงุช ุงูุนููุงู -->
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                        <h4 class="font-semibold text-green-800 mb-3">ูุนูููุงุช ุงูุนููุงู</h4>
                        <div class="space-y-2 text-sm">
                            <p><span class="font-medium">ุงูููุทูุฉ:</span> ${inspection.area}</p>
                            ${inspection.block ? `<p><span class="font-medium">ุงููุทุนุฉ:</span> ${inspection.block}</p>` : ''}
                            ${inspection.avenue ? `<p><span class="font-medium">ุงูุฌุงุฏุฉ:</span> ${inspection.avenue}</p>` : ''}
                            ${inspection.street ? `<p><span class="font-medium">ุงูุดุงุฑุน:</span> ${inspection.street}</p>` : ''}
                            ${inspection.houseNumber ? `<p><span class="font-medium">ุฑูู ุงูููุฒู:</span> ${inspection.houseNumber}</p>` : ''}
                        </div>
                    </div>
                    
                    <!-- ูุนูููุงุช ุงูุฎุฏูุฉ -->
                    <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                        <h4 class="font-semibold text-yellow-800 mb-3">ูุนูููุงุช ุงูุฎุฏูุฉ</h4>
                        <div class="space-y-2 text-sm">
                            <p><span class="font-medium">ููุน ุงูุฎุฏูุฉ:</span> ${inspection.serviceType}</p>
                            <p><span class="font-medium">ููุน ุงูุณูู:</span> ${inspection.propertyType}</p>
                            <p><span class="font-medium">ุชุงุฑูุฎ ุงููุนุงููุฉ:</span> ${formatDate(inspection.inspectionDate)}</p>
                            <p><span class="font-medium">ููุช ุงููุนุงููุฉ:</span> ${inspection.inspectionTime}</p>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
                    <!-- ุชูุงุตูู ุฅุถุงููุฉ -->
                    <div class="space-y-4">
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">ุงูุญุงูุฉ ูุงูููุงููุฉ</h4>
                            <div class="flex space-x-4 space-x-reverse">
                                <span class="px-3 py-1 rounded-full text-sm font-medium ${inspection.status === 'ููุชูู' ? 'bg-green-100 text-green-800' : 'bg-orange-100 text-orange-800'}">${inspection.status}</span>
                                <span class="px-3 py-1 rounded-full text-sm font-medium ${getApprovalClass(inspection.approval)}">${inspection.approval}</span>
                            </div>
                        </div>
                        
                        ${inspection.approval === 'ููุงูู' ? `
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">ุงููุนูููุงุช ุงููุงููุฉ</h4>
                            <div class="space-y-1 text-sm">
                                <p><span class="font-medium">ุงููุจูุบ ุงูููู:</span> ${inspection.totalAmount} ุฏ.ู</p>
                                <p><span class="font-medium">ูุณุจุฉ ุงูุฎุตู:</span> ${inspection.discountPercent}%</p>
                                <p><span class="font-medium">ุงููุจูุบ ุงูููุงุฆู:</span> ${inspection.finalAmount} ุฏ.ู</p>
                                <p><span class="font-medium">ุญุงูุฉ ุงูุฏูุน:</span> ${inspection.paymentStatus}</p>
                                ${inspection.serviceDate ? `<p><span class="font-medium">ุชุงุฑูุฎ ุชูููุฐ ุงูุฎุฏูุฉ:</span> ${formatDate(inspection.serviceDate)}</p>` : ''}
                            </div>
                        </div>
                        ` : ''}
                        
                        ${inspection.approval === 'ุบูุฑ ููุงูู' && inspection.rejectionReason ? `
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">ุณุจุจ ุงูุฅูุบุงุก</h4>
                            <div class="space-y-1 text-sm">
                                <p><span class="font-medium">ุงูุณุจุจ:</span> ${inspection.rejectionReason}</p>
                                ${inspection.rejectionDetails ? `<p><span class="font-medium">ุงูุชูุงุตูู:</span> ${inspection.rejectionDetails}</p>` : ''}
                            </div>
                        </div>
                        ` : ''}
                        
                        ${inspection.rating > 0 ? `
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">ุงูุชูููู</h4>
                            <div class="flex items-center space-x-2 space-x-reverse">
                                <div>${generateStars(inspection.rating)}</div>
                                <span class="text-sm text-gray-600">(${inspection.rating}/5)</span>
                            </div>
                            ${inspection.ratingNotes ? `<p class="text-sm text-gray-600 mt-1">${inspection.ratingNotes}</p>` : ''}
                        </div>
                        ` : ''}
                    </div>
                    
                    <!-- ุงูููุงุญุธุงุช -->
                    <div class="space-y-4">
                        ${inspection.additionalNotes ? `
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">ููุงุญุธุงุช ุฅุถุงููุฉ</h4>
                            <p class="text-sm text-gray-600 bg-gray-50 p-3 rounded">${inspection.additionalNotes}</p>
                        </div>
                        ` : ''}
                        
                        ${inspection.inspectorNotes ? `
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">ููุงุญุธุงุช ุงูููุชุด</h4>
                            <p class="text-sm text-gray-600 bg-gray-50 p-3 rounded">${inspection.inspectorNotes}</p>
                        </div>
                        ` : ''}
                        
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">ุชุงุฑูุฎ ุงูุฅูุดุงุก</h4>
                            <p class="text-sm text-gray-600">${formatDate(inspection.createdAt)}</p>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('inspectionDetails').innerHTML = detailsHTML;
            document.getElementById('inspectionModal').classList.remove('hidden');
            document.getElementById('inspectionModal').classList.add('flex');
        }

        // ุฅุบูุงู ูุงูุฐุฉ ุชูุงุตูู ุงููุนุงููุฉ
        function closeInspectionModal() {
            document.getElementById('inspectionModal').classList.add('hidden');
            document.getElementById('inspectionModal').classList.remove('flex');
        }

        // ุงุฎุชุจุงุฑ ุงูุงุชุตุงู
        async function testConnection() {
            showNotification('ุฌุงุฑู ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ูุน Google Sheets...', 'warning');
            
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL + '?action=test', {
                    method: 'GET',
                    mode: 'no-cors'
                });
                
                showNotification('ุชู ุงูุงุชุตุงู ุจูุฌุงุญ ูุน Google Sheets! โ', 'success');
            } catch (error) {
                showNotification('ูุดู ูู ุงูุงุชุตุงู ูุน Google Sheets - ุณูุนูู ุงููุธุงู ูุญููุงู', 'error');
            }
        }

        // ูุญุต ุงูุจูุงูุงุช ุงููุญููุฉ
        function checkLocalData() {
            const customersCount = Object.keys(customers).length;
            const inspectionsCount = inspections.length;
            const pendingCount = inspections.filter(i => i.status === 'ูุนูู').length;
            const completedCount = inspections.filter(i => i.status === 'ููุชูู').length;
            
            const message = `๐ ุฅุญุตุงุฆูุงุช ุงูุจูุงูุงุช ุงููุญููุฉ:
            
ุงูุนููุงุก: ${customersCount}
ุฅุฌูุงูู ุงููุนุงููุงุช: ${inspectionsCount}
ุงููุนุงููุงุช ุงููุนููุฉ: ${pendingCount}
ุงููุนุงููุงุช ุงูููุชููุฉ: ${completedCount}
ุขุฎุฑ ุฑูู ูุนุงููุฉ: ${inspectionCounter}`;
            
            alert(message);
        }

        // ูุชุญ Google Sheets
        function openGoogleSheets() {
            window.open(GOOGLE_SHEETS_URL, '_blank', 'noopener,noreferrer');
        }

        // ูุฑุงุกุฉ ุงูุจูุงูุงุช ูู Google Sheets
        async function loadFromGoogleSheets() {
            showNotification('ุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช ูู Google Sheets...', 'warning');
            
            try {
                // ูุญุงููุฉ ูุฑุงุกุฉ ุจูุงูุงุช ุงููุนุงููุงุช ูู ุงูุดูุช ุงูุฃูู
                const inspectionsUrl = `https://docs.google.com/spreadsheets/d/${GOOGLE_SHEETS_ID}/gviz/tq?tqx=out:csv&gid=0`;
                
                console.log('ูุญุงููุฉ ุงูุงุชุตุงู ุจู:', inspectionsUrl);
                
                // ุงุณุชุฎุฏุงู ุทุฑููุฉ ูุฎุชููุฉ ูููุตูู ููุจูุงูุงุช
                let response;
                let csvData;
                
                try {
                    // ุงููุญุงููุฉ ุงูุฃููู: ุงุณุชุฎุฏุงู fetch ุนุงุฏู
                    response = await fetch(inspectionsUrl, {
                        method: 'GET',
                        mode: 'cors',
                        headers: {
                            'Accept': 'text/csv,text/plain,*/*'
                        }
                    });
                    
                    if (response.ok) {
                        csvData = await response.text();
                    } else {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                } catch (fetchError) {
                    console.log('ูุดู ูู fetchุ ูุญุงููุฉ ุทุฑููุฉ ุจุฏููุฉ...');
                    
                    // ุงููุญุงููุฉ ุงูุซุงููุฉ: ุงุณุชุฎุฏุงู ุฑุงุจุท ูุฎุชูู
                    const alternativeUrl = `https://docs.google.com/spreadsheets/d/${GOOGLE_SHEETS_ID}/export?format=csv&gid=0`;
                    console.log('ูุญุงููุฉ ุงูุฑุงุจุท ุงูุจุฏูู:', alternativeUrl);
                    
                    try {
                        response = await fetch(alternativeUrl, {
                            method: 'GET',
                            mode: 'cors'
                        });
                        
                        if (response.ok) {
                            csvData = await response.text();
                        } else {
                            throw new Error(`ูุดู ูู ุงูุฑุงุจุท ุงูุจุฏูู: ${response.status}`);
                        }
                    } catch (altError) {
                        console.log('ูุดู ูู ุงูุฑุงุจุท ุงูุจุฏูู ุฃูุถุงู');
                        
                        // ุงููุญุงููุฉ ุงูุซุงูุซุฉ: ุงุณุชุฎุฏุงู JSONP
                        try {
                            csvData = await loadViaJSONP();
                        } catch (jsonpError) {
                            throw new Error('ูุดู ูู ุฌููุน ุทุฑู ุงูุงุชุตุงู. ุชุฃูุฏ ูู ุฃู ุงูุดูุช ูุดุงุฑู ููุนุงูุฉ ูููุฑุงุกุฉ');
                        }
                    }
                }
                
                console.log('ุงูุจูุงูุงุช ุงููุณุชููุฉ:', csvData ? csvData.substring(0, 500) : 'ูุง ุชูุฌุฏ ุจูุงูุงุช');
                
                if (!csvData || csvData.trim() === '' || csvData.includes('<!DOCTYPE html>')) {
                    throw new Error('ูุง ุชูุฌุฏ ุจูุงูุงุช ุตุงูุญุฉ ูู ุงูุดูุช ุฃู ุงูุดูุช ุบูุฑ ูุดุงุฑู ููุนุงูุฉ');
                }
                
                // ุชุญููู CSV ุฅูู JSON
                const parsedInspections = parseCSVToInspections(csvData);
                const parsedCustomers = extractCustomersFromInspections(parsedInspections);
                
                // ุฏูุฌ ุงูุจูุงูุงุช ูุน ุงูุจูุงูุงุช ุงููุญููุฉ
                let newCustomersCount = 0;
                let newInspectionsCount = 0;
                
                // ุฅุถุงูุฉ ุงูุนููุงุก ุงูุฌุฏุฏ
                Object.keys(parsedCustomers).forEach(customerId => {
                    if (!customers[customerId]) {
                        customers[customerId] = parsedCustomers[customerId];
                        newCustomersCount++;
                    }
                });
                
                // ุฅุถุงูุฉ ุงููุนุงููุงุช ุงูุฌุฏูุฏุฉ
                parsedInspections.forEach(newInsp => {
                    if (!inspections.some(existingInsp => existingInsp.id === newInsp.id)) {
                        inspections.push(newInsp);
                        newInspectionsCount++;
                    }
                });
                
                // ุญูุธ ุงูุจูุงูุงุช ูุญููุงู
                saveLocalData();
                updateTables();
                
                showNotification(`ุชู ุชุญููู ${newCustomersCount} ุนููู ุฌุฏูุฏ ู ${newInspectionsCount} ูุนุงููุฉ ุฌุฏูุฏุฉ ูู Google Sheets! โ`, 'success');
                
            } catch (error) {
                console.error('ุฎุทุฃ ูู ูุฑุงุกุฉ ุงูุจูุงูุงุช:', error);
                
                // ุฅุธูุงุฑ ุฑุณุงูุฉ ููุตูุฉ ุญุณุจ ููุน ุงูุฎุทุฃ
                let errorMessage = 'ูุดู ูู ูุฑุงุกุฉ ุงูุจูุงูุงุช ูู Google Sheets';
                
                if (error.message.includes('Failed to fetch')) {
                    errorMessage = 'ูุดููุฉ ูู ุงูุงุชุตุงู - ุชุฃูุฏ ูู ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช ูุฃู ุงูุดูุช ูุดุงุฑู ููุนุงูุฉ';
                } else if (error.message.includes('CORS')) {
                    errorMessage = 'ูุดููุฉ ูู ุฃุฐููุงุช ุงููุตูู - ุชุฃูุฏ ูู ุฃู ุงูุดูุช ูุดุงุฑู ููุนุงูุฉ ูููุฑุงุกุฉ';
                } else {
                    errorMessage = error.message;
                }
                
                showNotification(errorMessage, 'error');
                
                // ุงูุชุฑุงุญ ุญููู
                setTimeout(() => {
                    showNotification('๐ก ูุตูุญุฉ: ุชุฃูุฏ ูู ุฃู Google Sheet ูุดุงุฑู ููุนุงูุฉ (Anyone with the link can view)', 'warning');
                }, 2000);
            }
        }

        // ุชุญููู ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู JSONP ูุทุฑููุฉ ุจุฏููุฉ
        function loadViaJSONP() {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                const callbackName = 'jsonpCallback_' + Date.now();
                
                window[callbackName] = function(data) {
                    document.head.removeChild(script);
                    delete window[callbackName];
                    
                    // ุชุญููู ุงูุจูุงูุงุช ุฅูู CSV
                    if (data && data.table && data.table.rows) {
                        let csv = '';
                        data.table.rows.forEach(row => {
                            const rowData = row.c.map(cell => cell ? (cell.v || '') : '');
                            csv += rowData.map(field => `"${field}"`).join(',') + '\n';
                        });
                        resolve(csv);
                    } else {
                        reject(new Error('ูุง ุชูุฌุฏ ุจูุงูุงุช ูู ุงูุงุณุชุฌุงุจุฉ'));
                    }
                };
                
                script.onerror = function() {
                    document.head.removeChild(script);
                    delete window[callbackName];
                    reject(new Error('ูุดู ูู ุชุญููู ุงูุจูุงูุงุช ุนุจุฑ JSONP'));
                };
                
                const jsonpUrl = `https://docs.google.com/spreadsheets/d/${GOOGLE_SHEETS_ID}/gviz/tq?tqx=out:json&tq=SELECT%20*&gid=0&headers=1&callback=${callbackName}`;
                script.src = jsonpUrl;
                document.head.appendChild(script);
                
                // timeout ุจุนุฏ 10 ุซูุงูู
                setTimeout(() => {
                    if (document.head.contains(script)) {
                        document.head.removeChild(script);
                        delete window[callbackName];
                        reject(new Error('ุงูุชูุช ูููุฉ ุงูุงุชุตุงู'));
                    }
                }, 10000);
            });
        }



        // ุชุญููู CSV ุงููุนุงููุงุช ุฅูู JSON
        function parseCSVToInspections(csv) {
            const lines = csv.split('\n').filter(line => line.trim());
            const inspections = [];
            
            if (lines.length < 2) {
                console.log('ูุง ุชูุฌุฏ ุจูุงูุงุช ูุงููุฉ ูู CSV');
                return inspections;
            }
            
            console.log('ุนุฏุฏ ุงูุฃุณุทุฑ:', lines.length);
            console.log('ุงูููุฏุฑ:', lines[0]);
            
            // ุชุฎุทู ุงูููุฏุฑ
            for (let i = 1; i < lines.length; i++) {
                const values = parseCSVLine(lines[i]);
                console.log(`ุงูุณุทุฑ ${i}:`, values);
                
                if (values.length >= 3 && values[0] && values[0].trim() !== '') {
                    const inspection = {
                        id: values[0] || `INS-${Date.now()}-${i}`,
                        customerId: values[1] || `CUST-${Date.now()}-${i}`,
                        customerName: values[2] || '',
                        customerPhone: values[3] || '',
                        area: values[4] || '',
                        serviceType: values[5] || '',
                        propertyType: values[6] || '',
                        inspectionDate: values[7] || '',
                        inspectionTime: values[8] || 'ุตุจุงุญุงู (8-12)',
                        status: values[9] || 'ูุนูู',
                        approval: values[10] || 'ูู ุงูุงูุชุธุงุฑ',
                        totalAmount: parseFloat(values[11]) || 0,
                        finalAmount: parseFloat(values[12]) || 0,
                        rating: parseInt(values[13]) || 0,
                        additionalNotes: values[14] || '',
                        inspectorNotes: values[15] || '',
                        createdAt: values[16] || new Date().toISOString(),
                        // ุญููู ุฅุถุงููุฉ
                        block: values[17] || '',
                        avenue: values[18] || '',
                        street: values[19] || '',
                        houseNumber: values[20] || '',
                        rejectionReason: values[21] || '',
                        rejectionDetails: values[22] || '',
                        discountPercent: parseFloat(values[23]) || 0,
                        serviceDate: values[24] || '',
                        paymentStatus: values[25] || 'ูู ุงูุงูุชุธุงุฑ',
                        ratingNotes: values[26] || ''
                    };
                    
                    inspections.push(inspection);
                }
            }
            
            console.log('ุชู ุชุญููู', inspections.length, 'ูุนุงููุฉ');
            return inspections;
        }

        // ุงุณุชุฎุฑุงุฌ ุงูุนููุงุก ูู ุงููุนุงููุงุช
        function extractCustomersFromInspections(inspections) {
            const customers = {};
            
            inspections.forEach(inspection => {
                if (inspection.customerId && !customers[inspection.customerId]) {
                    customers[inspection.customerId] = {
                        id: inspection.customerId,
                        name: inspection.customerName || '',
                        phone: inspection.customerPhone || '',
                        createdAt: inspection.createdAt || new Date().toISOString()
                    };
                }
            });
            
            return customers;
        }

        // ุชุญููู ุณุทุฑ CSV ูุน ุงูุชุนุงูู ูุน ุงูููุงุตู ุฏุงุฎู ุงููุตูุต
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current.trim());
            return result;
        }

        // ุชุตุฏูุฑ ุงูุจูุงูุงุช ูู Excel
        function exportData() {
            // ุฅุถุงูุฉ BOM ููุชุฑููุฒ ุงูุนุฑุจู ุงูุตุญูุญ
            const BOM = '\uFEFF';
            
            // ุฅูุดุงุก ูุญุชูู CSV ููุนููุงุก
            let customersCSV = BOM + 'customer_id,name,phone,created_at\n';
            Object.values(customers).forEach(customer => {
                customersCSV += `"${customer.id}","${customer.name}","${customer.phone}","${customer.createdAt}"\n`;
            });

            // ุฅูุดุงุก ูุญุชูู CSV ูููุนุงููุงุช
            let inspectionsCSV = BOM + 'inspection_id,customer_id,customer_name,area,service_type,property_type,inspection_date,inspection_time,status,approval,total_amount,final_amount,rating,additional_notes,inspector_notes,created_at\n';
            inspections.forEach(inspection => {
                inspectionsCSV += `"${inspection.id}","${inspection.customerId}","${inspection.customerName}","${inspection.area}","${inspection.serviceType}","${inspection.propertyType}","${inspection.inspectionDate}","${inspection.inspectionTime}","${inspection.status}","${inspection.approval}","${inspection.totalAmount}","${inspection.finalAmount}","${inspection.rating}","${inspection.additionalNotes || ''}","${inspection.inspectorNotes || ''}","${inspection.createdAt}"\n`;
            });

            // ุชุตุฏูุฑ ููู ุงูุนููุงุก
            const customersBlob = new Blob([customersCSV], { type: 'text/csv;charset=utf-8;' });
            const customersUrl = URL.createObjectURL(customersBlob);
            const customersLink = document.createElement('a');
            customersLink.href = customersUrl;
            customersLink.download = `Customers-${new Date().toISOString().split('T')[0]}.csv`;
            customersLink.click();
            URL.revokeObjectURL(customersUrl);

            // ุชุตุฏูุฑ ููู ุงููุนุงููุงุช
            setTimeout(() => {
                const inspectionsBlob = new Blob([inspectionsCSV], { type: 'text/csv;charset=utf-8;' });
                const inspectionsUrl = URL.createObjectURL(inspectionsBlob);
                const inspectionsLink = document.createElement('a');
                inspectionsLink.href = inspectionsUrl;
                inspectionsLink.download = `Inspections-${new Date().toISOString().split('T')[0]}.csv`;
                inspectionsLink.click();
                URL.revokeObjectURL(inspectionsUrl);
            }, 500);
            
            showNotification('ุชู ุชุตุฏูุฑ ูููู CSV ุจูุฌุงุญ! ููููู ุฑูุนููุง ุฅูู Google Sheets ๐ฅ', 'success');
        }

        // ุชุนุฏูู ุงููุนุงููุฉ
        function editInspection(inspectionId) {
            const inspection = inspections.find(i => i.id === inspectionId);
            if (!inspection) return;
            
            const editContent = document.getElementById('editInspectionContent');
            editContent.innerHTML = `
                <!-- ููุงููุฉ ุงูุนููู ุนูู ุงูุฎุฏูุฉ -->
                <div class="mb-6">
                    <h4 class="text-lg font-semibold text-gray-700 mb-4">ููุงููุฉ ุงูุนููู ุนูู ุงูุฎุฏูุฉ</h4>
                    <div class="flex space-x-6 space-x-reverse">
                        <label class="flex items-center">
                            <input type="radio" name="editApproval" value="ููุงูู" ${inspection.approval === 'ููุงูู' ? 'checked' : ''} onchange="toggleEditApprovalSections()" class="ml-2">
                            <span class="px-3 py-1 bg-green-500 text-white rounded-full text-sm">ููุงูู</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="editApproval" value="ุบูุฑ ููุงูู" ${inspection.approval === 'ุบูุฑ ููุงูู' ? 'checked' : ''} onchange="toggleEditApprovalSections()" class="ml-2">
                            <span class="px-3 py-1 bg-red-500 text-white rounded-full text-sm">ุบูุฑ ููุงูู</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="editApproval" value="ูู ุงูุงูุชุธุงุฑ" ${inspection.approval === 'ูู ุงูุงูุชุธุงุฑ' ? 'checked' : ''} onchange="toggleEditApprovalSections()" class="ml-2">
                            <span class="px-3 py-1 bg-blue-500 text-white rounded-full text-sm">ูู ุงูุงูุชุธุงุฑ</span>
                        </label>
                    </div>
                </div>

                <!-- ุฃุณุจุงุจ ุงูุฅูุบุงุก -->
                <div id="editRejectionReasons" class="mb-6 ${inspection.approval !== 'ุบูุฑ ููุงูู' ? 'hidden' : ''}">
                    <h4 class="text-lg font-semibold text-gray-700 mb-4">ุฃุณุจุงุจ ุงูุฅูุบุงุก</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">ุณุจุจ ุงูุฅูุบุงุก</label>
                            <select id="editRejectionReason" onchange="toggleEditOtherRejectionReason()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">ุงุฎุชุฑ ุณุจุจ ุงูุฅูุบุงุก</option>
                                <option value="ุงูุณุนุฑ ูุฑุชูุน" ${inspection.rejectionReason === 'ุงูุณุนุฑ ูุฑุชูุน' ? 'selected' : ''}>ุงูุณุนุฑ ูุฑุชูุน</option>
                                <option value="ุชุบููุฑ ูู ุงูุฎุทุท" ${inspection.rejectionReason === 'ุชุบููุฑ ูู ุงูุฎุทุท' ? 'selected' : ''}>ุชุบููุฑ ูู ุงูุฎุทุท</option>
                                <option value="ูุฌุฏ ุฎุฏูุฉ ุฃุฎุฑู" ${inspection.rejectionReason === 'ูุฌุฏ ุฎุฏูุฉ ุฃุฎุฑู' ? 'selected' : ''}>ูุฌุฏ ุฎุฏูุฉ ุฃุฎุฑู</option>
                                <option value="ุนุฏู ุชููุฑ ุงูููุช" ${inspection.rejectionReason === 'ุนุฏู ุชููุฑ ุงูููุช' ? 'selected' : ''}>ุนุฏู ุชููุฑ ุงูููุช</option>
                                <option value="ุนุฏู ุงูุญุงุฌุฉ ููุฎุฏูุฉ" ${inspection.rejectionReason === 'ุนุฏู ุงูุญุงุฌุฉ ููุฎุฏูุฉ' ? 'selected' : ''}>ุนุฏู ุงูุญุงุฌุฉ ููุฎุฏูุฉ</option>
                                <option value="ูุดููุฉ ูู ุงูุชูุงุตู" ${inspection.rejectionReason === 'ูุดููุฉ ูู ุงูุชูุงุตู' ? 'selected' : ''}>ูุดููุฉ ูู ุงูุชูุงุตู</option>
                                <option value="ุฃุฎุฑู" ${inspection.rejectionReason && !['ุงูุณุนุฑ ูุฑุชูุน', 'ุชุบููุฑ ูู ุงูุฎุทุท', 'ูุฌุฏ ุฎุฏูุฉ ุฃุฎุฑู', 'ุนุฏู ุชููุฑ ุงูููุช', 'ุนุฏู ุงูุญุงุฌุฉ ููุฎุฏูุฉ', 'ูุดููุฉ ูู ุงูุชูุงุตู'].includes(inspection.rejectionReason) ? 'selected' : ''}>ุฃุฎุฑู</option>
                            </select>
                        </div>
                        <div id="editOtherRejectionDiv" class="${inspection.rejectionReason && !['ุงูุณุนุฑ ูุฑุชูุน', 'ุชุบููุฑ ูู ุงูุฎุทุท', 'ูุฌุฏ ุฎุฏูุฉ ุฃุฎุฑู', 'ุนุฏู ุชููุฑ ุงูููุช', 'ุนุฏู ุงูุญุงุฌุฉ ููุฎุฏูุฉ', 'ูุดููุฉ ูู ุงูุชูุงุตู'].includes(inspection.rejectionReason) ? '' : 'hidden'}">
                            <label class="block text-gray-700 text-sm font-bold mb-2">ุชุญุฏูุฏ ุงูุณุจุจ ุงูุขุฎุฑ</label>
                            <input type="text" id="editOtherRejectionReason" value="${inspection.rejectionReason && !['ุงูุณุนุฑ ูุฑุชูุน', 'ุชุบููุฑ ูู ุงูุฎุทุท', 'ูุฌุฏ ุฎุฏูุฉ ุฃุฎุฑู', 'ุนุฏู ุชููุฑ ุงูููุช', 'ุนุฏู ุงูุญุงุฌุฉ ููุฎุฏูุฉ', 'ูุดููุฉ ูู ุงูุชูุงุตู'].includes(inspection.rejectionReason) ? inspection.rejectionReason : ''}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">ุชูุงุตูู ุฅุถุงููุฉ ุญูู ุณุจุจ ุงูุฅูุบุงุก</label>
                        <textarea id="editRejectionDetails" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="ุงูุชุจ ุชูุงุตูู ุฅุถุงููุฉ ุญูู ุณุจุจ ุงูุฅูุบุงุก...">${inspection.rejectionDetails || ''}</textarea>
                    </div>
                </div>

                <!-- ูุนูููุงุช ุงูุฏูุน -->
                <div id="editPaymentInfo" class="mb-6 ${inspection.approval !== 'ููุงูู' ? 'hidden' : ''}">
                    <h4 class="text-lg font-semibold text-gray-700 mb-4">ูุนูููุงุช ุงูุฏูุน</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">ุงููุจูุบ ุงูููู (ุฏ.ู)</label>
                            <input type="number" id="editTotalAmount" step="0.001" value="${inspection.totalAmount || ''}" onchange="calculateEditDiscount()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">ูุณุจุฉ ุงูุฎุตู (%)</label>
                            <input type="number" id="editDiscountPercent" step="0.1" value="${inspection.discountPercent || ''}" onchange="calculateEditDiscount()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">ุงููุจูุบ ุจุนุฏ ุงูุฎุตู (ุฏ.ู)</label>
                            <input type="number" id="editFinalAmount" step="0.001" value="${inspection.finalAmount || ''}" readonly class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100">
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">ุชุงุฑูุฎ ุชูููุฐ ุงูุฎุฏูุฉ</label>
                            <input type="date" id="editServiceDate" value="${inspection.serviceDate || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">ุญุงูุฉ ุงูุฏูุน</label>
                        <select id="editPaymentStatus" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="ูู ุงูุงูุชุธุงุฑ" ${inspection.paymentStatus === 'ูู ุงูุงูุชุธุงุฑ' ? 'selected' : ''}>ูู ุงูุงูุชุธุงุฑ</option>
                            <option value="ูุฏููุน" ${inspection.paymentStatus === 'ูุฏููุน' ? 'selected' : ''}>ูุฏููุน</option>
                            <option value="ูุฏููุน ุฌุฒุฆูุงู" ${inspection.paymentStatus === 'ูุฏููุน ุฌุฒุฆูุงู' ? 'selected' : ''}>ูุฏููุน ุฌุฒุฆูุงู</option>
                        </select>
                    </div>
                </div>

                <!-- ุชูููู ุฑุถุง ุงูุนููู -->
                <div id="editCustomerRating" class="mb-6 ${inspection.approval !== 'ููุงูู' ? 'hidden' : ''}">
                    <h4 class="text-lg font-semibold text-gray-700 mb-4">ุชูููู ุฑุถุง ุงูุนููู</h4>
                    <div class="mb-4">
                        <div class="star-rating" id="editStarRating">
                            <span class="star ${inspection.rating >= 1 ? 'active' : ''}" data-rating="1">โ</span>
                            <span class="star ${inspection.rating >= 2 ? 'active' : ''}" data-rating="2">โ</span>
                            <span class="star ${inspection.rating >= 3 ? 'active' : ''}" data-rating="3">โ</span>
                            <span class="star ${inspection.rating >= 4 ? 'active' : ''}" data-rating="4">โ</span>
                            <span class="star ${inspection.rating >= 5 ? 'active' : ''}" data-rating="5">โ</span>
                        </div>
                        <p id="editRatingText" class="text-gray-600 mt-2">${getRatingText(inspection.rating)}</p>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">ููุงุญุธุฉ ุญูู ุณุจุจ ุงูุชูููู</label>
                        <textarea id="editRatingNotes" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">${inspection.ratingNotes || ''}</textarea>
                    </div>
                </div>

                <!-- ููุงุญุธุงุช ุฅุถุงููุฉ -->
                <div class="mb-6">
                    <h4 class="text-lg font-semibold text-gray-700 mb-4">ููุงุญุธุงุช ุฅุถุงููุฉ</h4>
                    <textarea id="editInspectorNotes" rows="3" placeholder="ููุงุญุธุงุช ุฅุถุงููุฉ ูู ุงูููุชุด..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">${inspection.inspectorNotes || ''}</textarea>
                </div>

                <input type="hidden" id="editInspectionId" value="${inspection.id}">
            `;
            
            // ุฅุนุฏุงุฏ ูุธุงู ุงูุชูููู ููุชุนุฏูู
            setupEditRatingSystem(inspection.rating);
            
            // ุฅุนุฏุงุฏ ูููุฐุฌ ุงูุชุนุฏูู
            document.getElementById('editInspectionForm').onsubmit = function(e) {
                e.preventDefault();
                saveInspectionEdit();
            };
            
            document.getElementById('editInspectionModal').classList.remove('hidden');
            document.getElementById('editInspectionModal').classList.add('flex');
        }

        // ุฅุนุฏุงุฏ ูุธุงู ุงูุชูููู ููุชุนุฏูู
        function setupEditRatingSystem(currentRating) {
            let editCurrentRating = currentRating || 0;
            
            document.querySelectorAll('#editStarRating .star').forEach(star => {
                star.addEventListener('click', function() {
                    editCurrentRating = parseInt(this.dataset.rating);
                    updateEditStars(editCurrentRating);
                    updateEditRatingText(editCurrentRating);
                });
                
                star.addEventListener('mouseover', function() {
                    const rating = parseInt(this.dataset.rating);
                    updateEditStars(rating);
                });
            });
            
            document.getElementById('editStarRating').addEventListener('mouseleave', function() {
                updateEditStars(editCurrentRating);
            });
        }

        // ุชุญุฏูุซ ูุฌูู ุงูุชุนุฏูู
        function updateEditStars(rating) {
            document.querySelectorAll('#editStarRating .star').forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        // ุชุญุฏูุซ ูุต ุงูุชูููู ููุชุนุฏูู
        function updateEditRatingText(rating) {
            document.getElementById('editRatingText').textContent = getRatingText(rating);
        }

        // ุงูุญุตูู ุนูู ูุต ุงูุชูููู
        function getRatingText(rating) {
            const texts = {
                1: 'ุบูุฑ ุฑุงุถู ุชูุงูุงู',
                2: 'ุบูุฑ ุฑุงุถู',
                3: 'ุฑุงุถู ุฅูู ุญุฏ ูุง',
                4: 'ุฑุงุถู',
                5: 'ุฑุงุถู ุฌุฏุงู'
            };
            return texts[rating] || 'ุงุฎุชุฑ ุงูุชูููู';
        }

        // ุชุจุฏูู ุงูุฃูุณุงู ูู ูููุฐุฌ ุงูุชุนุฏูู
        function toggleEditApprovalSections() {
            const approval = document.querySelector('input[name="editApproval"]:checked').value;
            const paymentInfo = document.getElementById('editPaymentInfo');
            const rejectionReasons = document.getElementById('editRejectionReasons');
            const customerRating = document.getElementById('editCustomerRating');
            
            // ุฅุฎูุงุก ุฌููุน ุงูุฃูุณุงู ุฃููุงู
            paymentInfo.classList.add('hidden');
            rejectionReasons.classList.add('hidden');
            customerRating.classList.add('hidden');
            
            if (approval === 'ููุงูู') {
                paymentInfo.classList.remove('hidden');
                customerRating.classList.remove('hidden');
            } else if (approval === 'ุบูุฑ ููุงูู') {
                rejectionReasons.classList.remove('hidden');
            }
        }

        // ุชุจุฏูู ุญูู ุงูุณุจุจ ุงูุขุฎุฑ ูู ุงูุชุนุฏูู
        function toggleEditOtherRejectionReason() {
            const rejectionReason = document.getElementById('editRejectionReason').value;
            const otherDiv = document.getElementById('editOtherRejectionDiv');
            
            if (rejectionReason === 'ุฃุฎุฑู') {
                otherDiv.classList.remove('hidden');
                document.getElementById('editOtherRejectionReason').required = true;
            } else {
                otherDiv.classList.add('hidden');
                document.getElementById('editOtherRejectionReason').required = false;
            }
        }

        // ุญุณุงุจ ุงูุฎุตู ูู ุงูุชุนุฏูู
        function calculateEditDiscount() {
            const totalAmount = parseFloat(document.getElementById('editTotalAmount').value) || 0;
            const discountPercent = parseFloat(document.getElementById('editDiscountPercent').value) || 0;
            
            const discountAmount = totalAmount * (discountPercent / 100);
            const finalAmount = totalAmount - discountAmount;
            
            document.getElementById('editFinalAmount').value = finalAmount.toFixed(3);
        }

        // ุญูุธ ุชุนุฏูู ุงููุนุงููุฉ
        function saveInspectionEdit() {
            const inspectionId = document.getElementById('editInspectionId').value;
            const inspection = inspections.find(i => i.id === inspectionId);
            
            if (!inspection) return;
            
            const approval = document.querySelector('input[name="editApproval"]:checked').value;
            const rejectionReason = document.getElementById('editRejectionReason').value;
            
            // ุชุญุฏูุซ ุงูุจูุงูุงุช
            inspection.approval = approval;
            
            // ุชุญุฏูุซ ุฃุณุจุงุจ ุงูุฅูุบุงุก
            if (approval === 'ุบูุฑ ููุงูู') {
                inspection.rejectionReason = rejectionReason === 'ุฃุฎุฑู' ? document.getElementById('editOtherRejectionReason').value : rejectionReason;
                inspection.rejectionDetails = document.getElementById('editRejectionDetails').value;
                // ูุณุญ ุจูุงูุงุช ุงูุชูููู ูุงูุฏูุน
                inspection.rating = 0;
                inspection.ratingNotes = '';
                inspection.totalAmount = 0;
                inspection.finalAmount = 0;
                inspection.paymentStatus = '';
            } else {
                // ูุณุญ ุฃุณุจุงุจ ุงูุฅูุบุงุก
                inspection.rejectionReason = '';
                inspection.rejectionDetails = '';
                
                if (approval === 'ููุงูู') {
                    inspection.totalAmount = parseFloat(document.getElementById('editTotalAmount').value) || 0;
                    inspection.discountPercent = parseFloat(document.getElementById('editDiscountPercent').value) || 0;
                    inspection.finalAmount = parseFloat(document.getElementById('editFinalAmount').value) || 0;
                    inspection.serviceDate = document.getElementById('editServiceDate').value;
                    inspection.paymentStatus = document.getElementById('editPaymentStatus').value;
                    inspection.rating = getCurrentEditRating();
                    inspection.ratingNotes = document.getElementById('editRatingNotes').value;
                } else {
                    // ูู ุงูุงูุชุธุงุฑ - ูุณุญ ุจูุงูุงุช ุงูุฏูุน ูุงูุชูููู
                    inspection.rating = 0;
                    inspection.ratingNotes = '';
                    inspection.totalAmount = 0;
                    inspection.finalAmount = 0;
                    inspection.paymentStatus = '';
                }
            }
            
            inspection.inspectorNotes = document.getElementById('editInspectorNotes').value;
            
            // ุญูุธ ุงูุจูุงูุงุช
            saveLocalData();
            updateTables();
            closeEditInspectionModal();
            
            showNotification('ุชู ุญูุธ ุงูุชุนุฏููุงุช ุจูุฌุงุญ! โ', 'success');
        }

        // ุงูุญุตูู ุนูู ุงูุชูููู ุงูุญุงูู ูู ุงูุชุนุฏูู
        function getCurrentEditRating() {
            const activeStars = document.querySelectorAll('#editStarRating .star.active');
            return activeStars.length;
        }

        // ุฅุบูุงู ูุงูุฐุฉ ุชุนุฏูู ุงููุนุงููุฉ
        function closeEditInspectionModal() {
            document.getElementById('editInspectionModal').classList.add('hidden');
            document.getElementById('editInspectionModal').classList.remove('flex');
        }

        // ุฅุธูุงุฑ ุงูุฅุดุนุงุฑุงุช
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // ุฅุธูุงุฑ ุงูุฅุดุนุงุฑ
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // ุฅุฎูุงุก ุงูุฅุดุนุงุฑ
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98a4346e0401c68b',t:'MTc1OTc0MzcwNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
