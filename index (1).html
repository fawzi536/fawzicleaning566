<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ุฅุฏุงุฑุฉ ุทูุจุงุช ุงููุนุงููุฉ ูุงูุฎุฏูุงุช ุงูููุฒููุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        body {
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-feature-settings: "cv02", "cv03", "cv04", "cv11";
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        .modal-backdrop {
            backdrop-filter: blur(4px);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #374151 0%, #1f2937 100%);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #93c5fd 0%, #60a5fa 100%);
        }
        
        .status-active {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
        }
        
        .status-completed {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
        }
        
        .rating-star {
            font-size: 1.5rem;
            color: #d1d5db;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .rating-star.active {
            color: #fbbf24;
        }
        
        .rating-star:hover {
            color: #f59e0b;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen font-sans">
    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-blue-500">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <h1 class="text-3xl font-bold text-gray-900 flex items-center">
                    <span class="text-4xl ml-3">๐ก</span>
                    Wajha Orders
                </h1>

            </div>

        </div>
    </header>

    <!-- Main Container -->
    <div class="container mx-auto px-6 py-8">
        <!-- Navigation Tabs -->
        <div class="bg-white rounded-xl shadow-lg mb-8 overflow-hidden">
            <div class="flex border-b">
                <button onclick="showTab('new-inspection')" id="tab-new-inspection" class="flex-1 py-4 px-6 text-center font-semibold text-blue-600 border-b-2 border-blue-500 bg-blue-50">
                    ุทูุจ ูุนุงููุฉ ุฌุฏูุฏ
                </button>
                <button onclick="showTab('pending-inspections')" id="tab-pending-inspections" class="flex-1 py-4 px-6 text-center font-semibold text-gray-700 hover:text-blue-600 hover:bg-gray-50 transition-colors">
                    ุงูุทูุจุงุช ุงููุนููุฉ
                </button>
                <button onclick="showTab('completed-inspections')" id="tab-completed-inspections" class="flex-1 py-4 px-6 text-center font-semibold text-gray-700 hover:text-blue-600 hover:bg-gray-50 transition-colors">
                    ุงูุทูุจุงุช ุงูููุชููุฉ
                </button>
            </div>
        </div>

        <!-- New Inspection Tab -->
        <div id="new-inspection-tab" class="tab-content">
            <!-- Customer Number Input -->
            <div id="customer-search" class="bg-white rounded-xl shadow-lg p-8 mb-8 card-hover">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <span class="text-2xl ml-3">๐</span>
                    ุงูุจุญุซ ุนู ุงูุนููู
                </h2>
                <div class="flex gap-4">
                    <input type="text" id="customerNumber" placeholder="ุฃุฏุฎู ุฑูู ุงูุนููู" 
                           class="flex-1 px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none text-lg" onkeyup="toggleCreateButton()">
                    <button onclick="searchCustomer()" class="btn-primary text-white px-8 py-3 rounded-lg font-semibold">
                        ุจุญุซ
                    </button>
                    <button id="createNewButton" onclick="createNewInspection()" class="btn-success text-white px-8 py-3 rounded-lg font-semibold hidden">
                        ุฅูุดุงุก ุทูุจ ูุนุงููุฉ ุฌุฏูุฏ
                    </button>
                </div>
                
                <!-- Customer History Section -->
                <div id="customer-history" class="hidden mt-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-xl ml-2">๐</span>
                        ุทูุจุงุช ุงูุนููู ุงูุณุงุจูุฉ
                    </h3>
                    <div id="customer-history-table"></div>
                </div>
            </div>

            <!-- New Customer Form -->
            <div id="new-customer-form" class="hidden">
                <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <span class="text-2xl ml-3">๐จโ๐ผ</span>
                        ุฅูุดุงุก ุญุณุงุจ ุนููู ุฌุฏูุฏ
                    </h2>
                    <form id="customerForm" class="space-y-6">
                        <!-- Customer Basic Info -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-gray-700 font-semibold mb-2">ุฑูู ุงูุนููู *</label>
                                <input type="text" id="newCustomerNumber" readonly class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg bg-gray-100 text-gray-700">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-semibold mb-2">ุงูุงุณู *</label>
                                <input type="text" id="customerName" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-semibold mb-2">ุฑูู ุงูุฌูุงู *</label>
                                <input type="tel" id="customerPhone" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-semibold mb-2">ุงูููุทูุฉ *</label>
                                <select id="customerArea" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" onchange="updateAddressReview()"
                                    <option value="">ุงุฎุชุฑ ุงูููุทูุฉ</option>
                                    <option value="ุงูุดุงููุฉ">ุงูุดุงููุฉ</option>
                                    <option value="ุจูุงู">ุจูุงู</option>
                                    <option value="ูุดุฑู">ูุดุฑู</option>
                                    <option value="ุญููู">ุญููู</option>
                                    <option value="ุงูุณุงูููุฉ">ุงูุณุงูููุฉ</option>
                                    <option value="ุงูุฌุงุจุฑูุฉ">ุงูุฌุงุจุฑูุฉ</option>
                                    <option value="ุงูุฒูุฑุงุก">ุงูุฒูุฑุงุก</option>
                                    <option value="ุงูุฑููุซูุฉ">ุงูุฑููุซูุฉ</option>
                                    <option value="ุงูุตุฏูู">ุงูุตุฏูู</option>
                                    <option value="ุงูููุทุงุณ">ุงูููุทุงุณ</option>
                                    <option value="ุฃุจู ุญูููุฉ">ุฃุจู ุญูููุฉ</option>
                                    <option value="ุงูููุจููุฉ">ุงูููุจููุฉ</option>
                                    <option value="ุงููุญูุญูู">ุงููุญูุญูู</option>
                                    <option value="ุนูู ุตุจุงุญ ุงูุณุงูู">ุนูู ุตุจุงุญ ุงูุณุงูู</option>
                                    <option value="ุตุจุงุญ ุงูุณุงูู">ุตุจุงุญ ุงูุณุงูู</option>
                                    <option value="ุงูุฃุญูุฏู">ุงูุฃุญูุฏู</option>
                                    <option value="ุงููุฑูุงููุฉ">ุงููุฑูุงููุฉ</option>
                                    <option value="ุงูุฑูุฉ">ุงูุฑูุฉ</option>
                                    <option value="ุงูุฑุงุจูุฉ">ุงูุฑุงุจูุฉ</option>
                                    <option value="ุงูุฃูุฏูุณ">ุงูุฃูุฏูุณ</option>
                                    <option value="ุฅุดุจูููุฉ">ุฅุดุจูููุฉ</option>
                                    <option value="ุงูุถุฌูุฌ">ุงูุถุฌูุฌ</option>
                                    <option value="ุงูุนุงุฑุถูุฉ">ุงูุนุงุฑุถูุฉ</option>
                                    <option value="ุฌููุจ ุงูุดููุฎ">ุฌููุจ ุงูุดููุฎ</option>
                                    <option value="ุงูุฑุญุงุจ">ุงูุฑุญุงุจ</option>
                                    <option value="ุตุจุงุญ ุงููุงุตุฑ">ุตุจุงุญ ุงููุงุตุฑ</option>
                                    <option value="ุงูุตุจุงุญูุฉ">ุงูุตุจุงุญูุฉ</option>
                                    <option value="ูุจุงุฑู ุงููุจูุฑ">ูุจุงุฑู ุงููุจูุฑ</option>
                                    <option value="ุตุจุญุงู">ุตุจุญุงู</option>
                                    <option value="ุฃุจู ูุทูุฑุฉ">ุฃุจู ูุทูุฑุฉ</option>
                                    <option value="ุงููุตูุฑ">ุงููุตูุฑ</option>
                                    <option value="ุงููุฑูู">ุงููุฑูู</option>
                                    <option value="ุงูุนุฏุงู">ุงูุนุฏุงู</option>
                                    <option value="ุงูุฌูุฑุงุก">ุงูุฌูุฑุงุก</option>
                                    <option value="ุชููุงุก">ุชููุงุก</option>
                                    <option value="ุงููุณูู">ุงููุณูู</option>
                                    <option value="ุงููุงุญุฉ">ุงููุงุญุฉ</option>
                                    <option value="ุงูุนููู">ุงูุนููู</option>
                                    <option value="ูุงุธูุฉ">ูุงุธูุฉ</option>
                                    <option value="ุงูุตููุจูุฉ">ุงูุตููุจูุฉ</option>
                                    <option value="ุงูุดุฏุงุฏูุฉ">ุงูุดุฏุงุฏูุฉ</option>
                                    <option value="ุงูุดููุฎ">ุงูุดููุฎ</option>
                                    <option value="ุงูุฏูุญุฉ">ุงูุฏูุญุฉ</option>
                                    <option value="ุงููุฒูุฉ">ุงููุฒูุฉ</option>
                                    <option value="ุงูููุญุงุก">ุงูููุญุงุก</option>
                                    <option value="ุงูุฎุงูุฏูุฉ">ุงูุฎุงูุฏูุฉ</option>
                                    <option value="ุงูุฏุนูุฉ">ุงูุฏุนูุฉ</option>
                                    <option value="ูููุงู">ูููุงู</option>
                                    <option value="ุงูููุตูุฑูุฉ">ุงูููุตูุฑูุฉ</option>
                                    <option value="ุงูุฏุณูุฉ">ุงูุฏุณูุฉ</option>
                                    <option value="ุฏุณูุงู">ุฏุณูุงู</option>
                                    <option value="ุงูุดุฑู">ุงูุดุฑู</option>
                                    <option value="ุงููุฑูุงุจ">ุงููุฑูุงุจ</option>
                                    <option value="ุงููุจูุฉ">ุงููุจูุฉ</option>
                                    <option value="ุงูุตูุงุจุฑ">ุงูุตูุงุจุฑ</option>
                                    <option value="ุงูุฑูุถุฉ">ุงูุฑูุถุฉ</option>
                                    <option value="ุงูุนุฏูููุฉ">ุงูุนุฏูููุฉ</option>
                                    <option value="ูุฑุทุจุฉ">ูุฑุทุจุฉ</option>
                                    <option value="ุงููุฑููู">ุงููุฑููู</option>
                                    <option value="ุบุฑูุงุทุฉ">ุบุฑูุงุทุฉ</option>
                                    <option value="ุงูุตุงูุญูุฉ">ุงูุตุงูุญูุฉ</option>
                                    <option value="ุงูุณุฑุฉ">ุงูุณุฑุฉ</option>
                                    <option value="ุญุทูู">ุญุทูู</option>
                                    <option value="ุงูุดูุฏุงุก">ุงูุดูุฏุงุก</option>
                                    <option value="ุงููุทูุฉ">ุงููุทูุฉ</option>
                                    <option value="ุงูุฒูุฑ">ุงูุฒูุฑ</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-semibold mb-2">ุงููุทุนุฉ</label>
                                <input type="text" id="customerBlock" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" placeholder="ุฑูู ุงููุทุนุฉ" onkeyup="updateAddressReview()">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-semibold mb-2">ุงูุฌุงุฏุฉ</label>
                                <input type="text" id="customerAvenue" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" placeholder="ุฑูู ุงูุฌุงุฏุฉ" onkeyup="updateAddressReview()">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-semibold mb-2">ุงูุดุงุฑุน</label>
                                <input type="text" id="customerStreet" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" placeholder="ุงุณู ุฃู ุฑูู ุงูุดุงุฑุน" onkeyup="updateAddressReview()">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-semibold mb-2">ุฑูู ุงูููุฒู</label>
                                <input type="text" id="customerHouseNumber" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" placeholder="ุฑูู ุงูููุฒู" onkeyup="updateAddressReview()">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-semibold mb-2">ุงููููุน (ุงุฎุชูุงุฑู)</label>
                                <input type="text" id="customerLocation" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" placeholder="ุฑุงุจุท ุงููููุน ุฃู ุฅุญุฏุงุซูุงุช GPS">
                            </div>
                        </div>

                        <!-- Address Review Section -->
                        <div id="addressReview" class="bg-blue-50 p-6 rounded-lg hidden">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <span class="text-lg ml-2">๐</span>
                                ูุฑุงุฌุนุฉ ุงูุนููุงู ุงููุฏุฎู
                            </h3>
                            <div id="addressDisplay" class="bg-white p-4 rounded-lg border-2 border-blue-200">
                                <p class="text-gray-700 font-medium">ุงูุนููุงู ุงููุงูู:</p>
                                <p id="fullAddress" class="text-lg font-bold text-blue-800 mt-2"></p>
                            </div>
                        </div>

                        <!-- Service Details -->
                        <div class="bg-blue-50 p-6 rounded-lg">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <span class="text-lg ml-2">๐งฝ</span>
                                ุชูุงุตูู ุงูุฎุฏูุฉ ุงููุทููุจุฉ
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ููุน ุงูุฎุฏูุฉ *</label>
                                    <select id="serviceType" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" onchange="toggleServiceTypeOther()">
                                        <option value="">ุงุฎุชุฑ ููุน ุงูุฎุฏูุฉ</option>
                                        <option value="ุชูุธูู ุนุงู">ุชูุธูู ุนุงู</option>
                                        <option value="ุชูุธูู ุนููู">ุชูุธูู ุนููู</option>
                                        <option value="ุชูุธูู ุจุนุฏ ุงูุฏูุงู">ุชูุธูู ุจุนุฏ ุงูุฏูุงู</option>
                                        <option value="ุชูุธูู ุงููุทุจุฎ">ุชูุธูู ุงููุทุจุฎ</option>
                                        <option value="ุชูุธูู ุงูุญูุงูุงุช">ุชูุธูู ุงูุญูุงูุงุช</option>
                                        <option value="ุชูุธูู ุงูููุงูุฐ">ุชูุธูู ุงูููุงูุฐ</option>
                                        <option value="ุชูุธูู ุงูุณุฌุงุฏ ูุงูููููุช">ุชูุธูู ุงูุณุฌุงุฏ ูุงูููููุช</option>
                                        <option value="ุชูุธูู ุงูุฃุซุงุซ">ุชูุธูู ุงูุฃุซุงุซ</option>
                                        <option value="ุฃุฎุฑู">ุฃุฎุฑู</option>
                                    </select>
                                    <div id="serviceTypeOther" class="hidden mt-2">
                                        <input type="text" id="serviceTypeCustom" placeholder="ุญุฏุฏ ููุน ุงูุฎุฏูุฉ" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ููุน ุงูุณูู *</label>
                                    <select id="housingType" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" onchange="toggleHousingTypeOther()">
                                        <option value="">ุงุฎุชุฑ ููุน ุงูุณูู</option>
                                        <option value="ุดูุฉ">ุดูุฉ</option>
                                        <option value="ูููุง">ูููุง</option>
                                        <option value="ุฏูุจููุณ">ุฏูุจููุณ</option>
                                        <option value="ุงุณุชูุฏูู">ุงุณุชูุฏูู</option>
                                        <option value="ุจูุช ุดุนุจู">ุจูุช ุดุนุจู</option>
                                        <option value="ุฃุฎุฑู">ุฃุฎุฑู</option>
                                    </select>
                                    <div id="housingTypeOther" class="hidden mt-2">
                                        <input type="text" id="housingTypeCustom" placeholder="ุญุฏุฏ ููุน ุงูููุงู" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุชุงุฑูุฎ ุงููุนุงููุฉ ุงูููุถู *</label>
                                    <input type="date" id="inspectionDate" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ููุช ุงููุนุงููุฉ ุงูููุถู *</label>
                                    <select id="inspectionTime" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                        <option value="">ุงุฎุชุฑ ุงูููุช</option>
                                        <option value="ุตุจุงุญุงู (8-12)">ุตุจุงุญุงู (8-12)</option>
                                        <option value="ุธูุฑุงู (12-4)">ุธูุฑุงู (12-4)</option>
                                        <option value="ูุณุงุกู (4-8)">ูุณุงุกู (4-8)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mt-4">
                                <label class="block text-gray-700 font-medium mb-2">ููุงุญุธุงุช ุฅุถุงููุฉ</label>
                                <textarea id="serviceNotes" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" placeholder="ุฃู ููุงุญุธุงุช ุฃู ุทูุจุงุช ุฎุงุตุฉ"></textarea>
                            </div>
                        </div>

                        <!-- Customer Approval -->
                        <div class="bg-yellow-50 p-6 rounded-lg">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <span class="text-lg ml-2">โ๏ธ</span>
                                ููุงููุฉ ุงูุนููู ุนูู ุงูุฎุฏูุฉ (ุงุฎุชูุงุฑู - ูููู ุชุญุฏูุฏูุง ูุงุญูุงู)
                            </h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ูู ุงูุนููู ููุงูู ุนูู ุงูุฎุฏูุฉุ</label>
                                    <div class="flex gap-4">
                                        <label class="flex items-center">
                                            <input type="radio" name="customerApproval" value="ููุงูู" onchange="togglePaymentSection()" class="ml-2">
                                            <span class="text-green-600 font-semibold">ููุงูู</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="customerApproval" value="ุบูุฑ ููุงูู" onchange="togglePaymentSection()" class="ml-2">
                                            <span class="text-red-600 font-semibold">ุบูุฑ ููุงูู</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="customerApproval" value="ูู ุงูุงูุชุธุงุฑ" onchange="togglePaymentSection()" class="ml-2" checked>
                                            <span class="text-blue-600 font-semibold">ูู ุงูุงูุชุธุงุฑ</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Rejection Section -->
                                <div id="rejection-section" class="hidden">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-gray-700 font-medium mb-2">ุงูุณุนุฑ ุงูููุชุฑุญ (ุฏููุงุฑ ูููุชู)</label>
                                            <input type="number" id="proposedPrice" min="0" step="0.1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 font-medium mb-2">ุณุจุจ ุนุฏู ุงูููุงููุฉ</label>
                                            <select id="rejectionReason" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" onchange="toggleRejectionReasonOther()">
                                                <option value="">ุงุฎุชุฑ ุงูุณุจุจ</option>
                                                <option value="ุงูุณุนุฑ ูุฑุชูุน">ุงูุณุนุฑ ูุฑุชูุน</option>
                                                <option value="ูุง ูุญุชุงุฌ ุงูุฎุฏูุฉ ุญุงููุงู">ูุง ูุญุชุงุฌ ุงูุฎุฏูุฉ ุญุงููุงู</option>
                                                <option value="ูุฌุฏ ุฎุฏูุฉ ุฃุฎุฑู">ูุฌุฏ ุฎุฏูุฉ ุฃุฎุฑู</option>
                                                <option value="ุบูุฑ ุฑุงุถู ุนู ุงููุนุงููุฉ">ุบูุฑ ุฑุงุถู ุนู ุงููุนุงููุฉ</option>
                                                <option value="ุฃุณุจุงุจ ุฃุฎุฑู">ุฃุณุจุงุจ ุฃุฎุฑู</option>
                                            </select>
                                            <div id="rejectionReasonOther" class="hidden mt-2">
                                                <input type="text" id="rejectionReasonCustom" placeholder="ุญุฏุฏ ุงูุณุจุจ" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Details (shown only if approved) -->
                        <div id="payment-section" class="bg-green-50 p-6 rounded-lg hidden">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <span class="text-lg ml-2">๐ฐ</span>
                                ูุนูููุงุช ุงูุฏูุน
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุทุฑููุฉ ุงูุฏูุน *</label>
                                    <select id="paymentMethod" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                        <option value="">ุงุฎุชุฑ ุทุฑููุฉ ุงูุฏูุน</option>
                                        <option value="ูุงุด">ูุงุด</option>
                                        <option value="ููุฒุง">ููุฒุง</option>
                                        <option value="ูู ูุช">ูู ูุช</option>
                                        <option value="ุงุจู ุจุงู">ุงุจู ุจุงู</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุงููุจูุบ ุงูููู (ุฏููุงุฑ ูููุชู) *</label>
                                    <input type="number" id="totalAmount" min="0" step="0.1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" onchange="calculateDiscount()">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ูุณุจุฉ ุงูุฎุตู (%)</label>
                                    <input type="number" id="discountPercentage" min="0" max="100" step="0.1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" onchange="calculateDiscount()">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุงููุจูุบ ุจุนุฏ ุงูุฎุตู</label>
                                    <input type="number" id="finalAmount" readonly class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-700">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุญุงูุฉ ุงูุฏูุน *</label>
                                    <select id="paymentStatus" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                        <option value="ูู ุงูุงูุชุธุงุฑ">ูู ุงูุงูุชุธุงุฑ</option>
                                        <option value="ูุฏููุน">ูุฏููุน</option>
                                        <option value="ูุฏููุน ุฌุฒุฆูุงู">ูุฏููุน ุฌุฒุฆูุงู</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Service Date (shown only if approved) -->
                        <div id="team-section" class="bg-purple-50 p-6 rounded-lg hidden">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <span class="text-lg ml-2">๐</span>
                                ุชุงุฑูุฎ ุชูููุฐ ุงูุฎุฏูุฉ
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-1 gap-4">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุชุงุฑูุฎ ุชูููุฐ ุงูุฎุฏูุฉ</label>
                                    <input type="date" id="serviceDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                </div>
                            </div>
                        </div>

                        <!-- Customer Satisfaction Rating (Only for approved and paid services) -->
                        <div id="rating-section" class="bg-orange-50 p-6 rounded-lg hidden">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <span class="text-lg ml-2">โญ๏ธ</span>
                                ุชูููู ุฑุถุง ุงูุนููู (ููุนููุงุก ุงูููุงูููู ูุงููุฏููุนูู ููุท)
                            </h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ูุฏู ุฑุถุง ุงูุนููู ุนู ุงูุฎุฏูุฉ (ูู 1 ุฅูู 5)</label>
                                    <div class="flex items-center gap-2 mb-2">
                                        <span onclick="setRating(1)" class="rating-star" data-rating="1">โญ</span>
                                        <span onclick="setRating(2)" class="rating-star" data-rating="2">โญ</span>
                                        <span onclick="setRating(3)" class="rating-star" data-rating="3">โญ</span>
                                        <span onclick="setRating(4)" class="rating-star" data-rating="4">โญ</span>
                                        <span onclick="setRating(5)" class="rating-star" data-rating="5">โญ</span>
                                        <span id="rating-text" class="mr-4 font-medium text-gray-700"></span>
                                    </div>
                                    <input type="hidden" id="customerRating" value="">
                                    <div class="text-sm text-gray-600 mt-2">
                                        <div><strong>1 ูุฌูุฉ:</strong> ุบูุฑ ุฑุงุถู ุชูุงูุงู</div>
                                        <div><strong>2 ูุฌูุฉ:</strong> ุบูุฑ ุฑุงุถู</div>
                                        <div><strong>3 ูุฌูุฉ:</strong> ุฑุงุถู ุฅูู ุญุฏ ูุง</div>
                                        <div><strong>4 ูุฌูุฉ:</strong> ุฑุงุถู</div>
                                        <div><strong>5 ูุฌูุฉ:</strong> ุฑุงุถู ุฌุฏุงู</div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ููุงุญุธุฉ ุญูู ุณุจุจ ุงูุชูููู</label>
                                    <textarea id="ratingNotes" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none" placeholder="ููุงุฐุง ุงุฎุชุงุฑ ุงูุนููู ูุฐุง ุงูุชููููุ"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Photos Section -->
                        <div class="bg-indigo-50 p-6 rounded-lg">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <span class="text-lg ml-2">๐ท</span>
                                ุงูุตูุฑ ูุงูููุงุทุน
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Before Cleaning Photos -->
                                <div class="bg-white p-4 rounded-lg border-2 border-dashed border-gray-300">
                                    <h4 class="font-semibold text-gray-700 mb-3 flex items-center">
                                        <span class="text-red-500 ml-2">๐ธ</span>
                                        ุตูุฑ ูุจู ุงูุชูุธูู
                                    </h4>
                                    <input type="file" id="beforePhotos" multiple accept="image/*,video/*" class="hidden" onchange="handleFileUpload('before', this.files)">
                                    <button type="button" onclick="document.getElementById('beforePhotos').click()" class="w-full bg-red-500 text-white py-3 px-4 rounded-lg hover:bg-red-600 transition-colors flex items-center justify-center">
                                        <span class="ml-2">๐</span>
                                        ุงุฎุชูุงุฑ ุตูุฑ/ููุงุทุน ูุจู ุงูุชูุธูู
                                    </button>
                                    <div id="beforePhotosPreview" class="mt-3 grid grid-cols-2 gap-2"></div>
                                </div>
                                
                                <!-- After Cleaning Photos -->
                                <div class="bg-white p-4 rounded-lg border-2 border-dashed border-gray-300">
                                    <h4 class="font-semibold text-gray-700 mb-3 flex items-center">
                                        <span class="text-green-500 ml-2">๐ธ</span>
                                        ุตูุฑ ุจุนุฏ ุงูุชูุธูู
                                    </h4>
                                    <input type="file" id="afterPhotos" multiple accept="image/*,video/*" class="hidden" onchange="handleFileUpload('after', this.files)">
                                    <button type="button" onclick="document.getElementById('afterPhotos').click()" class="w-full bg-green-500 text-white py-3 px-4 rounded-lg hover:bg-green-600 transition-colors flex items-center justify-center">
                                        <span class="ml-2">๐</span>
                                        ุงุฎุชูุงุฑ ุตูุฑ/ููุงุทุน ุจุนุฏ ุงูุชูุธูู
                                    </button>
                                    <div id="afterPhotosPreview" class="mt-3 grid grid-cols-2 gap-2"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Additional Notes -->
                        <div class="bg-gray-50 p-6 rounded-lg">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">ููุงุญุธุงุช ุฅุถุงููุฉ</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ููุงุญุธุงุช ุฅุถุงููุฉ</label>
                                    <textarea id="inspectorNotes" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" placeholder="ุฃู ููุงุญุธุงุช ุฅุถุงููุฉ ุญูู ุงูุทูุจ"></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="flex justify-center">
                            <button type="submit" class="btn-primary text-white px-12 py-4 rounded-lg font-bold text-lg">
                                ุญูุธ ุทูุจ ุงููุนุงููุฉ
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Existing Customer Form -->
            <div id="existing-customer-form" class="hidden">
                <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <span class="text-2xl ml-3">๐ค</span>
                        ุนููู ููุฌูุฏ - ุทูุจ ูุนุงููุฉ ุฌุฏูุฏ
                    </h2>
                    <div id="existing-customer-info" class="bg-gray-50 p-4 rounded-lg mb-6"></div>
                    <div id="area-reminder" class="bg-blue-50 p-4 rounded-lg mb-6"></div>
                    
                    <form id="existingCustomerForm" class="space-y-6">
                        <!-- Address Details -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-gray-700 font-semibold mb-2">ุงูููุทูุฉ *</label>
                                <select id="newArea" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" onchange="updateExistingAddressReview()"
                                    <option value="">ุงุฎุชุฑ ุงูููุทูุฉ</option>
                                    <option value="ุงูุดุงููุฉ">ุงูุดุงููุฉ</option>
                                    <option value="ุจูุงู">ุจูุงู</option>
                                    <option value="ูุดุฑู">ูุดุฑู</option>
                                    <option value="ุญููู">ุญููู</option>
                                    <option value="ุงูุณุงูููุฉ">ุงูุณุงูููุฉ</option>
                                    <option value="ุงูุฌุงุจุฑูุฉ">ุงูุฌุงุจุฑูุฉ</option>
                                    <option value="ุงูุฒูุฑุงุก">ุงูุฒูุฑุงุก</option>
                                    <option value="ุงูุฑููุซูุฉ">ุงูุฑููุซูุฉ</option>
                                    <option value="ุงูุตุฏูู">ุงูุตุฏูู</option>
                                    <option value="ุงูููุทุงุณ">ุงูููุทุงุณ</option>
                                    <option value="ุฃุจู ุญูููุฉ">ุฃุจู ุญูููุฉ</option>
                                    <option value="ุงูููุจููุฉ">ุงูููุจููุฉ</option>
                                    <option value="ุงููุญูุญูู">ุงููุญูุญูู</option>
                                    <option value="ุนูู ุตุจุงุญ ุงูุณุงูู">ุนูู ุตุจุงุญ ุงูุณุงูู</option>
                                    <option value="ุตุจุงุญ ุงูุณุงูู">ุตุจุงุญ ุงูุณุงูู</option>
                                    <option value="ุงูุฃุญูุฏู">ุงูุฃุญูุฏู</option>
                                    <option value="ุงููุฑูุงููุฉ">ุงููุฑูุงููุฉ</option>
                                    <option value="ุงูุฑูุฉ">ุงูุฑูุฉ</option>
                                    <option value="ุงูุฑุงุจูุฉ">ุงูุฑุงุจูุฉ</option>
                                    <option value="ุงูุฃูุฏูุณ">ุงูุฃูุฏูุณ</option>
                                    <option value="ุฅุดุจูููุฉ">ุฅุดุจูููุฉ</option>
                                    <option value="ุงูุถุฌูุฌ">ุงูุถุฌูุฌ</option>
                                    <option value="ุงูุนุงุฑุถูุฉ">ุงูุนุงุฑุถูุฉ</option>
                                    <option value="ุฌููุจ ุงูุดููุฎ">ุฌููุจ ุงูุดููุฎ</option>
                                    <option value="ุงูุฑุญุงุจ">ุงูุฑุญุงุจ</option>
                                    <option value="ุตุจุงุญ ุงููุงุตุฑ">ุตุจุงุญ ุงููุงุตุฑ</option>
                                    <option value="ุงูุตุจุงุญูุฉ">ุงูุตุจุงุญูุฉ</option>
                                    <option value="ูุจุงุฑู ุงููุจูุฑ">ูุจุงุฑู ุงููุจูุฑ</option>
                                    <option value="ุตุจุญุงู">ุตุจุญุงู</option>
                                    <option value="ุฃุจู ูุทูุฑุฉ">ุฃุจู ูุทูุฑุฉ</option>
                                    <option value="ุงููุตูุฑ">ุงููุตูุฑ</option>
                                    <option value="ุงููุฑูู">ุงููุฑูู</option>
                                    <option value="ุงูุนุฏุงู">ุงูุนุฏุงู</option>
                                    <option value="ุงูุฌูุฑุงุก">ุงูุฌูุฑุงุก</option>
                                    <option value="ุชููุงุก">ุชููุงุก</option>
                                    <option value="ุงููุณูู">ุงููุณูู</option>
                                    <option value="ุงููุงุญุฉ">ุงููุงุญุฉ</option>
                                    <option value="ุงูุนููู">ุงูุนููู</option>
                                    <option value="ูุงุธูุฉ">ูุงุธูุฉ</option>
                                    <option value="ุงูุตููุจูุฉ">ุงูุตููุจูุฉ</option>
                                    <option value="ุงูุดุฏุงุฏูุฉ">ุงูุดุฏุงุฏูุฉ</option>
                                    <option value="ุงูุดููุฎ">ุงูุดููุฎ</option>
                                    <option value="ุงูุฏูุญุฉ">ุงูุฏูุญุฉ</option>
                                    <option value="ุงููุฒูุฉ">ุงููุฒูุฉ</option>
                                    <option value="ุงูููุญุงุก">ุงูููุญุงุก</option>
                                    <option value="ุงูุฎุงูุฏูุฉ">ุงูุฎุงูุฏูุฉ</option>
                                    <option value="ุงูุฏุนูุฉ">ุงูุฏุนูุฉ</option>
                                    <option value="ูููุงู">ูููุงู</option>
                                    <option value="ุงูููุตูุฑูุฉ">ุงูููุตูุฑูุฉ</option>
                                    <option value="ุงูุฏุณูุฉ">ุงูุฏุณูุฉ</option>
                                    <option value="ุฏุณูุงู">ุฏุณูุงู</option>
                                    <option value="ุงูุดุฑู">ุงูุดุฑู</option>
                                    <option value="ุงููุฑูุงุจ">ุงููุฑูุงุจ</option>
                                    <option value="ุงููุจูุฉ">ุงููุจูุฉ</option>
                                    <option value="ุงูุตูุงุจุฑ">ุงูุตูุงุจุฑ</option>
                                    <option value="ุงูุฑูุถุฉ">ุงูุฑูุถุฉ</option>
                                    <option value="ุงูุนุฏูููุฉ">ุงูุนุฏูููุฉ</option>
                                    <option value="ูุฑุทุจุฉ">ูุฑุทุจุฉ</option>
                                    <option value="ุงููุฑููู">ุงููุฑููู</option>
                                    <option value="ุบุฑูุงุทุฉ">ุบุฑูุงุทุฉ</option>
                                    <option value="ุงูุตุงูุญูุฉ">ุงูุตุงูุญูุฉ</option>
                                    <option value="ุงูุณุฑุฉ">ุงูุณุฑุฉ</option>
                                    <option value="ุญุทูู">ุญุทูู</option>
                                    <option value="ุงูุดูุฏุงุก">ุงูุดูุฏุงุก</option>
                                    <option value="ุงููุทูุฉ">ุงููุทูุฉ</option>
                                    <option value="ุงูุฒูุฑ">ุงูุฒูุฑ</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-semibold mb-2">ุงููุทุนุฉ</label>
                                <input type="text" id="existingCustomerBlock" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" placeholder="ุฑูู ุงููุทุนุฉ" onkeyup="updateExistingAddressReview()">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-semibold mb-2">ุงูุฌุงุฏุฉ</label>
                                <input type="text" id="existingCustomerAvenue" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" placeholder="ุฑูู ุงูุฌุงุฏุฉ" onkeyup="updateExistingAddressReview()">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-semibold mb-2">ุงูุดุงุฑุน</label>
                                <input type="text" id="existingCustomerStreet" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" placeholder="ุงุณู ุฃู ุฑูู ุงูุดุงุฑุน" onkeyup="updateExistingAddressReview()">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-semibold mb-2">ุฑูู ุงูููุฒู</label>
                                <input type="text" id="existingCustomerHouseNumber" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" placeholder="ุฑูู ุงูููุฒู" onkeyup="updateExistingAddressReview()">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-semibold mb-2">ุงููููุน (ุงุฎุชูุงุฑู)</label>
                                <input type="text" id="existingCustomerLocation" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" placeholder="ุฑุงุจุท ุงููููุน ุฃู ุฅุญุฏุงุซูุงุช GPS">
                            </div>
                        </div>

                        <!-- Address Review Section for Existing Customer -->
                        <div id="existingAddressReview" class="bg-blue-50 p-6 rounded-lg hidden">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <span class="text-lg ml-2">๐</span>
                                ูุฑุงุฌุนุฉ ุงูุนููุงู ุงููุฏุฎู
                            </h3>
                            <div id="existingAddressDisplay" class="bg-white p-4 rounded-lg border-2 border-blue-200">
                                <p class="text-gray-700 font-medium">ุงูุนููุงู ุงููุงูู:</p>
                                <p id="existingFullAddress" class="text-lg font-bold text-blue-800 mt-2"></p>
                            </div>
                        </div>

                        <!-- Same form sections as new customer but without name/phone -->
                        <div class="bg-blue-50 p-6 rounded-lg">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <span class="text-lg ml-2">๐งฝ</span>
                                ุชูุงุตูู ุงูุฎุฏูุฉ ุงููุทููุจุฉ
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ููุน ุงูุฎุฏูุฉ *</label>
                                    <select id="existingServiceType" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" onchange="toggleExistingServiceTypeOther()">
                                        <option value="">ุงุฎุชุฑ ููุน ุงูุฎุฏูุฉ</option>
                                        <option value="ุชูุธูู ุนุงู">ุชูุธูู ุนุงู</option>
                                        <option value="ุชูุธูู ุนููู">ุชูุธูู ุนููู</option>
                                        <option value="ุชูุธูู ุจุนุฏ ุงูุฏูุงู">ุชูุธูู ุจุนุฏ ุงูุฏูุงู</option>
                                        <option value="ุชูุธูู ุงููุทุจุฎ">ุชูุธูู ุงููุทุจุฎ</option>
                                        <option value="ุชูุธูู ุงูุญูุงูุงุช">ุชูุธูู ุงูุญูุงูุงุช</option>
                                        <option value="ุชูุธูู ุงูููุงูุฐ">ุชูุธูู ุงูููุงูุฐ</option>
                                        <option value="ุชูุธูู ุงูุณุฌุงุฏ ูุงูููููุช">ุชูุธูู ุงูุณุฌุงุฏ ูุงูููููุช</option>
                                        <option value="ุชูุธูู ุงูุฃุซุงุซ">ุชูุธูู ุงูุฃุซุงุซ</option>
                                        <option value="ุฃุฎุฑู">ุฃุฎุฑู</option>
                                    </select>
                                    <div id="existingServiceTypeOther" class="hidden mt-2">
                                        <input type="text" id="existingServiceTypeCustom" placeholder="ุญุฏุฏ ููุน ุงูุฎุฏูุฉ" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ููุน ุงูุณูู *</label>
                                    <select id="existingHousingType" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" onchange="toggleExistingHousingTypeOther()">
                                        <option value="">ุงุฎุชุฑ ููุน ุงูุณูู</option>
                                        <option value="ุดูุฉ">ุดูุฉ</option>
                                        <option value="ูููุง">ูููุง</option>
                                        <option value="ุฏูุจููุณ">ุฏูุจููุณ</option>
                                        <option value="ุงุณุชูุฏูู">ุงุณุชูุฏูู</option>
                                        <option value="ุจูุช ุดุนุจู">ุจูุช ุดุนุจู</option>
                                        <option value="ุฃุฎุฑู">ุฃุฎุฑู</option>
                                    </select>
                                    <div id="existingHousingTypeOther" class="hidden mt-2">
                                        <input type="text" id="existingHousingTypeCustom" placeholder="ุญุฏุฏ ููุน ุงูููุงู" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุชุงุฑูุฎ ุงููุนุงููุฉ ุงูููุถู *</label>
                                    <input type="date" id="existingInspectionDate" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ููุช ุงููุนุงููุฉ ุงูููุถู *</label>
                                    <select id="existingInspectionTime" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                        <option value="">ุงุฎุชุฑ ุงูููุช</option>
                                        <option value="ุตุจุงุญุงู (8-12)">ุตุจุงุญุงู (8-12)</option>
                                        <option value="ุธูุฑุงู (12-4)">ุธูุฑุงู (12-4)</option>
                                        <option value="ูุณุงุกู (4-8)">ูุณุงุกู (4-8)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mt-4">
                                <label class="block text-gray-700 font-medium mb-2">ููุงุญุธุงุช ุฅุถุงููุฉ</label>
                                <textarea id="existingServiceNotes" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" placeholder="ุฃู ููุงุญุธุงุช ุฃู ุทูุจุงุช ุฎุงุตุฉ"></textarea>
                            </div>
                        </div>

                        <!-- Customer Approval -->
                        <div class="bg-yellow-50 p-6 rounded-lg">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <span class="text-lg ml-2">โ๏ธ</span>
                                ููุงููุฉ ุงูุนููู ุนูู ุงูุฎุฏูุฉ (ุงุฎุชูุงุฑู - ูููู ุชุญุฏูุฏูุง ูุงุญูุงู)
                            </h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ูู ุงูุนููู ููุงูู ุนูู ุงูุฎุฏูุฉุ</label>
                                    <div class="flex gap-4">
                                        <label class="flex items-center">
                                            <input type="radio" name="existingCustomerApproval" value="ููุงูู" onchange="toggleExistingPaymentSection()" class="ml-2">
                                            <span class="text-green-600 font-semibold">ููุงูู</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="existingCustomerApproval" value="ุบูุฑ ููุงูู" onchange="toggleExistingPaymentSection()" class="ml-2">
                                            <span class="text-red-600 font-semibold">ุบูุฑ ููุงูู</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="existingCustomerApproval" value="ูู ุงูุงูุชุธุงุฑ" onchange="toggleExistingPaymentSection()" class="ml-2" checked>
                                            <span class="text-blue-600 font-semibold">ูู ุงูุงูุชุธุงุฑ</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Rejection Section -->
                                <div id="existing-rejection-section" class="hidden">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-gray-700 font-medium mb-2">ุงูุณุนุฑ ุงูููุชุฑุญ (ุฏููุงุฑ ูููุชู)</label>
                                            <input type="number" id="existingProposedPrice" min="0" step="0.1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 font-medium mb-2">ุณุจุจ ุนุฏู ุงูููุงููุฉ</label>
                                            <select id="existingRejectionReason" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                                <option value="">ุงุฎุชุฑ ุงูุณุจุจ</option>
                                                <option value="ุงูุณุนุฑ ูุฑุชูุน">ุงูุณุนุฑ ูุฑุชูุน</option>
                                                <option value="ูุง ูุญุชุงุฌ ุงูุฎุฏูุฉ ุญุงููุงู">ูุง ูุญุชุงุฌ ุงูุฎุฏูุฉ ุญุงููุงู</option>
                                                <option value="ูุฌุฏ ุฎุฏูุฉ ุฃุฎุฑู">ูุฌุฏ ุฎุฏูุฉ ุฃุฎุฑู</option>
                                                <option value="ุบูุฑ ุฑุงุถู ุนู ุงููุนุงููุฉ">ุบูุฑ ุฑุงุถู ุนู ุงููุนุงููุฉ</option>
                                                <option value="ุฃุณุจุงุจ ุฃุฎุฑู">ุฃุณุจุงุจ ุฃุฎุฑู</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Details (shown only if approved) -->
                        <div id="existing-payment-section" class="bg-green-50 p-6 rounded-lg hidden">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <span class="text-lg ml-2">๐ฐ</span>
                                ูุนูููุงุช ุงูุฏูุน
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุทุฑููุฉ ุงูุฏูุน *</label>
                                    <select id="existingPaymentMethod" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                        <option value="">ุงุฎุชุฑ ุทุฑููุฉ ุงูุฏูุน</option>
                                        <option value="ูุงุด">ูุงุด</option>
                                        <option value="ููุฒุง">ููุฒุง</option>
                                        <option value="ูู ูุช">ูู ูุช</option>
                                        <option value="ุงุจู ุจุงู">ุงุจู ุจุงู</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุงููุจูุบ ุงูููู (ุฏููุงุฑ ูููุชู) *</label>
                                    <input type="number" id="existingTotalAmount" min="0" step="0.1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" onchange="calculateExistingDiscount()">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ูุณุจุฉ ุงูุฎุตู (%)</label>
                                    <input type="number" id="existingDiscountPercentage" min="0" max="100" step="0.1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" onchange="calculateExistingDiscount()">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุงููุจูุบ ุจุนุฏ ุงูุฎุตู</label>
                                    <input type="number" id="existingFinalAmount" readonly class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-700">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุญุงูุฉ ุงูุฏูุน *</label>
                                    <select id="existingPaymentStatus" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                        <option value="ูู ุงูุงูุชุธุงุฑ">ูู ุงูุงูุชุธุงุฑ</option>
                                        <option value="ูุฏููุน">ูุฏููุน</option>
                                        <option value="ูุฏููุน ุฌุฒุฆูุงู">ูุฏููุน ุฌุฒุฆูุงู</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Service Date (shown only if approved) -->
                        <div id="existing-team-section" class="bg-purple-50 p-6 rounded-lg hidden">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <span class="text-lg ml-2">๐</span>
                                ุชุงุฑูุฎ ุชูููุฐ ุงูุฎุฏูุฉ
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-1 gap-4">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุชุงุฑูุฎ ุชูููุฐ ุงูุฎุฏูุฉ</label>
                                    <input type="date" id="existingServiceDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                </div>
                            </div>
                        </div>

                        <!-- Customer Satisfaction Rating -->
                        <div class="bg-orange-50 p-6 rounded-lg">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <span class="text-lg ml-2">โญ</span>
                                ุชูููู ุฑุถุง ุงูุนููู
                            </h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ูุฏู ุฑุถุง ุงูุนููู ุนู ุงููุนุงููุฉ (ูู 1 ุฅูู 5)</label>
                                    <div class="flex items-center gap-2 mb-2">
                                        <span onclick="setExistingRating(1)" class="existing-rating-star" data-rating="1">โญ</span>
                                        <span onclick="setExistingRating(2)" class="existing-rating-star" data-rating="2">โญ</span>
                                        <span onclick="setExistingRating(3)" class="existing-rating-star" data-rating="3">โญ</span>
                                        <span onclick="setExistingRating(4)" class="existing-rating-star" data-rating="4">โญ</span>
                                        <span onclick="setExistingRating(5)" class="existing-rating-star" data-rating="5">โญ</span>
                                        <span id="existing-rating-text" class="mr-4 font-medium text-gray-700"></span>
                                    </div>
                                    <input type="hidden" id="existingCustomerRating" value="">
                                    <div class="text-sm text-gray-600 mt-2">
                                        <div><strong>1 ูุฌูุฉ:</strong> ุบูุฑ ุฑุงุถู ุชูุงูุงู</div>
                                        <div><strong>2 ูุฌูุฉ:</strong> ุบูุฑ ุฑุงุถู</div>
                                        <div><strong>3 ูุฌูุฉ:</strong> ุฑุงุถู ุฅูู ุญุฏ ูุง</div>
                                        <div><strong>4 ูุฌูุฉ:</strong> ุฑุงุถู</div>
                                        <div><strong>5 ูุฌูุฉ:</strong> ุฑุงุถู ุฌุฏุงู</div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ููุงุญุธุฉ ุญูู ุณุจุจ ุงูุชูููู</label>
                                    <textarea id="existingRatingNotes" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" placeholder="ููุงุฐุง ุงุฎุชุงุฑ ุงูุนููู ูุฐุง ุงูุชููููุ"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Photos Section -->
                        <div class="bg-indigo-50 p-6 rounded-lg">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <span class="text-lg ml-2">๐ท</span>
                                ุงูุตูุฑ ูุงูููุงุทุน
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Before Cleaning Photos -->
                                <div class="bg-white p-4 rounded-lg border-2 border-dashed border-gray-300">
                                    <h4 class="font-semibold text-gray-700 mb-3 flex items-center">
                                        <span class="text-red-500 ml-2">๐ธ</span>
                                        ุตูุฑ ูุจู ุงูุชูุธูู
                                    </h4>
                                    <input type="file" id="existingBeforePhotos" multiple accept="image/*,video/*" class="hidden" onchange="handleFileUpload('existingBefore', this.files)">
                                    <button type="button" onclick="document.getElementById('existingBeforePhotos').click()" class="w-full bg-red-500 text-white py-3 px-4 rounded-lg hover:bg-red-600 transition-colors flex items-center justify-center">
                                        <span class="ml-2">๐</span>
                                        ุงุฎุชูุงุฑ ุตูุฑ/ููุงุทุน ูุจู ุงูุชูุธูู
                                    </button>
                                    <div id="existingBeforePhotosPreview" class="mt-3 grid grid-cols-2 gap-2"></div>
                                </div>
                                
                                <!-- After Cleaning Photos -->
                                <div class="bg-white p-4 rounded-lg border-2 border-dashed border-gray-300">
                                    <h4 class="font-semibold text-gray-700 mb-3 flex items-center">
                                        <span class="text-green-500 ml-2">๐ธ</span>
                                        ุตูุฑ ุจุนุฏ ุงูุชูุธูู
                                    </h4>
                                    <input type="file" id="existingAfterPhotos" multiple accept="image/*,video/*" class="hidden" onchange="handleFileUpload('existingAfter', this.files)">
                                    <button type="button" onclick="document.getElementById('existingAfterPhotos').click()" class="w-full bg-green-500 text-white py-3 px-4 rounded-lg hover:bg-green-600 transition-colors flex items-center justify-center">
                                        <span class="ml-2">๐</span>
                                        ุงุฎุชูุงุฑ ุตูุฑ/ููุงุทุน ุจุนุฏ ุงูุชูุธูู
                                    </button>
                                    <div id="existingAfterPhotosPreview" class="mt-3 grid grid-cols-2 gap-2"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Additional Notes -->
                        <div class="bg-gray-50 p-6 rounded-lg">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">ููุงุญุธุงุช ุฅุถุงููุฉ</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ููุงุญุธุงุช ุฅุถุงููุฉ</label>
                                    <textarea id="existingInspectorNotes" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" placeholder="ุฃู ููุงุญุธุงุช ุฅุถุงููุฉ ุญูู ุงูุทูุจ"></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="flex justify-center">
                            <button type="submit" class="btn-primary text-white px-12 py-4 rounded-lg font-bold text-lg">
                                ุญูุธ ุทูุจ ุงููุนุงููุฉ
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Pending Inspections Tab -->
        <div id="pending-inspections-tab" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <span class="text-2xl ml-3">โณ</span>
                    ุงูุทูุจุงุช ุงููุนููุฉ
                </h2>
                <div id="pending-inspections-table"></div>
            </div>
        </div>

        <!-- Completed Inspections Tab -->
        <div id="completed-inspections-tab" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <span class="text-2xl ml-3">โ</span>
                    ุงูุทูุจุงุช ุงูููุชููุฉ
                </h2>
                
                <!-- Filters Section -->
                <div class="bg-gray-50 p-6 rounded-lg mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <span class="text-lg ml-2">๐</span>
                        ููุงุชุฑ ุงูุจุญุซ
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div id="filterInspectionNumberContainer" class="hidden">
                            <label class="block text-gray-700 font-medium mb-2">ุฑูู ุงููุนุงููุฉ</label>
                            <input type="text" id="filterInspectionNumber" placeholder="ุงุจุญุซ ุจุฑูู ุงููุนุงููุฉ" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" onkeyup="filterCompletedInspections()">
                        </div>
                        <div id="filterCustomerIdContainer" class="hidden">
                            <label class="block text-gray-700 font-medium mb-2">ุฑูู ุงูุนููู</label>
                            <input type="text" id="filterCustomerId" placeholder="ุงุจุญุซ ุจุฑูู ุงูุนููู" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" onkeyup="filterCompletedInspections()">
                        </div>
                        <div id="filterCustomerNameContainer" class="hidden">
                            <label class="block text-gray-700 font-medium mb-2">ุงุณู ุงูุนููู</label>
                            <input type="text" id="filterCustomerName" placeholder="ุงุจุญุซ ุจุงุณู ุงูุนููู" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" onkeyup="filterCompletedInspections()">
                        </div>
                        <div id="filterAreaContainer" class="hidden">
                            <label class="block text-gray-700 font-medium mb-2">ุงูููุทูุฉ</label>
                            <select id="filterArea" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" onchange="filterCompletedInspections()">
                                <option value="">ุฌููุน ุงูููุงุทู</option>
                                <option value="ุญููู">ุญููู</option>
                                <option value="ุงูุฃุญูุฏู">ุงูุฃุญูุฏู</option>
                                <option value="ุงููุฑูุงููุฉ">ุงููุฑูุงููุฉ</option>
                                <option value="ูุจุงุฑู ุงููุจูุฑ">ูุจุงุฑู ุงููุจูุฑ</option>
                                <option value="ุงูุฌูุฑุงุก">ุงูุฌูุฑุงุก</option>
                                <option value="ุงูุนุงุตูุฉ">ุงูุนุงุตูุฉ</option>
                            </select>
                        </div>
                        <div id="filterServiceTypeContainer" class="hidden">
                            <label class="block text-gray-700 font-medium mb-2">ููุน ุงูุฎุฏูุฉ</label>
                            <select id="filterServiceType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" onchange="filterCompletedInspections()">
                                <option value="">ุฌููุน ุงูุฎุฏูุงุช</option>
                                <option value="ุชูุธูู ุนุงู">ุชูุธูู ุนุงู</option>
                                <option value="ุชูุธูู ุนููู">ุชูุธูู ุนููู</option>
                                <option value="ุชูุธูู ุจุนุฏ ุงูุฏูุงู">ุชูุธูู ุจุนุฏ ุงูุฏูุงู</option>
                                <option value="ุชูุธูู ุงููุทุจุฎ">ุชูุธูู ุงููุทุจุฎ</option>
                                <option value="ุชูุธูู ุงูุญูุงูุงุช">ุชูุธูู ุงูุญูุงูุงุช</option>
                                <option value="ุชูุธูู ุงูููุงูุฐ">ุชูุธูู ุงูููุงูุฐ</option>
                                <option value="ุชูุธูู ุงูุณุฌุงุฏ ูุงูููููุช">ุชูุธูู ุงูุณุฌุงุฏ ูุงูููููุช</option>
                                <option value="ุชูุธูู ุงูุฃุซุงุซ">ุชูุธูู ุงูุฃุซุงุซ</option>
                            </select>
                        </div>
                        <div id="filterDateFromContainer" class="hidden">
                            <label class="block text-gray-700 font-medium mb-2">ูู ุชุงุฑูุฎ</label>
                            <input type="date" id="filterDateFrom" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" onchange="filterCompletedInspections()">
                        </div>
                        <div id="filterDateToContainer" class="hidden">
                            <label class="block text-gray-700 font-medium mb-2">ุฅูู ุชุงุฑูุฎ</label>
                            <input type="date" id="filterDateTo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" onchange="filterCompletedInspections()">
                        </div>
                        <div id="filterApprovalContainer" class="hidden">
                            <label class="block text-gray-700 font-medium mb-2">ุงูููุงููุฉ</label>
                            <select id="filterApproval" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" onchange="filterCompletedInspections()">
                                <option value="">ุฌููุน ุงูุญุงูุงุช</option>
                                <option value="ููุงูู">ููุงูู</option>
                                <option value="ุบูุฑ ููุงูู">ุบูุฑ ููุงูู</option>
                                <option value="ูู ุงูุงูุชุธุงุฑ">ูู ุงูุงูุชุธุงุฑ</option>
                            </select>
                        </div>
                        <div id="filterRatingContainer" class="hidden">
                            <label class="block text-gray-700 font-medium mb-2">ุงูุชูููู</label>
                            <select id="filterRating" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" onchange="filterCompletedInspections()">
                                <option value="">ุฌููุน ุงูุชููููุงุช</option>
                                <option value="1">1 ูุฌูุฉ</option>
                                <option value="2">2 ูุฌูุฉ</option>
                                <option value="3">3 ูุฌูุฉ</option>
                                <option value="4">4 ูุฌูุฉ</option>
                                <option value="5">5 ูุฌูุฉ</option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-4 flex gap-4">
                        <button onclick="clearFilters()" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors">
                            ูุณุญ ุงูููุงุชุฑ
                        </button>
                    </div>
                </div>
                
                <div id="completed-inspections-table"></div>
                
                <!-- Pagination Controls -->
                <div id="pagination-controls" class="flex justify-center items-center mt-6 space-x-2 hidden">
                    <button id="prevPage" onclick="changePage(-1)" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed">
                        ุงูุณุงุจู
                    </button>
                    <div id="pageInfo" class="mx-4 text-gray-700 font-medium"></div>
                    <button id="nextPage" onclick="changePage(1)" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed">
                        ุงูุชุงูู
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Inspection Details Modal -->
    <div id="inspectionModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto slide-in">
            <div class="p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">ุชูุงุตูู ุงููุนุงููุฉ</h2>
                    <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl">ร</button>
                </div>
                <div id="inspectionDetails"></div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let customers = JSON.parse(localStorage.getItem('customers')) || {};
        let inspections = JSON.parse(localStorage.getItem('inspections')) || [];
        let inspectionCounter = parseInt(localStorage.getItem('inspectionCounter')) || 1000;
        let currentCustomerId = null;
        let uploadedFiles = {
            before: [],
            after: [],
            existingBefore: [],
            existingAfter: []
        };
        let currentEditingInspection = null;
        
        // Pagination variables
        let currentPage = 1;
        const itemsPerPage = 10;
        let filteredCompletedInspections = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setMinDate();
            renderPendingInspections();
            renderCompletedInspections(); // This will show all completed inspections by default
            
            // Style rating stars
            document.querySelectorAll('.rating-star, .existing-rating-star').forEach(star => {
                star.style.fontSize = '1.5rem';
                star.style.color = '#d1d5db';
                star.style.cursor = 'pointer';
                star.style.transition = 'color 0.2s';
            });
        });

        // Handle file uploads
        function handleFileUpload(type, files) {
            uploadedFiles[type] = Array.from(files);
            displayFilePreview(type, files);
        }

        function displayFilePreview(type, files) {
            const previewContainer = document.getElementById(type + 'PhotosPreview');
            previewContainer.innerHTML = '';
            
            Array.from(files).forEach((file, index) => {
                const fileDiv = document.createElement('div');
                fileDiv.className = 'relative bg-gray-100 p-2 rounded-lg';
                
                if (file.type.startsWith('image/')) {
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    img.className = 'w-full h-20 object-cover rounded';
                    fileDiv.appendChild(img);
                } else if (file.type.startsWith('video/')) {
                    const video = document.createElement('video');
                    video.src = URL.createObjectURL(file);
                    video.className = 'w-full h-20 object-cover rounded';
                    video.controls = true;
                    fileDiv.appendChild(video);
                }
                
                const fileName = document.createElement('p');
                fileName.textContent = file.name.length > 15 ? file.name.substring(0, 15) + '...' : file.name;
                fileName.className = 'text-xs text-gray-600 mt-1 text-center';
                fileDiv.appendChild(fileName);
                
                const removeBtn = document.createElement('button');
                removeBtn.innerHTML = 'ร';
                removeBtn.className = 'absolute top-1 right-1 bg-red-500 text-white rounded-full w-5 h-5 text-xs hover:bg-red-600';
                removeBtn.onclick = () => removeFile(type, index);
                fileDiv.appendChild(removeBtn);
                
                previewContainer.appendChild(fileDiv);
            });
        }

        function removeFile(type, index) {
            uploadedFiles[type].splice(index, 1);
            const input = document.getElementById(type + 'Photos');
            const dt = new DataTransfer();
            uploadedFiles[type].forEach(file => dt.items.add(file));
            input.files = dt.files;
            displayFilePreview(type, uploadedFiles[type]);
        }



        function setMinDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('inspectionDate').min = today;
            if (document.getElementById('existingInspectionDate')) {
                document.getElementById('existingInspectionDate').min = today;
            }
        }

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('[id^="tab-"]').forEach(btn => {
                btn.classList.remove('text-blue-600', 'border-b-2', 'border-blue-500', 'bg-blue-50');
                btn.classList.add('text-gray-700');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            document.getElementById(tabName + '-tab').classList.add('fade-in');
            
            // Add active class to selected tab button
            const activeBtn = document.getElementById('tab-' + tabName);
            activeBtn.classList.add('text-blue-600', 'border-b-2', 'border-blue-500', 'bg-blue-50');
            activeBtn.classList.remove('text-gray-700');
        }

        function searchCustomer() {
            const customerNumber = document.getElementById('customerNumber').value.trim();
            
            if (!customerNumber) {
                alert('ูุฑุฌู ุฅุฏุฎุงู ุฑูู ุงูุนููู');
                return;
            }

            // Show customer history first
            showCustomerHistory(customerNumber);
        }

        function createNewInspection() {
            const customerNumber = document.getElementById('customerNumber').value.trim();
            
            if (!customerNumber) {
                alert('ูุฑุฌู ุฅุฏุฎุงู ุฑูู ุงูุนููู ุฃููุงู');
                return;
            }

            if (customers[customerNumber]) {
                // Existing customer
                currentCustomerId = customerNumber;
                showExistingCustomerForm(customerNumber);
            } else {
                // New customer
                currentCustomerId = customerNumber;
                showNewCustomerForm();
            }
        }

        function showCustomerHistory(customerNumber) {
            const customerInspections = inspections.filter(inspection => inspection.customerId === customerNumber);
            const historySection = document.getElementById('customer-history');
            const historyTable = document.getElementById('customer-history-table');
            
            if (customerInspections.length === 0) {
                historyTable.innerHTML = '<p class="text-gray-600 text-center py-4">ูุง ุชูุฌุฏ ุทูุจุงุช ุณุงุจูุฉ ููุฐุง ุงูุนููู</p>';
            } else {
                let tableHTML = `
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse">
                            <thead>
                                <tr class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white">
                                    <th class="border border-gray-300 p-3 text-right">ุฑูู ุงููุนุงููุฉ</th>
                                    <th class="border border-gray-300 p-3 text-right">ุงูููุทูุฉ</th>
                                    <th class="border border-gray-300 p-3 text-right">ููุน ุงูุฎุฏูุฉ</th>
                                    <th class="border border-gray-300 p-3 text-right">ุชุงุฑูุฎ ุงููุนุงููุฉ</th>
                                    <th class="border border-gray-300 p-3 text-right">ุงูููุงููุฉ</th>
                                    <th class="border border-gray-300 p-3 text-right">ุงูุญุงูุฉ</th>
                                    <th class="border border-gray-300 p-3 text-right">ุงูุฅุฌุฑุงุกุงุช</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                customerInspections.forEach(inspection => {
                    let approvalColor = 'text-blue-600';
                    if (inspection.customerApproval === 'ููุงูู') approvalColor = 'text-green-600';
                    else if (inspection.customerApproval === 'ุบูุฑ ููุงูู') approvalColor = 'text-red-600';
                    
                    let statusColor = inspection.status === 'ููุชูู' ? 'text-green-600' : 'text-orange-600';
                    
                    tableHTML += `
                        <tr class="hover:bg-indigo-50 transition-colors">
                            <td class="border border-gray-300 p-3 font-semibold text-indigo-600">${inspection.inspectionNumber}</td>
                            <td class="border border-gray-300 p-3">${inspection.area}</td>
                            <td class="border border-gray-300 p-3">${inspection.serviceType}</td>
                            <td class="border border-gray-300 p-3">${inspection.inspectionDate}</td>
                            <td class="border border-gray-300 p-3 font-semibold ${approvalColor}">${inspection.customerApproval}</td>
                            <td class="border border-gray-300 p-3 font-semibold ${statusColor}">${inspection.status}</td>
                            <td class="border border-gray-300 p-3">
                                <button onclick="viewInspectionDetails('${inspection.inspectionNumber}')" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition-colors">
                                    ุนุฑุถ ุงูุชูุงุตูู
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                tableHTML += '</tbody></table></div>';
                historyTable.innerHTML = tableHTML;
            }
            
            historySection.classList.remove('hidden');
            historySection.classList.add('fade-in');
        }

        function toggleServiceTypeOther() {
            const serviceType = document.getElementById('serviceType').value;
            const otherSection = document.getElementById('serviceTypeOther');
            
            if (serviceType === 'ุฃุฎุฑู') {
                otherSection.classList.remove('hidden');
                document.getElementById('serviceTypeCustom').required = true;
            } else {
                otherSection.classList.add('hidden');
                document.getElementById('serviceTypeCustom').required = false;
                document.getElementById('serviceTypeCustom').value = '';
            }
        }

        function toggleHousingTypeOther() {
            const housingType = document.getElementById('housingType').value;
            const otherSection = document.getElementById('housingTypeOther');
            
            if (housingType === 'ุฃุฎุฑู') {
                otherSection.classList.remove('hidden');
                document.getElementById('housingTypeCustom').required = true;
            } else {
                otherSection.classList.add('hidden');
                document.getElementById('housingTypeCustom').required = false;
                document.getElementById('housingTypeCustom').value = '';
            }
        }

        function toggleExistingServiceTypeOther() {
            const serviceType = document.getElementById('existingServiceType').value;
            const otherSection = document.getElementById('existingServiceTypeOther');
            
            if (serviceType === 'ุฃุฎุฑู') {
                otherSection.classList.remove('hidden');
                document.getElementById('existingServiceTypeCustom').required = true;
            } else {
                otherSection.classList.add('hidden');
                document.getElementById('existingServiceTypeCustom').required = false;
                document.getElementById('existingServiceTypeCustom').value = '';
            }
        }

        function toggleExistingHousingTypeOther() {
            const housingType = document.getElementById('existingHousingType').value;
            const otherSection = document.getElementById('existingHousingTypeOther');
            
            if (housingType === 'ุฃุฎุฑู') {
                otherSection.classList.remove('hidden');
                document.getElementById('existingHousingTypeCustom').required = true;
            } else {
                otherSection.classList.add('hidden');
                document.getElementById('existingHousingTypeCustom').required = false;
                document.getElementById('existingHousingTypeCustom').value = '';
            }
        }

        function showNewCustomerForm() {
            document.getElementById('customer-search').style.display = 'none';
            document.getElementById('new-customer-form').classList.remove('hidden');
            document.getElementById('new-customer-form').classList.add('fade-in');
            
            // Set the customer number in the readonly field
            document.getElementById('newCustomerNumber').value = currentCustomerId;
        }

        function showExistingCustomerForm(customerNumber) {
            const customer = customers[customerNumber];
            const customerInspections = inspections.filter(inspection => inspection.customerId === customerNumber);
            
            document.getElementById('customer-search').style.display = 'none';
            document.getElementById('existing-customer-form').classList.remove('hidden');
            document.getElementById('existing-customer-form').classList.add('fade-in');
            
            // Display customer info (read-only)
            document.getElementById('existing-customer-info').innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div><strong>ุงูุงุณู:</strong> ${customer.name} <span class="text-gray-500">(ุบูุฑ ูุงุจู ููุชุนุฏูู)</span></div>
                    <div><strong>ุฑูู ุงูุฌูุงู:</strong> ${customer.phone} <span class="text-gray-500">(ุบูุฑ ูุงุจู ููุชุนุฏูู)</span></div>
                </div>
            `;
            
            // Show area reminder
            if (customerInspections.length > 0) {
                const lastInspection = customerInspections[customerInspections.length - 1];
                document.getElementById('area-reminder').innerHTML = `
                    <div class="flex items-center">
                        <span class="text-blue-600 ml-2">๐ก</span>
                        <strong>ุชุฐููุฑ:</strong> ุขุฎุฑ ูุนุงููุฉ ูุงูุช ูู ููุทูุฉ <strong>${lastInspection.area}</strong>
                    </div>
                `;
            } else {
                document.getElementById('area-reminder').innerHTML = `
                    <div class="flex items-center">
                        <span class="text-blue-600 ml-2">โน๏ธ</span>
                        <strong>ููุงุญุธุฉ:</strong> ูุฐุง ุฃูู ุทูุจ ูุนุงููุฉ ููุฐุง ุงูุนููู
                    </div>
                `;
            }
            
            // Setup address review listeners after form is shown
            setTimeout(() => {
                setupAddressReviewListeners();
            }, 100);
        }

        function toggleCreateButton() {
            const customerNumber = document.getElementById('customerNumber').value.trim();
            const createButton = document.getElementById('createNewButton');
            
            if (customerNumber) {
                createButton.classList.remove('hidden');
            } else {
                createButton.classList.add('hidden');
            }
        }

        function calculateDiscount() {
            const totalAmount = parseFloat(document.getElementById('totalAmount').value) || 0;
            const discountPercentage = parseFloat(document.getElementById('discountPercentage').value) || 0;
            
            const discountAmount = (totalAmount * discountPercentage) / 100;
            const finalAmount = totalAmount - discountAmount;
            
            document.getElementById('finalAmount').value = finalAmount.toFixed(2);
        }

        function calculateExistingDiscount() {
            const totalAmount = parseFloat(document.getElementById('existingTotalAmount').value) || 0;
            const discountPercentage = parseFloat(document.getElementById('existingDiscountPercentage').value) || 0;
            
            const discountAmount = (totalAmount * discountPercentage) / 100;
            const finalAmount = totalAmount - discountAmount;
            
            document.getElementById('existingFinalAmount').value = finalAmount.toFixed(2);
        }

        function showFilter(filterType) {
            // Hide all filter containers first
            const allContainers = [
                'filterInspectionNumberContainer',
                'filterCustomerIdContainer', 
                'filterCustomerNameContainer',
                'filterAreaContainer',
                'filterServiceTypeContainer',
                'filterDateFromContainer',
                'filterDateToContainer',
                'filterApprovalContainer',
                'filterRatingContainer'
            ];
            
            allContainers.forEach(containerId => {
                document.getElementById(containerId).classList.add('hidden');
            });
            
            // Show the specific filter container
            let containerToShow = '';
            switch(filterType) {
                case 'inspectionNumber':
                    containerToShow = 'filterInspectionNumberContainer';
                    break;
                case 'customerId':
                    containerToShow = 'filterCustomerIdContainer';
                    break;
                case 'customerName':
                    containerToShow = 'filterCustomerNameContainer';
                    break;
                case 'area':
                    containerToShow = 'filterAreaContainer';
                    break;
                case 'serviceType':
                    containerToShow = 'filterServiceTypeContainer';
                    break;
                case 'dateFrom':
                    containerToShow = 'filterDateFromContainer';
                    document.getElementById('filterDateToContainer').classList.remove('hidden');
                    break;
                case 'approval':
                    containerToShow = 'filterApprovalContainer';
                    break;
                case 'rating':
                    containerToShow = 'filterRatingContainer';
                    break;
            }
            
            if (containerToShow) {
                document.getElementById(containerToShow).classList.remove('hidden');
            }
        }

        function togglePaymentSection() {
            const approval = document.querySelector('input[name="customerApproval"]:checked');
            const paymentSection = document.getElementById('payment-section');
            const rejectionSection = document.getElementById('rejection-section');
            const teamSection = document.getElementById('team-section');
            const ratingSection = document.getElementById('rating-section');
            
            if (approval && approval.value === 'ููุงูู') {
                paymentSection.classList.remove('hidden');
                teamSection.classList.remove('hidden');
                rejectionSection.classList.add('hidden');
                ratingSection.classList.remove('hidden');
            } else if (approval && approval.value === 'ุบูุฑ ููุงูู') {
                paymentSection.classList.add('hidden');
                teamSection.classList.add('hidden');
                rejectionSection.classList.remove('hidden');
                ratingSection.classList.add('hidden');
            } else {
                // ูู ุงูุงูุชุธุงุฑ ุฃู ูุง ููุฌุฏ ุงุฎุชูุงุฑ
                paymentSection.classList.add('hidden');
                teamSection.classList.add('hidden');
                rejectionSection.classList.add('hidden');
                ratingSection.classList.add('hidden');
            }
        }

        function toggleRejectionReasonOther() {
            const rejectionReason = document.getElementById('rejectionReason').value;
            const otherSection = document.getElementById('rejectionReasonOther');
            
            if (rejectionReason === 'ุฃุณุจุงุจ ุฃุฎุฑู') {
                otherSection.classList.remove('hidden');
                document.getElementById('rejectionReasonCustom').required = true;
            } else {
                otherSection.classList.add('hidden');
                document.getElementById('rejectionReasonCustom').required = false;
                document.getElementById('rejectionReasonCustom').value = '';
            }
        }

        function toggleExistingPaymentSection() {
            const approval = document.querySelector('input[name="existingCustomerApproval"]:checked');
            const paymentSection = document.getElementById('existing-payment-section');
            const rejectionSection = document.getElementById('existing-rejection-section');
            
            if (approval && approval.value === 'ููุงูู') {
                paymentSection.classList.remove('hidden');
                rejectionSection.classList.add('hidden');
            } else if (approval && approval.value === 'ุบูุฑ ููุงูู') {
                paymentSection.classList.add('hidden');
                rejectionSection.classList.remove('hidden');
            } else {
                // ูู ุงูุงูุชุธุงุฑ ุฃู ูุง ููุฌุฏ ุงุฎุชูุงุฑ
                paymentSection.classList.add('hidden');
                rejectionSection.classList.add('hidden');
            }
        }

        function setRating(rating) {
            document.getElementById('customerRating').value = rating;
            
            // Update star colors
            document.querySelectorAll('.rating-star').forEach((star, index) => {
                if (index < rating) {
                    star.style.color = '#fbbf24';
                } else {
                    star.style.color = '#d1d5db';
                }
            });
            
            // Update rating text
            const ratingTexts = {
                1: 'ุบูุฑ ุฑุงุถู ุชูุงูุงู',
                2: 'ุบูุฑ ุฑุงุถู',
                3: 'ุฑุงุถู ุฅูู ุญุฏ ูุง',
                4: 'ุฑุงุถู',
                5: 'ุฑุงุถู ุฌุฏุงู'
            };
            
            document.getElementById('rating-text').textContent = ratingTexts[rating];
        }

        function setExistingRating(rating) {
            document.getElementById('existingCustomerRating').value = rating;
            
            // Update star colors
            document.querySelectorAll('.existing-rating-star').forEach((star, index) => {
                if (index < rating) {
                    star.style.color = '#fbbf24';
                } else {
                    star.style.color = '#d1d5db';
                }
            });
            
            // Update rating text
            const ratingTexts = {
                1: 'ุบูุฑ ุฑุงุถู ุชูุงูุงู',
                2: 'ุบูุฑ ุฑุงุถู',
                3: 'ุฑุงุถู ุฅูู ุญุฏ ูุง',
                4: 'ุฑุงุถู',
                5: 'ุฑุงุถู ุฌุฏุงู'
            };
            
            document.getElementById('existing-rating-text').textContent = ratingTexts[rating];
        }

        // New customer form submission
        document.getElementById('customerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            try {
                const inspectionNumber = 'ID-' + (++inspectionCounter);
                const approval = document.querySelector('input[name="customerApproval"]:checked');
                
                // Validate required fields
                const customerName = document.getElementById('customerName').value.trim();
                const customerPhone = document.getElementById('customerPhone').value.trim();
                const customerArea = document.getElementById('customerArea').value;
                const serviceType = document.getElementById('serviceType').value;
                const housingType = document.getElementById('housingType').value;
                const inspectionDate = document.getElementById('inspectionDate').value;
                const inspectionTime = document.getElementById('inspectionTime').value;
                
                if (!customerName || !customerPhone || !customerArea || !serviceType || !housingType || !inspectionDate || !inspectionTime) {
                    alert('ูุฑุฌู ููุก ุฌููุน ุงูุญููู ุงููุทููุจุฉ (ุงููุญุฏุฏุฉ ุจุนูุงูุฉ *)');
                    return;
                }
                
                // Save customer data if new
                if (!customers[currentCustomerId]) {
                    customers[currentCustomerId] = {
                        name: customerName,
                        phone: customerPhone,
                        createdAt: new Date().toISOString()
                    };
                }
                
                // Get service type (custom or selected)
                const serviceTypeValue = document.getElementById('serviceType').value;
                const finalServiceType = serviceTypeValue === 'ุฃุฎุฑู' ? (document.getElementById('serviceTypeCustom').value || serviceTypeValue) : serviceTypeValue;
                
                // Get housing type (custom or selected)
                const housingTypeValue = document.getElementById('housingType').value;
                const finalHousingType = housingTypeValue === 'ุฃุฎุฑู' ? (document.getElementById('housingTypeCustom').value || housingTypeValue) : housingTypeValue;

                // Create new inspection
                const newInspection = {
                    inspectionNumber: inspectionNumber,
                    customerId: currentCustomerId,
                    customerName: customerName,
                    customerPhone: customerPhone,
                    area: customerArea,
                    block: document.getElementById('customerBlock').value || '',
                    avenue: document.getElementById('customerAvenue').value || '',
                    street: document.getElementById('customerStreet').value || '',
                    houseNumber: document.getElementById('customerHouseNumber').value || '',
                    location: document.getElementById('customerLocation').value || '',
                    serviceType: finalServiceType,
                    housingType: finalHousingType,
                    inspectionDate: inspectionDate,
                    inspectionTime: inspectionTime,
                    serviceNotes: document.getElementById('serviceNotes').value || '',
                    customerApproval: approval ? approval.value : 'ูู ุงูุงูุชุธุงุฑ',
                    customerRating: document.getElementById('customerRating').value || '',
                    ratingNotes: document.getElementById('ratingNotes').value || '',
                    inspectorNotes: document.getElementById('inspectorNotes').value || '',
                    status: (approval && approval.value === 'ุบูุฑ ููุงูู') ? 'ููุชูู' : 'ูุนูู',
                    createdAt: new Date().toISOString()
                };
                
                // Add approval-specific data
                if (approval && approval.value === 'ููุงูู') {
                    newInspection.paymentMethod = document.getElementById('paymentMethod').value || '';
                    newInspection.totalAmount = document.getElementById('totalAmount').value || '';
                    newInspection.discountPercentage = document.getElementById('discountPercentage').value || '';
                    newInspection.finalAmount = document.getElementById('finalAmount').value || '';
                    newInspection.paymentStatus = document.getElementById('paymentStatus').value || 'ูู ุงูุงูุชุธุงุฑ';
                    newInspection.serviceDate = document.getElementById('serviceDate').value || '';
                } else if (approval && approval.value === 'ุบูุฑ ููุงูู') {
                    newInspection.proposedPrice = document.getElementById('proposedPrice').value || '';
                    newInspection.rejectionReason = document.getElementById('rejectionReason').value || '';
                }
                
                // Add photos data
                newInspection.beforePhotos = uploadedFiles.before ? uploadedFiles.before.map(file => ({
                    name: file.name,
                    size: file.size,
                    type: file.type
                })) : [];
                newInspection.afterPhotos = uploadedFiles.after ? uploadedFiles.after.map(file => ({
                    name: file.name,
                    size: file.size,
                    type: file.type
                })) : [];

                // Add to inspections array
                inspections.push(newInspection);

                // Save to localStorage
                localStorage.setItem('customers', JSON.stringify(customers));
                localStorage.setItem('inspections', JSON.stringify(inspections));
                localStorage.setItem('inspectionCounter', inspectionCounter.toString());
                
                alert(`ุชู ุญูุธ ุทูุจ ุงููุนุงููุฉ ุจูุฌุงุญ!\nุฑูู ุงููุนุงููุฉ: ${inspectionNumber}`);
                
                // Reset form
                resetNewInspectionForm();
                renderPendingInspections();
                renderCompletedInspections();
                
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุญูุธ ุทูุจ ุงููุนุงููุฉ:', error);
                alert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญูุธ ุทูุจ ุงููุนุงููุฉ. ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.');
            }
        });

        // Existing customer form submission
        document.getElementById('existingCustomerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            try {
                const inspectionNumber = 'ID-' + (++inspectionCounter);
                const approval = document.querySelector('input[name="existingCustomerApproval"]:checked');
                
                const customer = customers[currentCustomerId];
                if (!customer) {
                    alert('ุฎุทุฃ: ูู ูุชู ุงูุนุซูุฑ ุนูู ุจูุงูุงุช ุงูุนููู');
                    return;
                }
                
                // Validate required fields
                const newArea = document.getElementById('newArea').value;
                const existingServiceType = document.getElementById('existingServiceType').value;
                const existingHousingType = document.getElementById('existingHousingType').value;
                const existingInspectionDate = document.getElementById('existingInspectionDate').value;
                const existingInspectionTime = document.getElementById('existingInspectionTime').value;
                
                if (!newArea || !existingServiceType || !existingHousingType || !existingInspectionDate || !existingInspectionTime) {
                    alert('ูุฑุฌู ููุก ุฌููุน ุงูุญููู ุงููุทููุจุฉ (ุงููุญุฏุฏุฉ ุจุนูุงูุฉ *)');
                    return;
                }
                
                // Get service type (custom or selected)
                const existingServiceTypeValue = document.getElementById('existingServiceType').value;
                const finalExistingServiceType = existingServiceTypeValue === 'ุฃุฎุฑู' ? (document.getElementById('existingServiceTypeCustom').value || existingServiceTypeValue) : existingServiceTypeValue;
                
                // Get housing type (custom or selected)
                const existingHousingTypeValue = document.getElementById('existingHousingType').value;
                const finalExistingHousingType = existingHousingTypeValue === 'ุฃุฎุฑู' ? (document.getElementById('existingHousingTypeCustom').value || existingHousingTypeValue) : existingHousingTypeValue;
                
                // Create new inspection
                const newInspection = {
                    inspectionNumber: inspectionNumber,
                    customerId: currentCustomerId,
                    customerName: customer.name,
                    customerPhone: customer.phone,
                    area: newArea,
                    block: document.getElementById('existingCustomerBlock').value || '',
                    avenue: document.getElementById('existingCustomerAvenue').value || '',
                    street: document.getElementById('existingCustomerStreet').value || '',
                    houseNumber: document.getElementById('existingCustomerHouseNumber').value || '',
                    location: document.getElementById('existingCustomerLocation').value || '',
                    serviceType: finalExistingServiceType,
                    housingType: finalExistingHousingType,
                    inspectionDate: existingInspectionDate,
                    inspectionTime: existingInspectionTime,
                    serviceNotes: document.getElementById('existingServiceNotes').value || '',
                    customerApproval: approval ? approval.value : 'ูู ุงูุงูุชุธุงุฑ',
                    customerRating: document.getElementById('existingCustomerRating').value || '',
                    ratingNotes: document.getElementById('existingRatingNotes').value || '',
                    inspectorNotes: document.getElementById('existingInspectorNotes').value || '',
                    status: (approval && approval.value === 'ุบูุฑ ููุงูู') ? 'ููุชูู' : 'ูุนูู',
                    createdAt: new Date().toISOString()
                };
                
                // Add approval-specific data
                if (approval && approval.value === 'ููุงูู') {
                    newInspection.paymentMethod = document.getElementById('existingPaymentMethod').value || '';
                    newInspection.totalAmount = document.getElementById('existingTotalAmount').value || '';
                    newInspection.discountPercentage = document.getElementById('existingDiscountPercentage').value || '';
                    newInspection.finalAmount = document.getElementById('existingFinalAmount').value || '';
                    newInspection.paymentStatus = document.getElementById('existingPaymentStatus').value || 'ูู ุงูุงูุชุธุงุฑ';
                    newInspection.serviceDate = document.getElementById('existingServiceDate').value || '';
                } else if (approval && approval.value === 'ุบูุฑ ููุงูู') {
                    newInspection.proposedPrice = document.getElementById('existingProposedPrice').value || '';
                    newInspection.rejectionReason = document.getElementById('existingRejectionReason').value || '';
                }
                
                // Add photos data
                newInspection.beforePhotos = uploadedFiles.existingBefore ? uploadedFiles.existingBefore.map(file => ({
                    name: file.name,
                    size: file.size,
                    type: file.type
                })) : [];
                newInspection.afterPhotos = uploadedFiles.existingAfter ? uploadedFiles.existingAfter.map(file => ({
                    name: file.name,
                    size: file.size,
                    type: file.type
                })) : [];
                
                // Add to inspections array
                inspections.push(newInspection);
                
                // Save to localStorage
                localStorage.setItem('inspections', JSON.stringify(inspections));
                localStorage.setItem('inspectionCounter', inspectionCounter.toString());
                
                alert(`ุชู ุญูุธ ุทูุจ ุงููุนุงููุฉ ุจูุฌุงุญ!\nุฑูู ุงููุนุงููุฉ: ${inspectionNumber}`);
                
                // Reset form
                resetNewInspectionForm();
                renderPendingInspections();
                renderCompletedInspections();
                
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุญูุธ ุทูุจ ุงููุนุงููุฉ:', error);
                alert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญูุธ ุทูุจ ุงููุนุงููุฉ. ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.');
            }
        });

        function resetNewInspectionForm() {
            document.getElementById('customerForm').reset();
            document.getElementById('existingCustomerForm').reset();
            document.getElementById('new-customer-form').classList.add('hidden');
            document.getElementById('existing-customer-form').classList.add('hidden');
            document.getElementById('customer-search').style.display = 'block';
            document.getElementById('customerNumber').value = '';
            currentCustomerId = null;
            
            // Reset sections
            document.getElementById('payment-section').classList.add('hidden');
            document.getElementById('rejection-section').classList.add('hidden');
            document.getElementById('existing-payment-section').classList.add('hidden');
            document.getElementById('existing-rejection-section').classList.add('hidden');
            document.getElementById('customer-history').classList.add('hidden');
            
            // Reset ratings
            document.querySelectorAll('.rating-star, .existing-rating-star').forEach(star => {
                star.style.color = '#d1d5db';
            });
            document.getElementById('rating-text').textContent = '';
            document.getElementById('existing-rating-text').textContent = '';
            
            // Reset uploaded files
            uploadedFiles = {
                before: [],
                after: [],
                existingBefore: [],
                existingAfter: []
            };
            
            // Clear file previews
            ['beforePhotosPreview', 'afterPhotosPreview', 'existingBeforePhotosPreview', 'existingAfterPhotosPreview'].forEach(id => {
                const element = document.getElementById(id);
                if (element) element.innerHTML = '';
            });
        }

        // Filter functions for completed inspections
        function filterCompletedInspections() {
            const filters = {
                inspectionNumber: document.getElementById('filterInspectionNumber').value.toLowerCase(),
                customerId: document.getElementById('filterCustomerId').value.toLowerCase(),
                customerName: document.getElementById('filterCustomerName').value.toLowerCase(),
                area: document.getElementById('filterArea').value,
                serviceType: document.getElementById('filterServiceType').value,
                dateFrom: document.getElementById('filterDateFrom').value,
                dateTo: document.getElementById('filterDateTo').value,
                approval: document.getElementById('filterApproval').value,
                rating: document.getElementById('filterRating').value
            };
            
            renderCompletedInspections(filters);
        }

        function clearFilters() {
            // Clear all filter values
            document.getElementById('filterInspectionNumber').value = '';
            document.getElementById('filterCustomerId').value = '';
            document.getElementById('filterCustomerName').value = '';
            document.getElementById('filterArea').value = '';
            document.getElementById('filterServiceType').value = '';
            document.getElementById('filterDateFrom').value = '';
            document.getElementById('filterDateTo').value = '';
            document.getElementById('filterApproval').value = '';
            document.getElementById('filterRating').value = '';
            
            // Hide all filter containers
            const allContainers = [
                'filterInspectionNumberContainer',
                'filterCustomerIdContainer', 
                'filterCustomerNameContainer',
                'filterAreaContainer',
                'filterServiceTypeContainer',
                'filterDateFromContainer',
                'filterDateToContainer',
                'filterApprovalContainer',
                'filterRatingContainer'
            ];
            
            allContainers.forEach(containerId => {
                document.getElementById(containerId).classList.add('hidden');
            });
            
            renderCompletedInspections();
        }

        function exportFilteredData() {
            const filters = {
                inspectionNumber: document.getElementById('filterInspectionNumber').value.toLowerCase(),
                customerId: document.getElementById('filterCustomerId').value.toLowerCase(),
                customerName: document.getElementById('filterCustomerName').value.toLowerCase(),
                area: document.getElementById('filterArea').value,
                serviceType: document.getElementById('filterServiceType').value,
                dateFrom: document.getElementById('filterDateFrom').value,
                dateTo: document.getElementById('filterDateTo').value,
                approval: document.getElementById('filterApproval').value,
                rating: document.getElementById('filterRating').value
            };
            
            let filteredInspections = inspections.filter(inspection => inspection.status === 'ููุชูู');
            
            // Apply filters
            if (filters.inspectionNumber) {
                filteredInspections = filteredInspections.filter(inspection => 
                    inspection.inspectionNumber.toLowerCase().includes(filters.inspectionNumber)
                );
            }
            if (filters.customerId) {
                filteredInspections = filteredInspections.filter(inspection => 
                    inspection.customerId.toLowerCase().includes(filters.customerId)
                );
            }
            if (filters.customerName) {
                filteredInspections = filteredInspections.filter(inspection => 
                    inspection.customerName.toLowerCase().includes(filters.customerName)
                );
            }
            if (filters.area) {
                filteredInspections = filteredInspections.filter(inspection => 
                    inspection.area === filters.area
                );
            }
            if (filters.serviceType) {
                filteredInspections = filteredInspections.filter(inspection => 
                    inspection.serviceType === filters.serviceType
                );
            }
            if (filters.dateFrom) {
                filteredInspections = filteredInspections.filter(inspection => 
                    inspection.inspectionDate >= filters.dateFrom
                );
            }
            if (filters.dateTo) {
                filteredInspections = filteredInspections.filter(inspection => 
                    inspection.inspectionDate <= filters.dateTo
                );
            }
            if (filters.approval) {
                filteredInspections = filteredInspections.filter(inspection => 
                    inspection.customerApproval === filters.approval
                );
            }
            if (filters.rating) {
                filteredInspections = filteredInspections.filter(inspection => 
                    inspection.customerRating === filters.rating
                );
            }
            
            // Create CSV content
            const csvContent = "data:text/csv;charset=utf-8," + 
                "ุฑูู ุงููุนุงููุฉ,ุฑูู ุงูุนููู,ุงุณู ุงูุนููู,ุงูููุทูุฉ,ููุน ุงูุฎุฏูุฉ,ุชุงุฑูุฎ ุงููุนุงููุฉ,ุงูููุงููุฉ,ุงูุชูููู\n" +
                filteredInspections.map(inspection => 
                    `${inspection.inspectionNumber},${inspection.customerId},${inspection.customerName},${inspection.area},${inspection.serviceType},${inspection.inspectionDate},${inspection.customerApproval},${inspection.customerRating || 'ุบูุฑ ูุญุฏุฏ'}`
                ).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "ุงูุทูุจุงุช_ุงูููุชููุฉ.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Edit inspection function
        function editInspectionDetails(inspectionNumber) {
            const inspection = inspections.find(i => i.inspectionNumber === inspectionNumber);
            if (!inspection) return;
            
            currentEditingInspection = inspectionNumber;
            
            // Create edit modal content
            let editHTML = `
                <div class="space-y-6">
                    <div class="bg-gradient-to-r from-orange-500 to-red-600 text-white p-6 rounded-lg">
                        <h3 class="text-xl font-bold">ุชุนุฏูู ุงููุนุงููุฉ: ${inspection.inspectionNumber}</h3>
                    </div>
                    
                    <form id="editInspectionForm" class="space-y-6">
                        <!-- Customer Info -->
                        <div class="bg-gray-50 p-6 rounded-lg">
                            <h4 class="text-lg font-semibold text-gray-800 mb-4">ุจูุงูุงุช ุงูุนููู</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุงูุงุณู</label>
                                    <input type="text" id="editCustomerName" value="${inspection.customerName}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุฑูู ุงูุฌูุงู</label>
                                    <input type="tel" id="editCustomerPhone" value="${inspection.customerPhone}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุงูููุทูุฉ</label>
                                    <select id="editArea" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                        <option value="ุญููู" ${inspection.area === 'ุญููู' ? 'selected' : ''}>ุญููู</option>
                                        <option value="ุงูุฃุญูุฏู" ${inspection.area === 'ุงูุฃุญูุฏู' ? 'selected' : ''}>ุงูุฃุญูุฏู</option>
                                        <option value="ุงููุฑูุงููุฉ" ${inspection.area === 'ุงููุฑูุงููุฉ' ? 'selected' : ''}>ุงููุฑูุงููุฉ</option>
                                        <option value="ูุจุงุฑู ุงููุจูุฑ" ${inspection.area === 'ูุจุงุฑู ุงููุจูุฑ' ? 'selected' : ''}>ูุจุงุฑู ุงููุจูุฑ</option>
                                        <option value="ุงูุฌูุฑุงุก" ${inspection.area === 'ุงูุฌูุฑุงุก' ? 'selected' : ''}>ุงูุฌูุฑุงุก</option>
                                        <option value="ุงูุนุงุตูุฉ" ${inspection.area === 'ุงูุนุงุตูุฉ' ? 'selected' : ''}>ุงูุนุงุตูุฉ</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Service Details -->
                        <div class="bg-blue-50 p-6 rounded-lg">
                            <h4 class="text-lg font-semibold text-gray-800 mb-4">ุชูุงุตูู ุงูุฎุฏูุฉ</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ููุน ุงูุฎุฏูุฉ</label>
                                    <select id="editServiceType" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" onchange="toggleEditServiceTypeOther()">
                                        <option value="ุชูุธูู ุนุงู" ${inspection.serviceType === 'ุชูุธูู ุนุงู' ? 'selected' : ''}>ุชูุธูู ุนุงู</option>
                                        <option value="ุชูุธูู ุนููู" ${inspection.serviceType === 'ุชูุธูู ุนููู' ? 'selected' : ''}>ุชูุธูู ุนููู</option>
                                        <option value="ุชูุธูู ุจุนุฏ ุงูุฏูุงู" ${inspection.serviceType === 'ุชูุธูู ุจุนุฏ ุงูุฏูุงู' ? 'selected' : ''}>ุชูุธูู ุจุนุฏ ุงูุฏูุงู</option>
                                        <option value="ุชูุธูู ุงููุทุจุฎ" ${inspection.serviceType === 'ุชูุธูู ุงููุทุจุฎ' ? 'selected' : ''}>ุชูุธูู ุงููุทุจุฎ</option>
                                        <option value="ุชูุธูู ุงูุญูุงูุงุช" ${inspection.serviceType === 'ุชูุธูู ุงูุญูุงูุงุช' ? 'selected' : ''}>ุชูุธูู ุงูุญูุงูุงุช</option>
                                        <option value="ุชูุธูู ุงูููุงูุฐ" ${inspection.serviceType === 'ุชูุธูู ุงูููุงูุฐ' ? 'selected' : ''}>ุชูุธูู ุงูููุงูุฐ</option>
                                        <option value="ุชูุธูู ุงูุณุฌุงุฏ ูุงูููููุช" ${inspection.serviceType === 'ุชูุธูู ุงูุณุฌุงุฏ ูุงูููููุช' ? 'selected' : ''}>ุชูุธูู ุงูุณุฌุงุฏ ูุงูููููุช</option>
                                        <option value="ุชูุธูู ุงูุฃุซุงุซ" ${inspection.serviceType === 'ุชูุธูู ุงูุฃุซุงุซ' ? 'selected' : ''}>ุชูุธูู ุงูุฃุซุงุซ</option>
                                        <option value="ุฃุฎุฑู" ${!['ุชูุธูู ุนุงู', 'ุชูุธูู ุนููู', 'ุชูุธูู ุจุนุฏ ุงูุฏูุงู', 'ุชูุธูู ุงููุทุจุฎ', 'ุชูุธูู ุงูุญูุงูุงุช', 'ุชูุธูู ุงูููุงูุฐ', 'ุชูุธูู ุงูุณุฌุงุฏ ูุงูููููุช', 'ุชูุธูู ุงูุฃุซุงุซ'].includes(inspection.serviceType) ? 'selected' : ''}>ุฃุฎุฑู</option>
                                    </select>
                                    <div id="editServiceTypeOther" class="mt-2 ${!['ุชูุธูู ุนุงู', 'ุชูุธูู ุนููู', 'ุชูุธูู ุจุนุฏ ุงูุฏูุงู', 'ุชูุธูู ุงููุทุจุฎ', 'ุชูุธูู ุงูุญูุงูุงุช', 'ุชูุธูู ุงูููุงูุฐ', 'ุชูุธูู ุงูุณุฌุงุฏ ูุงูููููุช', 'ุชูุธูู ุงูุฃุซุงุซ'].includes(inspection.serviceType) ? '' : 'hidden'}">
                                        <input type="text" id="editServiceTypeCustom" value="${!['ุชูุธูู ุนุงู', 'ุชูุธูู ุนููู', 'ุชูุธูู ุจุนุฏ ุงูุฏูุงู', 'ุชูุธูู ุงููุทุจุฎ', 'ุชูุธูู ุงูุญูุงูุงุช', 'ุชูุธูู ุงูููุงูุฐ', 'ุชูุธูู ุงูุณุฌุงุฏ ูุงูููููุช', 'ุชูุธูู ุงูุฃุซุงุซ'].includes(inspection.serviceType) ? inspection.serviceType : ''}" placeholder="ุญุฏุฏ ููุน ุงูุฎุฏูุฉ" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ููุน ุงูุณูู</label>
                                    <select id="editHousingType" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" onchange="toggleEditHousingTypeOther()">
                                        <option value="ุดูุฉ" ${inspection.housingType === 'ุดูุฉ' ? 'selected' : ''}>ุดูุฉ</option>
                                        <option value="ูููุง" ${inspection.housingType === 'ูููุง' ? 'selected' : ''}>ูููุง</option>
                                        <option value="ุฏูุจููุณ" ${inspection.housingType === 'ุฏูุจููุณ' ? 'selected' : ''}>ุฏูุจููุณ</option>
                                        <option value="ุงุณุชูุฏูู" ${inspection.housingType === 'ุงุณุชูุฏูู' ? 'selected' : ''}>ุงุณุชูุฏูู</option>
                                        <option value="ุจูุช ุดุนุจู" ${inspection.housingType === 'ุจูุช ุดุนุจู' ? 'selected' : ''}>ุจูุช ุดุนุจู</option>
                                        <option value="ุฃุฎุฑู" ${!['ุดูุฉ', 'ูููุง', 'ุฏูุจููุณ', 'ุงุณุชูุฏูู', 'ุจูุช ุดุนุจู'].includes(inspection.housingType) ? 'selected' : ''}>ุฃุฎุฑู</option>
                                    </select>
                                    <div id="editHousingTypeOther" class="mt-2 ${!['ุดูุฉ', 'ูููุง', 'ุฏูุจููุณ', 'ุงุณุชูุฏูู', 'ุจูุช ุดุนุจู'].includes(inspection.housingType) ? '' : 'hidden'}">
                                        <input type="text" id="editHousingTypeCustom" value="${!['ุดูุฉ', 'ูููุง', 'ุฏูุจููุณ', 'ุงุณุชูุฏูู', 'ุจูุช ุดุนุจู'].includes(inspection.housingType) ? inspection.housingType : ''}" placeholder="ุญุฏุฏ ููุน ุงูููุงู" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุชุงุฑูุฎ ุงููุนุงููุฉ</label>
                                    <input type="date" id="editInspectionDate" value="${inspection.inspectionDate}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ููุช ุงููุนุงููุฉ</label>
                                    <select id="editInspectionTime" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                        <option value="ุตุจุงุญุงู (8-12)" ${inspection.inspectionTime === 'ุตุจุงุญุงู (8-12)' ? 'selected' : ''}>ุตุจุงุญุงู (8-12)</option>
                                        <option value="ุธูุฑุงู (12-4)" ${inspection.inspectionTime === 'ุธูุฑุงู (12-4)' ? 'selected' : ''}>ุธูุฑุงู (12-4)</option>
                                        <option value="ูุณุงุกู (4-8)" ${inspection.inspectionTime === 'ูุณุงุกู (4-8)' ? 'selected' : ''}>ูุณุงุกู (4-8)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mt-4">
                                <label class="block text-gray-700 font-medium mb-2">ููุงุญุธุงุช ุงูุฎุฏูุฉ</label>
                                <textarea id="editServiceNotes" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">${inspection.serviceNotes || ''}</textarea>
                            </div>
                        </div>
                        
                        <!-- Customer Approval -->
                        <div class="bg-yellow-50 p-6 rounded-lg">
                            <h4 class="text-lg font-semibold text-gray-800 mb-4">ููุงููุฉ ุงูุนููู</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ูู ุงูุนููู ููุงูู ุนูู ุงูุฎุฏูุฉุ</label>
                                    <div class="flex gap-4">
                                        <label class="flex items-center">
                                            <input type="radio" name="editCustomerApproval" value="ููุงูู" onchange="toggleEditPaymentSection()" class="ml-2" ${inspection.customerApproval === 'ููุงูู' ? 'checked' : ''}>
                                            <span class="text-green-600 font-semibold">ููุงูู</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="editCustomerApproval" value="ุบูุฑ ููุงูู" onchange="toggleEditPaymentSection()" class="ml-2" ${inspection.customerApproval === 'ุบูุฑ ููุงูู' ? 'checked' : ''}>
                                            <span class="text-red-600 font-semibold">ุบูุฑ ููุงูู</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="editCustomerApproval" value="ูู ุงูุงูุชุธุงุฑ" onchange="toggleEditPaymentSection()" class="ml-2" ${inspection.customerApproval === 'ูู ุงูุงูุชุธุงุฑ' ? 'checked' : ''}>
                                            <span class="text-blue-600 font-semibold">ูู ุงูุงูุชุธุงุฑ</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Rejection Section -->
                                <div id="edit-rejection-section" class="${inspection.customerApproval === 'ุบูุฑ ููุงูู' ? '' : 'hidden'}">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-gray-700 font-medium mb-2">ุงูุณุนุฑ ุงูููุชุฑุญ (ุฏููุงุฑ ูููุชู)</label>
                                            <input type="number" id="editProposedPrice" value="${inspection.proposedPrice || ''}" min="0" step="0.1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 font-medium mb-2">ุณุจุจ ุนุฏู ุงูููุงููุฉ</label>
                                            <select id="editRejectionReason" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                                <option value="">ุงุฎุชุฑ ุงูุณุจุจ</option>
                                                <option value="ุงูุณุนุฑ ูุฑุชูุน" ${inspection.rejectionReason === 'ุงูุณุนุฑ ูุฑุชูุน' ? 'selected' : ''}>ุงูุณุนุฑ ูุฑุชูุน</option>
                                                <option value="ูุง ูุญุชุงุฌ ุงูุฎุฏูุฉ ุญุงููุงู" ${inspection.rejectionReason === 'ูุง ูุญุชุงุฌ ุงูุฎุฏูุฉ ุญุงููุงู' ? 'selected' : ''}>ูุง ูุญุชุงุฌ ุงูุฎุฏูุฉ ุญุงููุงู</option>
                                                <option value="ูุฌุฏ ุฎุฏูุฉ ุฃุฎุฑู" ${inspection.rejectionReason === 'ูุฌุฏ ุฎุฏูุฉ ุฃุฎุฑู' ? 'selected' : ''}>ูุฌุฏ ุฎุฏูุฉ ุฃุฎุฑู</option>
                                                <option value="ุบูุฑ ุฑุงุถู ุนู ุงููุนุงููุฉ" ${inspection.rejectionReason === 'ุบูุฑ ุฑุงุถู ุนู ุงููุนุงููุฉ' ? 'selected' : ''}>ุบูุฑ ุฑุงุถู ุนู ุงููุนุงููุฉ</option>
                                                <option value="ุฃุณุจุงุจ ุฃุฎุฑู" ${inspection.rejectionReason === 'ุฃุณุจุงุจ ุฃุฎุฑู' ? 'selected' : ''}>ุฃุณุจุงุจ ุฃุฎุฑู</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Payment Details (shown only if approved) -->
                        <div id="edit-payment-section" class="bg-green-50 p-6 rounded-lg ${inspection.customerApproval === 'ููุงูู' ? '' : 'hidden'}">
                            <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <span class="text-lg ml-2">๐ณ</span>
                                ูุนูููุงุช ุงูุฏูุน
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุทุฑููุฉ ุงูุฏูุน *</label>
                                    <select id="editPaymentMethod" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                        <option value="">ุงุฎุชุฑ ุทุฑููุฉ ุงูุฏูุน</option>
                                        <option value="ูุงุด" ${inspection.paymentMethod === 'ูุงุด' ? 'selected' : ''}>ูุงุด</option>
                                        <option value="ููุฒุง" ${inspection.paymentMethod === 'ููุฒุง' ? 'selected' : ''}>ููุฒุง</option>
                                        <option value="ูู ูุช" ${inspection.paymentMethod === 'ูู ูุช' ? 'selected' : ''}>ูู ูุช</option>
                                        <option value="ุงุจู ุจุงู" ${inspection.paymentMethod === 'ุงุจู ุจุงู' ? 'selected' : ''}>ุงุจู ุจุงู</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุงููุจูุบ ุงูููู (ุฏููุงุฑ ูููุชู) *</label>
                                    <input type="number" id="editTotalAmount" value="${inspection.totalAmount || ''}" min="0" step="0.1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" onchange="calculateEditDiscount()">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ูุณุจุฉ ุงูุฎุตู (%)</label>
                                    <input type="number" id="editDiscountPercentage" value="${inspection.discountPercentage || ''}" min="0" max="100" step="0.1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" onchange="calculateEditDiscount()">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุงููุจูุบ ุจุนุฏ ุงูุฎุตู</label>
                                    <input type="number" id="editFinalAmount" value="${inspection.finalAmount || ''}" readonly class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-700">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุญุงูุฉ ุงูุฏูุน *</label>
                                    <select id="editPaymentStatus" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                        <option value="ูู ุงูุงูุชุธุงุฑ" ${inspection.paymentStatus === 'ูู ุงูุงูุชุธุงุฑ' ? 'selected' : ''}>ูู ุงูุงูุชุธุงุฑ</option>
                                        <option value="ูุฏููุน" ${inspection.paymentStatus === 'ูุฏููุน' ? 'selected' : ''}>ูุฏููุน</option>
                                        <option value="ูุฏููุน ุฌุฒุฆูุงู" ${inspection.paymentStatus === 'ูุฏููุน ุฌุฒุฆูุงู' ? 'selected' : ''}>ูุฏููุน ุฌุฒุฆูุงู</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Team Information (shown only if approved) -->
                        <div id="edit-team-section" class="bg-purple-50 p-6 rounded-lg ${inspection.customerApproval === 'ููุงูู' ? '' : 'hidden'}">
                            <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <span class="text-lg ml-2">๐ฅ</span>
                                ูุนูููุงุช ุงููุฑูู
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุงุณู ุงููุฑูู</label>
                                    <input type="text" id="editTeamName" value="${inspection.teamName || ''}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุนุฏุฏ ุงูุนุงููุงุช</label>
                                    <input type="number" id="editWorkersCount" value="${inspection.workersCount || ''}" min="1" max="10" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุชุงุฑูุฎ ุชูููุฐ ุงูุฎุฏูุฉ</label>
                                    <input type="date" id="editServiceDate" value="${inspection.serviceDate || ''}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Customer Satisfaction Rating -->
                        <div class="bg-orange-50 p-6 rounded-lg">
                            <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <span class="text-lg ml-2">โญ</span>
                                ุชูููู ุฑุถุง ุงูุนููู
                            </h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ูุฏู ุฑุถุง ุงูุนููู ุนู ุงููุนุงููุฉ (ูู 1 ุฅูู 5)</label>
                                    <div class="flex items-center gap-2 mb-2">
                                        <span onclick="setEditRating(1)" class="edit-rating-star cursor-pointer text-2xl" data-rating="1">โญ</span>
                                        <span onclick="setEditRating(2)" class="edit-rating-star cursor-pointer text-2xl" data-rating="2">โญ</span>
                                        <span onclick="setEditRating(3)" class="edit-rating-star cursor-pointer text-2xl" data-rating="3">โญ</span>
                                        <span onclick="setEditRating(4)" class="edit-rating-star cursor-pointer text-2xl" data-rating="4">โญ</span>
                                        <span onclick="setEditRating(5)" class="edit-rating-star cursor-pointer text-2xl" data-rating="5">โญ</span>
                                        <span id="edit-rating-text" class="mr-4 font-medium text-gray-700"></span>
                                    </div>
                                    <input type="hidden" id="editCustomerRating" value="${inspection.customerRating || ''}">
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ููุงุญุธุฉ ุญูู ุณุจุจ ุงูุชูููู</label>
                                    <textarea id="editRatingNotes" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" placeholder="ููุงุฐุง ุงุฎุชุงุฑ ุงูุนููู ูุฐุง ุงูุชููููุ">${inspection.ratingNotes || ''}</textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Photos Section -->
                        <div class="bg-indigo-50 p-6 rounded-lg">
                            <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <span class="text-lg ml-2">๐ธ</span>
                                ุงูุตูุฑ ูุงูููุงุทุน
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Before Cleaning Photos -->
                                <div class="bg-white p-4 rounded-lg border-2 border-dashed border-gray-300">
                                    <h5 class="font-semibold text-gray-700 mb-3 flex items-center">
                                        <span class="text-red-500 ml-2">๐ท</span>
                                        ุตูุฑ ูุจู ุงูุชูุธูู
                                    </h5>
                                    <input type="file" id="editBeforePhotos" multiple accept="image/*,video/*" class="hidden" onchange="handleEditFileUpload('editBefore', this.files)">
                                    <button type="button" onclick="document.getElementById('editBeforePhotos').click()" class="w-full bg-red-500 text-white py-3 px-4 rounded-lg hover:bg-red-600 transition-colors flex items-center justify-center">
                                        <span class="ml-2">๐</span>
                                        ุงุฎุชูุงุฑ ุตูุฑ/ููุงุทุน ูุจู ุงูุชูุธูู
                                    </button>
                                    <div id="editBeforePhotosPreview" class="mt-3 grid grid-cols-2 gap-2"></div>
                                </div>
                                
                                <!-- After Cleaning Photos -->
                                <div class="bg-white p-4 rounded-lg border-2 border-dashed border-gray-300">
                                    <h5 class="font-semibold text-gray-700 mb-3 flex items-center">
                                        <span class="text-green-500 ml-2">๐ท</span>
                                        ุตูุฑ ุจุนุฏ ุงูุชูุธูู
                                    </h5>
                                    <input type="file" id="editAfterPhotos" multiple accept="image/*,video/*" class="hidden" onchange="handleEditFileUpload('editAfter', this.files)">
                                    <button type="button" onclick="document.getElementById('editAfterPhotos').click()" class="w-full bg-green-500 text-white py-3 px-4 rounded-lg hover:bg-green-600 transition-colors flex items-center justify-center">
                                        <span class="ml-2">๐</span>
                                        ุงุฎุชูุงุฑ ุตูุฑ/ููุงุทุน ุจุนุฏ ุงูุชูุธูู
                                    </button>
                                    <div id="editAfterPhotosPreview" class="mt-3 grid grid-cols-2 gap-2"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Inspector Notes -->
                        <div class="bg-gray-50 p-6 rounded-lg">
                            <h4 class="text-lg font-semibold text-gray-800 mb-4">ููุงุญุธุงุช ุฅุถุงููุฉ</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ููุงุญุธุงุช ุงููุนุงูู</label>
                                    <textarea id="editInspectorNotes" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" placeholder="ููุงุญุธุงุช ุงููุนุงูู ุญูู ุงููููุน ูุงูุฎุฏูุฉ ุงููุทููุจุฉ">${inspection.inspectorNotes || ''}</textarea>
                                </div>
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุงุณู ุงููุนุงูู</label>
                                    <input type="text" id="editInspectorName" value="${inspection.inspectorName || ''}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" placeholder="ุงุณู ุงูููุธู ุงููุฎุชุต ุจุงููุนุงููุฉ">
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-center gap-4">
                            <button type="submit" class="bg-green-500 text-white px-8 py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors">
                                ุญูุธ ุงูุชุนุฏููุงุช
                            </button>
                            <button type="button" onclick="closeModal()" class="bg-gray-500 text-white px-8 py-3 rounded-lg font-semibold hover:bg-gray-600 transition-colors">
                                ุฅูุบุงุก
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.getElementById('inspectionDetails').innerHTML = editHTML;
            document.getElementById('inspectionModal').classList.remove('hidden');
            
            // Set initial rating display
            if (inspection.customerRating) {
                setEditRating(parseInt(inspection.customerRating));
            }
            
            // Add form submit handler
            document.getElementById('editInspectionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveInspectionEdits();
            });
        }

        function saveInspectionEdits() {
            const inspectionIndex = inspections.findIndex(i => i.inspectionNumber === currentEditingInspection);
            if (inspectionIndex === -1) return;
            
            const approval = document.querySelector('input[name="editCustomerApproval"]:checked').value;
            
            // Get service type (custom or selected)
            const editServiceTypeValue = document.getElementById('editServiceType').value;
            const finalEditServiceType = editServiceTypeValue === 'ุฃุฎุฑู' ? document.getElementById('editServiceTypeCustom').value : editServiceTypeValue;
            
            // Get housing type (custom or selected)
            const editHousingTypeValue = document.getElementById('editHousingType').value;
            const finalEditHousingType = editHousingTypeValue === 'ุฃุฎุฑู' ? document.getElementById('editHousingTypeCustom').value : editHousingTypeValue;
            
            // Update inspection data
            inspections[inspectionIndex].customerName = document.getElementById('editCustomerName').value;
            inspections[inspectionIndex].customerPhone = document.getElementById('editCustomerPhone').value;
            inspections[inspectionIndex].area = document.getElementById('editArea').value;
            inspections[inspectionIndex].serviceType = finalEditServiceType;
            inspections[inspectionIndex].housingType = finalEditHousingType;
            inspections[inspectionIndex].inspectionDate = document.getElementById('editInspectionDate').value;
            inspections[inspectionIndex].inspectionTime = document.getElementById('editInspectionTime').value;
            inspections[inspectionIndex].serviceNotes = document.getElementById('editServiceNotes').value;
            inspections[inspectionIndex].customerApproval = approval;
            inspections[inspectionIndex].customerRating = document.getElementById('editCustomerRating').value;
            inspections[inspectionIndex].ratingNotes = document.getElementById('editRatingNotes').value;
            inspections[inspectionIndex].inspectorName = document.getElementById('editInspectorName').value;
            inspections[inspectionIndex].inspectorNotes = document.getElementById('editInspectorNotes').value;
            
            // Update approval-specific data
            if (approval === 'ููุงูู') {
                inspections[inspectionIndex].paymentMethod = document.getElementById('editPaymentMethod')?.value || '';
                inspections[inspectionIndex].totalAmount = document.getElementById('editTotalAmount')?.value || '';
                inspections[inspectionIndex].discountPercentage = document.getElementById('editDiscountPercentage')?.value || '';
                inspections[inspectionIndex].finalAmount = document.getElementById('editFinalAmount')?.value || '';
                inspections[inspectionIndex].paymentStatus = document.getElementById('editPaymentStatus')?.value || '';
                inspections[inspectionIndex].teamName = document.getElementById('editTeamName')?.value || '';
                inspections[inspectionIndex].workersCount = document.getElementById('editWorkersCount')?.value || '';
                inspections[inspectionIndex].serviceDate = document.getElementById('editServiceDate')?.value || '';
            } else if (approval === 'ุบูุฑ ููุงูู') {
                inspections[inspectionIndex].proposedPrice = document.getElementById('editProposedPrice')?.value || '';
                inspections[inspectionIndex].rejectionReason = document.getElementById('editRejectionReason')?.value || '';
                inspections[inspectionIndex].status = 'ููุชูู';
            }
            
            // Add photos data if available
            if (uploadedFiles.editBefore && uploadedFiles.editBefore.length > 0) {
                inspections[inspectionIndex].beforePhotos = uploadedFiles.editBefore.map(file => ({
                    name: file.name,
                    size: file.size,
                    type: file.type
                }));
            }
            if (uploadedFiles.editAfter && uploadedFiles.editAfter.length > 0) {
                inspections[inspectionIndex].afterPhotos = uploadedFiles.editAfter.map(file => ({
                    name: file.name,
                    size: file.size,
                    type: file.type
                }));
            }
            
            // Update customer data
            const customerId = inspections[inspectionIndex].customerId;
            if (customers[customerId]) {
                customers[customerId].name = document.getElementById('editCustomerName').value;
                customers[customerId].phone = document.getElementById('editCustomerPhone').value;
            }
            
            // Save to localStorage
            localStorage.setItem('customers', JSON.stringify(customers));
            localStorage.setItem('inspections', JSON.stringify(inspections));
            
            alert('ุชู ุญูุธ ุงูุชุนุฏููุงุช ุจูุฌุงุญ!');
            closeModal();
            renderPendingInspections();
            renderCompletedInspections();
        }

        // Helper functions for edit form
        function toggleEditServiceTypeOther() {
            const serviceType = document.getElementById('editServiceType').value;
            const otherSection = document.getElementById('editServiceTypeOther');
            
            if (serviceType === 'ุฃุฎุฑู') {
                otherSection.classList.remove('hidden');
                document.getElementById('editServiceTypeCustom').required = true;
            } else {
                otherSection.classList.add('hidden');
                document.getElementById('editServiceTypeCustom').required = false;
                document.getElementById('editServiceTypeCustom').value = '';
            }
        }

        function toggleEditHousingTypeOther() {
            const housingType = document.getElementById('editHousingType').value;
            const otherSection = document.getElementById('editHousingTypeOther');
            
            if (housingType === 'ุฃุฎุฑู') {
                otherSection.classList.remove('hidden');
                document.getElementById('editHousingTypeCustom').required = true;
            } else {
                otherSection.classList.add('hidden');
                document.getElementById('editHousingTypeCustom').required = false;
                document.getElementById('editHousingTypeCustom').value = '';
            }
        }

        function toggleEditPaymentSection() {
            const approval = document.querySelector('input[name="editCustomerApproval"]:checked');
            const paymentSection = document.getElementById('edit-payment-section');
            const teamSection = document.getElementById('edit-team-section');
            const rejectionSection = document.getElementById('edit-rejection-section');
            
            if (approval && approval.value === 'ููุงูู') {
                paymentSection.classList.remove('hidden');
                teamSection.classList.remove('hidden');
                rejectionSection.classList.add('hidden');
            } else if (approval && approval.value === 'ุบูุฑ ููุงูู') {
                paymentSection.classList.add('hidden');
                teamSection.classList.add('hidden');
                rejectionSection.classList.remove('hidden');
            } else {
                // ูู ุงูุงูุชุธุงุฑ ุฃู ูุง ููุฌุฏ ุงุฎุชูุงุฑ
                paymentSection.classList.add('hidden');
                teamSection.classList.add('hidden');
                rejectionSection.classList.add('hidden');
            }
        }

        function calculateEditDiscount() {
            const totalAmount = parseFloat(document.getElementById('editTotalAmount').value) || 0;
            const discountPercentage = parseFloat(document.getElementById('editDiscountPercentage').value) || 0;
            
            const discountAmount = (totalAmount * discountPercentage) / 100;
            const finalAmount = totalAmount - discountAmount;
            
            document.getElementById('editFinalAmount').value = finalAmount.toFixed(2);
        }

        function setEditRating(rating) {
            document.getElementById('editCustomerRating').value = rating;
            
            // Update star colors
            document.querySelectorAll('.edit-rating-star').forEach((star, index) => {
                if (index < rating) {
                    star.style.color = '#fbbf24';
                } else {
                    star.style.color = '#d1d5db';
                }
            });
            
            // Update rating text
            const ratingTexts = {
                1: 'ุบูุฑ ุฑุงุถู ุชูุงูุงู',
                2: 'ุบูุฑ ุฑุงุถู',
                3: 'ุฑุงุถู ุฅูู ุญุฏ ูุง',
                4: 'ุฑุงุถู',
                5: 'ุฑุงุถู ุฌุฏุงู'
            };
            
            document.getElementById('edit-rating-text').textContent = ratingTexts[rating];
        }

        function handleEditFileUpload(type, files) {
            if (!uploadedFiles[type]) {
                uploadedFiles[type] = [];
            }
            uploadedFiles[type] = Array.from(files);
            displayEditFilePreview(type, files);
        }

        function displayEditFilePreview(type, files) {
            const previewContainer = document.getElementById(type + 'PhotosPreview');
            previewContainer.innerHTML = '';
            
            Array.from(files).forEach((file, index) => {
                const fileDiv = document.createElement('div');
                fileDiv.className = 'relative bg-gray-100 p-2 rounded-lg';
                
                if (file.type.startsWith('image/')) {
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    img.className = 'w-full h-20 object-cover rounded';
                    fileDiv.appendChild(img);
                } else if (file.type.startsWith('video/')) {
                    const video = document.createElement('video');
                    video.src = URL.createObjectURL(file);
                    video.className = 'w-full h-20 object-cover rounded';
                    video.controls = true;
                    fileDiv.appendChild(video);
                }
                
                const fileName = document.createElement('p');
                fileName.textContent = file.name.length > 15 ? file.name.substring(0, 15) + '...' : file.name;
                fileName.className = 'text-xs text-gray-600 mt-1 text-center';
                fileDiv.appendChild(fileName);
                
                const removeBtn = document.createElement('button');
                removeBtn.innerHTML = 'ร';
                removeBtn.className = 'absolute top-1 right-1 bg-red-500 text-white rounded-full w-5 h-5 text-xs hover:bg-red-600';
                removeBtn.onclick = () => removeEditFile(type, index);
                fileDiv.appendChild(removeBtn);
                
                previewContainer.appendChild(fileDiv);
            });
        }

        function removeEditFile(type, index) {
            uploadedFiles[type].splice(index, 1);
            const input = document.getElementById(type + 'Photos');
            const dt = new DataTransfer();
            uploadedFiles[type].forEach(file => dt.items.add(file));
            input.files = dt.files;
            displayEditFilePreview(type, uploadedFiles[type]);
        }

        function renderPendingInspections() {
            const pendingInspections = inspections.filter(inspection => inspection.status === 'ูุนูู')
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)); // ุชุฑุชูุจ ูู ุงูุฃุญุฏุซ ููุฃูุฏู
            const tableContainer = document.getElementById('pending-inspections-table');
            
            if (pendingInspections.length === 0) {
                tableContainer.innerHTML = '<p class="text-gray-600 text-center py-8">ูุง ุชูุฌุฏ ูุนุงููุงุช ูุนููุฉ ุญุงููุงู</p>';
                return;
            }
            
            let tableHTML = `
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-gradient-to-r from-blue-500 to-gray-700 text-white">
                                <th class="border border-gray-300 p-3 text-right text-sm">ุฑูู ุงูุทูุจ</th>
                                <th class="border border-gray-300 p-3 text-right text-sm">ุฑูู ุงูุนููู</th>
                                <th class="border border-gray-300 p-3 text-right text-sm">ุงุณู ุงูุนููู</th>
                                <th class="border border-gray-300 p-3 text-right text-sm">ุงูููุทูุฉ</th>
                                <th class="border border-gray-300 p-3 text-right text-sm">ุงูุนููุงู ุงููุงูู</th>
                                <th class="border border-gray-300 p-3 text-right text-sm">ููุน ุงูุฎุฏูุฉ</th>
                                <th class="border border-gray-300 p-3 text-right text-sm">ุงูุชุงุฑูุฎ</th>
                                <th class="border border-gray-300 p-3 text-right text-sm">ุงูููุงููุฉ</th>
                                <th class="border border-gray-300 p-3 text-right text-sm">ุงูุฅุฌุฑุงุกุงุช</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            pendingInspections.forEach(inspection => {
                let approvalColor = 'text-blue-600';
                if (inspection.customerApproval === 'ููุงูู') approvalColor = 'text-green-600';
                else if (inspection.customerApproval === 'ุบูุฑ ููุงูู') approvalColor = 'text-red-600';
                
                // Determine which date to show
                let displayDate = inspection.inspectionDate;
                if (inspection.customerApproval === 'ููุงูู' && inspection.serviceDate) {
                    displayDate = inspection.serviceDate;
                }
                
                // Build full address
                let addressParts = [];
                if (inspection.area) addressParts.push(inspection.area);
                if (inspection.block) addressParts.push(`ู${inspection.block}`);
                if (inspection.avenue) addressParts.push(`ุฌ${inspection.avenue}`);
                if (inspection.street) addressParts.push(`ุด${inspection.street}`);
                if (inspection.houseNumber) addressParts.push(`ู${inspection.houseNumber}`);
                const fullAddress = addressParts.join(' - ') || 'ุบูุฑ ูุญุฏุฏ';
                
                tableHTML += `
                    <tr class="hover:bg-blue-50 transition-colors">
                        <td class="border border-gray-300 p-3 font-semibold text-blue-600 text-sm">${inspection.inspectionNumber}</td>
                        <td class="border border-gray-300 p-3 text-sm">${inspection.customerId}</td>
                        <td class="border border-gray-300 p-3 text-sm">${inspection.customerName}</td>
                        <td class="border border-gray-300 p-3 text-sm">${inspection.area}</td>
                        <td class="border border-gray-300 p-3 text-sm" title="${fullAddress}">${fullAddress.length > 30 ? fullAddress.substring(0, 30) + '...' : fullAddress}</td>
                        <td class="border border-gray-300 p-3 text-sm">${inspection.serviceType}</td>
                        <td class="border border-gray-300 p-3 text-sm">${displayDate}</td>
                        <td class="border border-gray-300 p-3 font-semibold ${approvalColor} text-sm">${inspection.customerApproval}</td>
                        <td class="border border-gray-300 p-3">
                            <button onclick="editInspectionDetails('${inspection.inspectionNumber}')" class="bg-blue-500 text-white px-2 py-1 rounded text-xs hover:bg-blue-600 ml-1 transition-colors">
                                ุชุนุฏูู
                            </button>
                            <button onclick="viewInspectionDetails('${inspection.inspectionNumber}')" class="bg-gray-600 text-white px-2 py-1 rounded text-xs hover:bg-gray-700 ml-1 transition-colors">
                                ุนุฑุถ ุงูุชูุงุตูู
                            </button>
                            <button onclick="completeInspection('${inspection.inspectionNumber}')" class="bg-gray-800 text-white px-2 py-1 rounded text-xs hover:bg-gray-900 transition-colors">
                                ุชู ุงูุชูุงุก ุงูุทูุจ
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tableHTML += '</tbody></table></div>';
            tableContainer.innerHTML = tableHTML;
        }

        function renderCompletedInspections(filters = null) {
            let completedInspections = inspections.filter(inspection => inspection.status === 'ููุชูู')
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)); // ุชุฑุชูุจ ูู ุงูุฃุญุฏุซ ููุฃูุฏู
            
            // Apply filters if provided
            if (filters) {
                if (filters.inspectionNumber) {
                    completedInspections = completedInspections.filter(inspection => 
                        inspection.inspectionNumber.toLowerCase().includes(filters.inspectionNumber)
                    );
                }
                if (filters.customerId) {
                    completedInspections = completedInspections.filter(inspection => 
                        inspection.customerId.toLowerCase().includes(filters.customerId)
                    );
                }
                if (filters.customerName) {
                    completedInspections = completedInspections.filter(inspection => 
                        inspection.customerName.toLowerCase().includes(filters.customerName)
                    );
                }
                if (filters.area) {
                    completedInspections = completedInspections.filter(inspection => 
                        inspection.area === filters.area
                    );
                }
                if (filters.serviceType) {
                    completedInspections = completedInspections.filter(inspection => 
                        inspection.serviceType === filters.serviceType
                    );
                }
                if (filters.dateFrom) {
                    completedInspections = completedInspections.filter(inspection => 
                        inspection.inspectionDate >= filters.dateFrom
                    );
                }
                if (filters.dateTo) {
                    completedInspections = completedInspections.filter(inspection => 
                        inspection.inspectionDate <= filters.dateTo
                    );
                }
                if (filters.approval) {
                    completedInspections = completedInspections.filter(inspection => 
                        inspection.customerApproval === filters.approval
                    );
                }
                if (filters.rating) {
                    completedInspections = completedInspections.filter(inspection => 
                        inspection.customerRating === filters.rating
                    );
                }
            }
            
            // Store filtered results for pagination
            filteredCompletedInspections = completedInspections;
            
            const tableContainer = document.getElementById('completed-inspections-table');
            const paginationControls = document.getElementById('pagination-controls');
            
            if (completedInspections.length === 0) {
                tableContainer.innerHTML = '<p class="text-gray-600 text-center py-8">ูุง ุชูุฌุฏ ูุนุงููุงุช ููุชููุฉ</p>';
                paginationControls.classList.add('hidden');
                return;
            }
            
            // Calculate pagination
            const totalPages = Math.ceil(completedInspections.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedInspections = completedInspections.slice(startIndex, endIndex);
            
            // Show/hide pagination controls
            if (totalPages > 1) {
                paginationControls.classList.remove('hidden');
                updatePaginationControls(totalPages);
            } else {
                paginationControls.classList.add('hidden');
            }
            
            let tableHTML = `
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse text-sm">
                        <thead>
                            <tr class="bg-gradient-to-r from-green-500 to-teal-600 text-white">
                                <th class="border border-gray-300 p-2 text-right cursor-pointer hover:bg-green-600 text-xs" onclick="showFilter('inspectionNumber')">ุฑูู ุงููุนุงููุฉ</th>
                                <th class="border border-gray-300 p-2 text-right cursor-pointer hover:bg-green-600 text-xs" onclick="showFilter('customerId')">ุฑูู ุงูุนููู</th>
                                <th class="border border-gray-300 p-2 text-right cursor-pointer hover:bg-green-600 text-xs" onclick="showFilter('customerName')">ุงุณู ุงูุนููู</th>
                                <th class="border border-gray-300 p-2 text-right cursor-pointer hover:bg-green-600 text-xs" onclick="showFilter('area')">ุงูููุทูุฉ</th>
                                <th class="border border-gray-300 p-2 text-right cursor-pointer hover:bg-green-600 text-xs">ุงูุนููุงู ุงููุงูู</th>
                                <th class="border border-gray-300 p-2 text-right cursor-pointer hover:bg-green-600 text-xs" onclick="showFilter('serviceType')">ููุน ุงูุฎุฏูุฉ</th>
                                <th class="border border-gray-300 p-2 text-right cursor-pointer hover:bg-green-600 text-xs" onclick="showFilter('dateFrom')">ุชุงุฑูุฎ ุงููุนุงููุฉ</th>
                                <th class="border border-gray-300 p-2 text-right cursor-pointer hover:bg-green-600 text-xs" onclick="showFilter('approval')">ุงูููุงููุฉ</th>
                                <th class="border border-gray-300 p-2 text-right cursor-pointer hover:bg-green-600 text-xs">ุงูุณุนุฑ ุงูุฅุฌูุงูู</th>
                                <th class="border border-gray-300 p-2 text-right cursor-pointer hover:bg-green-600 text-xs" onclick="showFilter('rating')">ุงูุชูููู</th>
                                <th class="border border-gray-300 p-2 text-right text-xs">ุงูุฅุฌุฑุงุกุงุช</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            paginatedInspections.forEach(inspection => {
                let approvalColor = 'text-blue-600';
                if (inspection.customerApproval === 'ููุงูู') approvalColor = 'text-green-600';
                else if (inspection.customerApproval === 'ุบูุฑ ููุงูู') approvalColor = 'text-red-600';
                
                const ratingStars = 'โญ'.repeat(parseInt(inspection.customerRating) || 0);
                
                // Calculate final price
                let finalPrice = 'ุบูุฑ ูุญุฏุฏ';
                if (inspection.customerApproval === 'ููุงูู' && inspection.finalAmount) {
                    finalPrice = inspection.finalAmount + ' ุฏ.ู';
                } else if (inspection.customerApproval === 'ููุงูู' && inspection.totalAmount) {
                    finalPrice = inspection.totalAmount + ' ุฏ.ู';
                } else if (inspection.proposedPrice) {
                    finalPrice = inspection.proposedPrice + ' ุฏ.ู';
                }
                
                // Build full address
                let addressParts = [];
                if (inspection.area) addressParts.push(inspection.area);
                if (inspection.block) addressParts.push(`ู${inspection.block}`);
                if (inspection.avenue) addressParts.push(`ุฌ${inspection.avenue}`);
                if (inspection.street) addressParts.push(`ุด${inspection.street}`);
                if (inspection.houseNumber) addressParts.push(`ู${inspection.houseNumber}`);
                const fullAddress = addressParts.join(' - ') || 'ุบูุฑ ูุญุฏุฏ';
                
                tableHTML += `
                    <tr class="hover:bg-green-50 transition-colors">
                        <td class="border border-gray-300 p-2 font-semibold text-green-600 text-xs">${inspection.inspectionNumber}</td>
                        <td class="border border-gray-300 p-2 text-xs">${inspection.customerId}</td>
                        <td class="border border-gray-300 p-2 text-xs">${inspection.customerName}</td>
                        <td class="border border-gray-300 p-2 text-xs">${inspection.area}</td>
                        <td class="border border-gray-300 p-2 text-xs" title="${fullAddress}">${fullAddress.length > 25 ? fullAddress.substring(0, 25) + '...' : fullAddress}</td>
                        <td class="border border-gray-300 p-2 text-xs">${inspection.serviceType}</td>
                        <td class="border border-gray-300 p-2 text-xs">${inspection.inspectionDate}</td>
                        <td class="border border-gray-300 p-2 font-semibold ${approvalColor} text-xs">${inspection.customerApproval}</td>
                        <td class="border border-gray-300 p-2 text-xs font-semibold">${finalPrice}</td>
                        <td class="border border-gray-300 p-2 text-xs">${ratingStars} (${inspection.customerRating || 'ุบูุฑ ูุญุฏุฏ'})</td>
                        <td class="border border-gray-300 p-2">
                            <button onclick="viewInspectionDetails('${inspection.inspectionNumber}')" class="bg-blue-500 text-white px-2 py-1 rounded text-xs hover:bg-blue-600 transition-colors">
                                ุนุฑุถ ุงูุชูุงุตูู
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tableHTML += '</tbody></table></div>';
            tableContainer.innerHTML = tableHTML;
        }
        
        function updatePaginationControls(totalPages) {
            document.getElementById('pageInfo').textContent = `ุตูุญุฉ ${currentPage} ูู ${totalPages}`;
            
            const prevBtn = document.getElementById('prevPage');
            const nextBtn = document.getElementById('nextPage');
            
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;
            
            if (prevBtn.disabled) {
                prevBtn.classList.add('bg-gray-300', 'cursor-not-allowed');
                prevBtn.classList.remove('bg-blue-500', 'hover:bg-blue-600');
            } else {
                prevBtn.classList.remove('bg-gray-300', 'cursor-not-allowed');
                prevBtn.classList.add('bg-blue-500', 'hover:bg-blue-600');
            }
            
            if (nextBtn.disabled) {
                nextBtn.classList.add('bg-gray-300', 'cursor-not-allowed');
                nextBtn.classList.remove('bg-blue-500', 'hover:bg-blue-600');
            } else {
                nextBtn.classList.remove('bg-gray-300', 'cursor-not-allowed');
                nextBtn.classList.add('bg-blue-500', 'hover:bg-blue-600');
            }
        }
        
        function changePage(direction) {
            const totalPages = Math.ceil(filteredCompletedInspections.length / itemsPerPage);
            const newPage = currentPage + direction;
            
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                renderCompletedInspections();
            }
        }

        function viewInspectionDetails(inspectionNumber) {
            const inspection = inspections.find(i => i.inspectionNumber === inspectionNumber);
            if (!inspection) return;
            
            const ratingStars = 'โญ'.repeat(parseInt(inspection.customerRating) || 0);
            const ratingTexts = {
                1: 'ุบูุฑ ุฑุงุถู ุชูุงูุงู',
                2: 'ุบูุฑ ุฑุงุถู',
                3: 'ุฑุงุถู ุฅูู ุญุฏ ูุง',
                4: 'ุฑุงุถู',
                5: 'ุฑุงุถู ุฌุฏุงู'
            };
            
            let detailsHTML = `
                <div class="space-y-6">
                    <!-- Inspection Header -->
                    <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-lg">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div><strong>ุฑูู ุงููุนุงููุฉ:</strong> ${inspection.inspectionNumber}</div>
                            <div><strong>ุฑูู ุงูุนููู:</strong> ${inspection.customerId}</div>
                            <div><strong>ุงูุญุงูุฉ:</strong> 
                                <span class="px-2 py-1 rounded-full text-xs ${inspection.status === 'ููุชูู' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                                    ${inspection.status}
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Customer Info -->
                    <div class="bg-gray-50 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">ุจูุงูุงุช ุงูุนููู</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div><strong>ุงูุงุณู:</strong> ${inspection.customerName}</div>
                            <div><strong>ุฑูู ุงูุฌูุงู:</strong> ${inspection.customerPhone}</div>
                            <div><strong>ุงูููุทูุฉ:</strong> ${inspection.area}</div>
                        </div>
                        <div class="mt-4">
                            <strong>ุงูุนููุงู ุงููุงูู:</strong> 
                            <div class="bg-white p-3 rounded-lg border mt-2">
                                ${(() => {
                                    let addressParts = [];
                                    if (inspection.area) addressParts.push(`ุงูููุทูุฉ: ${inspection.area}`);
                                    if (inspection.block) addressParts.push(`ุงููุทุนุฉ: ${inspection.block}`);
                                    if (inspection.avenue) addressParts.push(`ุงูุฌุงุฏุฉ: ${inspection.avenue}`);
                                    if (inspection.street) addressParts.push(`ุงูุดุงุฑุน: ${inspection.street}`);
                                    if (inspection.houseNumber) addressParts.push(`ุฑูู ุงูููุฒู: ${inspection.houseNumber}`);
                                    if (inspection.location) addressParts.push(`ุงููููุน: ${inspection.location}`);
                                    return addressParts.join(' - ') || 'ุบูุฑ ูุญุฏุฏ';
                                })()}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Service Details -->
                    <div class="bg-blue-50 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">ุชูุงุตูู ุงูุฎุฏูุฉ</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div><strong>ููุน ุงูุฎุฏูุฉ:</strong> ${inspection.serviceType}</div>
                            <div><strong>ููุน ุงูุณูู:</strong> ${inspection.housingType}</div>
                            <div><strong>ุชุงุฑูุฎ ุงููุนุงููุฉ:</strong> ${inspection.inspectionDate}</div>
                            <div><strong>ููุช ุงููุนุงููุฉ:</strong> ${inspection.inspectionTime}</div>
                        </div>
                        ${inspection.serviceNotes ? `<div class="mt-4"><strong>ููุงุญุธุงุช ุงูุฎุฏูุฉ:</strong> ${inspection.serviceNotes}</div>` : ''}
                    </div>
                    
                    <!-- Customer Approval -->
                    <div class="bg-yellow-50 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">ููุงููุฉ ุงูุนููู</h3>
                        <div class="mb-4">
                            <strong>ุงูููุงููุฉ:</strong> 
                            <span class="font-semibold ${inspection.customerApproval === 'ููุงูู' ? 'text-green-600' : 'text-red-600'}">
                                ${inspection.customerApproval}
                            </span>
                        </div>
            `;
            
            if (inspection.customerApproval === 'ููุงูู') {
                detailsHTML += `
                    <!-- Payment Info -->
                    <div class="bg-green-50 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">ูุนูููุงุช ุงูุฏูุน</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div><strong>ุทุฑููุฉ ุงูุฏูุน:</strong> ${inspection.paymentMethod || 'ุบูุฑ ูุญุฏุฏ'}</div>
                            <div><strong>ุงููุจูุบ ุงูููู:</strong> ${inspection.totalAmount || 'ุบูุฑ ูุญุฏุฏ'} ุฏููุงุฑ ูููุชู</div>
                            <div><strong>ุญุงูุฉ ุงูุฏูุน:</strong> ${inspection.paymentStatus || 'ุบูุฑ ูุญุฏุฏ'}</div>
                        </div>
                    </div>
                    
                    <!-- Team Info -->
                    <div class="bg-purple-50 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">ูุนูููุงุช ุงููุฑูู</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div><strong>ุงุณู ุงููุฑูู:</strong> ${inspection.teamName || 'ุบูุฑ ูุญุฏุฏ'}</div>
                            <div><strong>ุนุฏุฏ ุงูุนุงููุงุช:</strong> ${inspection.workersCount || 'ุบูุฑ ูุญุฏุฏ'}</div>
                            <div><strong>ุชุงุฑูุฎ ุชูููุฐ ุงูุฎุฏูุฉ:</strong> ${inspection.serviceDate || 'ุบูุฑ ูุญุฏุฏ'}</div>
                        </div>
                    </div>
                `;
            } else {
                detailsHTML += `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><strong>ุงูุณุนุฑ ุงูููุชุฑุญ:</strong> ${inspection.proposedPrice || 'ุบูุฑ ูุญุฏุฏ'} ุฏููุงุฑ ูููุชู</div>
                        <div><strong>ุณุจุจ ุนุฏู ุงูููุงููุฉ:</strong> ${inspection.rejectionReason || 'ุบูุฑ ูุญุฏุฏ'}</div>
                    </div>
                `;
            }
            
            detailsHTML += `
                    </div>
                    
                    <!-- Customer Rating -->
                    <div class="bg-orange-50 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">ุชูููู ุงูุนููู</h3>
                        <div class="space-y-4">
                            <div><strong>ุงูุชูููู:</strong> ${ratingStars} (${inspection.customerRating || 'ุบูุฑ ูุญุฏุฏ'}/5) - ${ratingTexts[inspection.customerRating] || 'ุบูุฑ ูุญุฏุฏ'}</div>
                            ${inspection.ratingNotes ? `<div><strong>ููุงุญุธุฉ ุงูุชูููู:</strong> ${inspection.ratingNotes}</div>` : ''}
                        </div>
                    </div>
                    
                    <!-- Inspector Notes -->
                    <div class="bg-gray-50 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">ููุงุญุธุงุช ุงููุนุงูู</h3>
                        <div class="space-y-4">
                            <div><strong>ุงุณู ุงููุนุงูู:</strong> ${inspection.inspectorName || 'ุบูุฑ ูุญุฏุฏ'}</div>
                            ${inspection.inspectorNotes ? `<div><strong>ููุงุญุธุงุช ุงููุนุงูู:</strong> ${inspection.inspectorNotes}</div>` : ''}
                        </div>
                    </div>
                    
                    <!-- Photos and Videos -->
                    <div class="bg-indigo-50 p-6 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">ุงูุตูุฑ ูุงูููุงุทุน</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="text-center">
                                <h4 class="font-semibold text-gray-700 mb-3">ุตูุฑ ูุจู ุงูุชูุธูู</h4>
                                ${inspection.beforePhotos && inspection.beforePhotos.length > 0 ? 
                                    `<button onclick="showPhotos('before', '${inspection.inspectionNumber}')" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors">
                                        ุนุฑุถ ูุจู ุงูุชูุธูู (${inspection.beforePhotos.length})
                                    </button>` : 
                                    '<p class="text-gray-500">ูุง ููุฌุฏ ุฃู ููุทุน ููุฎุฏูุฉ</p>'
                                }
                            </div>
                            <div class="text-center">
                                <h4 class="font-semibold text-gray-700 mb-3">ุตูุฑ ุจุนุฏ ุงูุชูุธูู</h4>
                                ${inspection.afterPhotos && inspection.afterPhotos.length > 0 ? 
                                    `<button onclick="showPhotos('after', '${inspection.inspectionNumber}')" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
                                        ุนุฑุถ ุจุนุฏ ุงูุชูุธูู (${inspection.afterPhotos.length})
                                    </button>` : 
                                    '<p class="text-gray-500">ูุง ููุฌุฏ ุฃู ููุทุน ููุฎุฏูุฉ</p>'
                                }
                            </div>
                        </div>
                    </div>
                    
                    ${inspection.status === 'ููุชูู' ? `
                    <!-- Move to Pending Button (Only for completed inspections) -->
                    <div class="bg-yellow-50 p-6 rounded-lg text-center">
                        <button onclick="moveToPending('${inspection.inspectionNumber}')" class="bg-orange-500 text-white px-8 py-3 rounded-lg font-semibold hover:bg-orange-600 transition-colors">
                            ูุถุน ุญุงูุฉ ุงูุทูุจ ูู ุงูุทูุจุงุช ุงููุนููุฉ ูุชุนุฏููู
                        </button>
                    </div>` : ''}
                </div>
            `;
            
            document.getElementById('inspectionDetails').innerHTML = detailsHTML;
            document.getElementById('inspectionModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('inspectionModal').classList.add('hidden');
        }



        function completeInspection(inspectionNumber) {
            if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุฅููุงู ูุฐู ุงููุนุงููุฉุ')) {
                const inspectionIndex = inspections.findIndex(inspection => inspection.inspectionNumber === inspectionNumber);
                if (inspectionIndex !== -1) {
                    inspections[inspectionIndex].status = 'ููุชูู';
                    inspections[inspectionIndex].completedAt = new Date().toISOString();
                    localStorage.setItem('inspections', JSON.stringify(inspections));
                    renderPendingInspections();
                    renderCompletedInspections();
                    alert('ุชู ุฅููุงู ุงููุนุงููุฉ ุจูุฌุงุญ!');
                }
            }
        }



        // Show photos function
        function showPhotos(type, inspectionNumber) {
            alert(`ุนุฐุฑุงูุ ุนุฑุถ ุงูุตูุฑ ูุงูููุงุทุน ุบูุฑ ูุชุงุญ ุญุงููุงู ูู ูุฐุง ุงููููุฐุฌ ุงูุชุฌุฑูุจู.\nุณูุชู ุฅุถุงูุฉ ูุฐู ุงูููุฒุฉ ูู ุงููุณุฎุฉ ุงููุงููุฉ.`);
        }

        // Move inspection to pending
        function moveToPending(inspectionNumber) {
            if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ููู ูุฐุง ุงูุทูุจ ุฅูู ุงูุทูุจุงุช ุงููุนููุฉุ\nุณูุชููู ูู ุชุนุฏููู ูุฑุฉ ุฃุฎุฑู.')) {
                const inspectionIndex = inspections.findIndex(inspection => inspection.inspectionNumber === inspectionNumber);
                if (inspectionIndex !== -1) {
                    inspections[inspectionIndex].status = 'ูุนูู';
                    localStorage.setItem('inspections', JSON.stringify(inspections));
                    renderPendingInspections();
                    renderCompletedInspections();
                    closeModal();
                    alert('ุชู ููู ุงูุทูุจ ุฅูู ุงูุทูุจุงุช ุงููุนููุฉ ุจูุฌุงุญ!\nููููู ุงูุขู ุชุนุฏููู ูู ุชุจููุจ ุงูุทูุจุงุช ุงููุนููุฉ.');
                }
            }
        }

        // Address review functions
        function updateAddressReview() {
            const area = document.getElementById('customerArea').value;
            const block = document.getElementById('customerBlock').value;
            const avenue = document.getElementById('customerAvenue').value;
            const street = document.getElementById('customerStreet').value;
            const houseNumber = document.getElementById('customerHouseNumber').value;
            
            if (area || block || avenue || street || houseNumber) {
                let addressParts = [];
                
                if (area) addressParts.push(`ุงูููุทูุฉ: ${area}`);
                if (block) addressParts.push(`ุงููุทุนุฉ: ${block}`);
                if (avenue) addressParts.push(`ุงูุฌุงุฏุฉ: ${avenue}`);
                if (street) addressParts.push(`ุงูุดุงุฑุน: ${street}`);
                if (houseNumber) addressParts.push(`ุฑูู ุงูููุฒู: ${houseNumber}`);
                
                const fullAddress = addressParts.join(' - ');
                document.getElementById('fullAddress').textContent = fullAddress;
                document.getElementById('addressReview').classList.remove('hidden');
            } else {
                document.getElementById('addressReview').classList.add('hidden');
            }
        }

        function updateExistingAddressReview() {
            const area = document.getElementById('newArea').value;
            const block = document.getElementById('existingCustomerBlock').value;
            const avenue = document.getElementById('existingCustomerAvenue').value;
            const street = document.getElementById('existingCustomerStreet').value;
            const houseNumber = document.getElementById('existingCustomerHouseNumber').value;
            
            if (area || block || avenue || street || houseNumber) {
                let addressParts = [];
                
                if (area) addressParts.push(`ุงูููุทูุฉ: ${area}`);
                if (block) addressParts.push(`ุงููุทุนุฉ: ${block}`);
                if (avenue) addressParts.push(`ุงูุฌุงุฏุฉ: ${avenue}`);
                if (street) addressParts.push(`ุงูุดุงุฑุน: ${street}`);
                if (houseNumber) addressParts.push(`ุฑูู ุงูููุฒู: ${houseNumber}`);
                
                const fullAddress = addressParts.join(' - ');
                document.getElementById('existingFullAddress').textContent = fullAddress;
                document.getElementById('existingAddressReview').classList.remove('hidden');
            } else {
                document.getElementById('existingAddressReview').classList.add('hidden');
            }
        }

        // Close modal when clicking outside
        document.getElementById('inspectionModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'989ed8e38320c68b',t:'MTc1OTY4NzUyNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
