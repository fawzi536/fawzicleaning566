<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª ÙˆØ¬Ù‡Ø§</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        .bounce-in {
            animation: bounceIn 0.6s ease-out;
        }
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        .pulse-success {
            animation: pulseSuccess 0.6s ease-in-out;
        }
        @keyframes pulseSuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); background-color: #10b981; }
            100% { transform: scale(1); }
        }
        .shake {
            animation: shake 0.5s ease-in-out;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .status-pending { background: linear-gradient(135deg, #fbbf24, #f59e0b); }
        .status-completed { background: linear-gradient(135deg, #10b981, #059669); }
        .status-approved { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .status-rejected { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .status-waiting { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .connection-status {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .status-connected {
            background: #10b981;
            color: white;
        }
        .status-connecting {
            background: #f59e0b;
            color: white;
        }
        .status-error {
            background: #ef4444;
            color: white;
        }
        .status-local {
            background: #6b7280;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ -->
    <div id="connectionStatus" class="connection-status status-connecting">
        ğŸ”„ Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„...
    </div>

    <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4 space-x-reverse">
                    <div class="bg-white bg-opacity-20 p-3 rounded-full">
                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª ÙˆØ¬Ù‡Ø§</h1>
                        <p class="text-blue-100">Ø¥Ø¯Ø§Ø±Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø§Øª</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4 space-x-reverse">
                    <button onclick="syncWithGoogleSheets()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-all duration-300 flex items-center space-x-2 space-x-reverse">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                        <span>ØªØ­Ø¯ÙŠØ« Ù…Ù† Sheets</span>
                    </button>
                    <button onclick="exportAllDataToCSV()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-all duration-300 flex items-center space-x-2 space-x-reverse">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        <span>ØªØµØ¯ÙŠØ± CSV</span>
                    </button>
                    <div class="text-right">
                        <div class="text-sm opacity-90">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
                        <div id="totalCustomers" class="text-xl font-bold">0</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Ø§Ù„ØªÙ†Ù‚Ù„ -->
    <nav class="bg-white shadow-md sticky top-0 z-40">
        <div class="container mx-auto px-6">
            <div class="flex space-x-8 space-x-reverse">
                <button onclick="showSection('dashboard')" class="nav-btn px-6 py-4 text-blue-600 border-b-2 border-blue-600 font-semibold">
                    Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                </button>
                <button onclick="showSection('customers')" class="nav-btn px-6 py-4 text-gray-600 hover:text-blue-600 transition-colors">
                    Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
                </button>
                <button onclick="showSection('inspections')" class="nav-btn px-6 py-4 text-gray-600 hover:text-blue-600 transition-colors">
                    Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø§Øª
                </button>
                <button onclick="showSection('reports')" class="nav-btn px-6 py-4 text-gray-600 hover:text-blue-600 transition-colors">
                    Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
                </button>
            </div>
        </div>
    </nav>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <main class="container mx-auto px-6 py-8">
        <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
        <section id="dashboard" class="section-content">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Ø¨Ø·Ø§Ù‚Ø© Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</p>
                            <p id="dashTotalCustomers" class="text-3xl font-bold text-blue-600">0</p>
                        </div>
                        <div class="bg-blue-100 p-3 rounded-full">
                            <svg class="w-8 h-8 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© -->
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Ù…Ø¹Ø§ÙŠÙ†Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</p>
                            <p id="dashPendingInspections" class="text-3xl font-bold text-yellow-600">0</p>
                        </div>
                        <div class="bg-yellow-100 p-3 rounded-full">
                            <svg class="w-8 h-8 text-yellow-600" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© -->
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Ù…Ø¹Ø§ÙŠÙ†Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©</p>
                            <p id="dashCompletedInspections" class="text-3xl font-bold text-green-600">0</p>
                        </div>
                        <div class="bg-green-100 p-3 rounded-full">
                            <svg class="w-8 h-8 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Ø¨Ø·Ø§Ù‚Ø© Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª -->
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</p>
                            <p id="dashTotalRevenue" class="text-3xl font-bold text-purple-600">0 Ø¯.Ùƒ</p>
                        </div>
                        <div class="bg-purple-100 p-3 rounded-full">
                            <svg class="w-8 h-8 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"/>
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4">ØªÙˆØ²ÙŠØ¹ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø§Øª</h3>
                    <canvas id="statusChart" width="400" height="200"></canvas>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4">Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h3>
                    <canvas id="monthlyChart" width="400" height="200"></canvas>
                </div>
            </div>
        </section>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->
        <section id="customers" class="section-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>
                    <button onclick="showAddCustomerModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-all duration-300 flex items-center space-x-2 space-x-reverse">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                        </svg>
                        <span>Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</span>
                    </button>
                </div>

                <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« -->
                <div class="mb-6">
                    <div class="relative">
                        <input type="text" id="customerSearch" placeholder="Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…ÙŠÙ„..." class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <svg class="absolute left-3 top-3.5 h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                    </div>
                </div>

                <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø§Ù„Ø§Ø³Ù…</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø§Øª</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="customersTableBody" class="bg-white divide-y divide-gray-200">
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø§Øª -->
        <section id="inspections" class="section-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø§Øª</h2>
                    <button onclick="showAddInspectionModal()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg transition-all duration-300 flex items-center space-x-2 space-x-reverse">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                        </svg>
                        <span>Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
                    </button>
                </div>

                <!-- ÙÙ„Ø§ØªØ± Ø§Ù„Ø¨Ø­Ø« -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <input type="text" id="inspectionSearch" placeholder="Ø§Ù„Ø¨Ø­Ø«..." class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                    <select id="statusFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                        <option value="Ù…Ø¹Ù„Ù‚">Ù…Ø¹Ù„Ù‚</option>
                        <option value="Ù…ÙƒØªÙ…Ù„">Ù…ÙƒØªÙ…Ù„</option>
                    </select>
                    <select id="approvalFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª</option>
                        <option value="Ù…ÙˆØ§ÙÙ‚">Ù…ÙˆØ§ÙÙ‚</option>
                        <option value="ØºÙŠØ± Ù…ÙˆØ§ÙÙ‚">ØºÙŠØ± Ù…ÙˆØ§ÙÙ‚</option>
                        <option value="ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±">ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
                    </select>
                    <input type="date" id="dateFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                </div>

                <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø§Øª -->
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="inspectionsTableBody" class="bg-white divide-y divide-gray-200">
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
        <section id="reports" class="section-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h2>
                
                <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØµØ¯ÙŠØ± -->
                <div class="flex flex-wrap gap-4 mb-8">
                    <button onclick="exportCustomersReport()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-all duration-300">
                        ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ (PDF)
                    </button>
                    <button onclick="exportInspectionsReport()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg transition-all duration-300">
                        ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø§Øª (PDF)
                    </button>
                    <button onclick="exportFinancialReport()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg transition-all duration-300">
                        Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ (PDF)
                    </button>
                    <button onclick="exportAllDataToCSV()" class="bg-orange-600 hover:bg-orange-700 text-white px-6 py-3 rounded-lg transition-all duration-300">
                        ØªØµØ¯ÙŠØ± CSV Ù„Ù„Ù€ Sheets
                    </button>
                    <button onclick="exportData()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition-all duration-300">
                        Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© (JSON)
                    </button>
                </div>

                <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ÙØµÙ„Ø© -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-xl">
                        <h3 class="text-lg font-semibold mb-2">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</h3>
                        <p id="approvalRate" class="text-3xl font-bold">0%</p>
                    </div>
                    <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-xl">
                        <h3 class="text-lg font-semibold mb-2">Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</h3>
                        <p id="avgInspectionValue" class="text-3xl font-bold">0 Ø¯.Ùƒ</p>
                    </div>
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-6 rounded-xl">
                        <h3 class="text-lg font-semibold mb-2">Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h3>
                        <p id="avgRating" class="text-3xl font-bold">0/5</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ -->
    <div id="addCustomerModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 bounce-in">
            <h3 class="text-xl font-bold mb-6">Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</h3>
            <form id="addCustomerForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Ø§Ù„Ø§Ø³Ù…</label>
                    <input type="text" id="customerName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                    <input type="tel" id="customerPhone" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex justify-end space-x-4 space-x-reverse">
                    <button type="button" onclick="hideAddCustomerModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-all duration-300">
                        <span class="flex items-center space-x-2 space-x-reverse">
                            <span>Ø¥Ø¶Ø§ÙØ©</span>
                            <div id="addCustomerSpinner" class="loading-spinner hidden"></div>
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§ÙŠÙ†Ø© -->
    <div id="addInspectionModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto bounce-in">
            <h3 class="text-xl font-bold mb-6">Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
            <form id="addInspectionForm">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                        <select id="inspectionCustomer" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…ÙŠÙ„</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label>
                        <select id="inspectionArea" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</option>
                            <option value="Ø§Ù„ÙƒÙˆÙŠØª">Ø§Ù„ÙƒÙˆÙŠØª</option>
                            <option value="Ø­ÙˆÙ„ÙŠ">Ø­ÙˆÙ„ÙŠ</option>
                            <option value="Ø§Ù„ÙØ±ÙˆØ§Ù†ÙŠØ©">Ø§Ù„ÙØ±ÙˆØ§Ù†ÙŠØ©</option>
                            <option value="Ù…Ø¨Ø§Ø±Ùƒ Ø§Ù„ÙƒØ¨ÙŠØ±">Ù…Ø¨Ø§Ø±Ùƒ Ø§Ù„ÙƒØ¨ÙŠØ±</option>
                            <option value="Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠ">Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠ</option>
                            <option value="Ø§Ù„Ø¬Ù‡Ø±Ø§Ø¡">Ø§Ù„Ø¬Ù‡Ø±Ø§Ø¡</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</label>
                        <select id="inspectionServiceType" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                            <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</option>
                            <option value="ÙØ­Øµ Ù…Ù†Ø²Ù„">ÙØ­Øµ Ù…Ù†Ø²Ù„</option>
                            <option value="ÙØ­Øµ Ø´Ù‚Ø©">ÙØ­Øµ Ø´Ù‚Ø©</option>
                            <option value="ÙØ­Øµ ÙÙŠÙ„Ø§">ÙØ­Øµ ÙÙŠÙ„Ø§</option>
                            <option value="ÙØ­Øµ Ù…ÙƒØªØ¨">ÙØ­Øµ Ù…ÙƒØªØ¨</option>
                            <option value="ÙØ­Øµ Ù…Ø­Ù„ ØªØ¬Ø§Ø±ÙŠ">ÙØ­Øµ Ù…Ø­Ù„ ØªØ¬Ø§Ø±ÙŠ</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±</label>
                        <select id="inspectionPropertyType" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                            <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±</option>
                            <option value="Ø´Ù‚Ø©">Ø´Ù‚Ø©</option>
                            <option value="ÙÙŠÙ„Ø§">ÙÙŠÙ„Ø§</option>
                            <option value="Ø¨ÙŠØª">Ø¨ÙŠØª</option>
                            <option value="Ù…ÙƒØªØ¨">Ù…ÙƒØªØ¨</option>
                            <option value="Ù…Ø­Ù„">Ù…Ø­Ù„</option>
                            <option value="Ù…Ø³ØªÙˆØ¯Ø¹">Ù…Ø³ØªÙˆØ¯Ø¹</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</label>
                        <input type="date" id="inspectionDate" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">ÙˆÙ‚Øª Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</label>
                        <input type="time" id="inspectionTime" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</label>
                        <input type="number" id="inspectionTotalAmount" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</label>
                        <input type="number" id="inspectionFinalAmount" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
                    <textarea id="inspectionNotes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"></textarea>
                </div>
                <div class="flex justify-end space-x-4 space-x-reverse">
                    <button type="button" onclick="hideAddInspectionModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition-all duration-300">
                        <span class="flex items-center space-x-2 space-x-reverse">
                            <span>Ø¥Ø¶Ø§ÙØ©</span>
                            <div id="addInspectionSpinner" class="loading-spinner hidden"></div>
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© -->
    <div id="inspectionDetailsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</h3>
                <button onclick="hideInspectionDetailsModal()" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div id="inspectionDetailsContent">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
        </div>
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Google Sheets - Ù‚Ø±Ø§Ø¡Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ø¨Ø± CSV
        const SPREADSHEET_ID = '14kbGPoC4ld3tkDAuVWGO36FjNtRvY0xKBXc_y0vUkZI';
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        let customers = [];
        let inspections = [];
        let isConnected = false;
        let autoSaveEnabled = true;
        let environmentType = 'unknown';

        // ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ¦Ø©
        function detectEnvironment() {
            const isInIframe = window !== window.top;
            const isLocalFile = window.location.protocol === 'file:';
            const isHTTPS = window.location.protocol === 'https:';
            const isCanvaEnvironment = window.location.hostname.includes('canva');
            
            if (isCanvaEnvironment) {
                environmentType = 'canva';
            } else if (isInIframe) {
                environmentType = 'iframe';
            } else if (isLocalFile) {
                environmentType = 'local';
            } else if (isHTTPS) {
                environmentType = 'web';
            } else {
                environmentType = 'http';
            }
            
            console.log('Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ù…ÙƒØªØ´ÙØ©:', environmentType);
            return environmentType;
        }

        // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… CSV Export Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
        async function readFromGoogleSheets(sheetName) {
            try {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„Ø§ØªØµØ§Ù„
                if (environmentType === 'local' || environmentType === 'iframe') {
                    throw new Error('Ø§Ù„Ø¨ÙŠØ¦Ø© Ù„Ø§ ØªØ¯Ø¹Ù… Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ');
                }

                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø§Ø¨Ø· CSV Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Google Sheets (ÙŠØ¹Ù…Ù„ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·)
                const csvUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv&sheet=${sheetName}`;
                
                const response = await fetch(csvUrl, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Accept': 'text/csv,text/plain,*/*'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„`);
                }
                
                const csvText = await response.text();
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©
                if (!csvText || csvText.trim() === '' || csvText.includes('<!DOCTYPE html>') || csvText.includes('<html>')) {
                    console.log(`Ø§Ù„Ø´ÙŠØª ${sheetName} ÙØ§Ø±Øº Ø£Ùˆ ØºÙŠØ± Ù…ØªØ§Ø­`);
                    return [];
                }
                
                return parseCSV(csvText);
                
            } catch (error) {
                console.error(`Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© ${sheetName}:`, error);
                throw error;
            }
        }

        // ØªØ­Ù„ÙŠÙ„ CSV
        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const result = [];
            
            for (let line of lines) {
                if (line.trim()) {
                    // ØªØ­Ù„ÙŠÙ„ Ø¨Ø³ÙŠØ· Ù„Ù„Ù€ CSV Ù…Ø¹ Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„ÙÙˆØ§ØµÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†ØµÙˆØµ
                    const row = [];
                    let current = '';
                    let inQuotes = false;
                    
                    for (let i = 0; i < line.length; i++) {
                        const char = line[i];
                        
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            row.push(current.trim().replace(/^"|"$/g, ''));
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    
                    row.push(current.trim().replace(/^"|"$/g, ''));
                    result.push(row);
                }
            }
            
            return result;
        }

        // ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ€ CSV Ù„Ù„Ù†Ø³Ø® Ø§Ù„ÙŠØ¯ÙˆÙŠ Ø¥Ù„Ù‰ Google Sheets
        function exportToCSV(data, filename) {
            let csvContent = '';
            
            if (filename.includes('customers')) {
                // Ù‡ÙŠØ¯Ø± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
                csvContent = 'customer_id,name,phone,created_at\n';
                data.forEach(customer => {
                    csvContent += `"${customer.id}","${customer.name}","${customer.phone}","${customer.createdAt}"\n`;
                });
            } else if (filename.includes('inspections')) {
                // Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø§Øª
                csvContent = 'inspection_id,customer_id,customer_name,area,service_type,property_type,inspection_date,inspection_time,status,approval,total_amount,final_amount,rating,additional_notes,inspector_notes,created_at\n';
                data.forEach(inspection => {
                    csvContent += `"${inspection.id}","${inspection.customerId}","${inspection.customerName}","${inspection.area}","${inspection.serviceType}","${inspection.propertyType}","${inspection.date}","${inspection.time}","${inspection.status}","${inspection.approval}","${inspection.totalAmount}","${inspection.finalAmount}","${inspection.rating}","${inspection.additionalNotes}","${inspection.inspectorNotes}","${inspection.createdAt}"\n`;
                });
            }
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets (Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·)
        async function loadDataFromGoogleSheets() {
            try {
                updateConnectionStatus('connecting');
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ¦Ø©
                if (environmentType === 'local' || environmentType === 'iframe') {
                    console.log('Ø§Ù„Ø¨ÙŠØ¦Ø© Ù…Ø­Ø¯ÙˆØ¯Ø© - Ø³ÙŠØ¹Ù…Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·');
                    throw new Error('Ø¨ÙŠØ¦Ø© Ù…Ø­Ø¯ÙˆØ¯Ø©');
                }
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
                try {
                    const customersData = await readFromGoogleSheets('Customers');
                    if (customersData && customersData.length > 1) { // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù‡ÙŠØ¯Ø±
                        const loadedCustomers = customersData.slice(1).map(row => ({
                            id: row[0] || '',
                            name: row[1] || '',
                            phone: row[2] || '',
                            createdAt: row[3] || new Date().toISOString()
                        })).filter(customer => customer.id && customer.name); // ØªØµÙÙŠØ© Ø§Ù„ØµÙÙˆÙ Ø§Ù„ÙØ§Ø±ØºØ©
                        
                        if (loadedCustomers.length > 0) {
                            customers = loadedCustomers;
                            console.log(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${customers.length} Ø¹Ù…ÙŠÙ„ Ù…Ù† Google Sheets`);
                        }
                    }
                } catch (error) {
                    console.log('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø´ÙŠØª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø£Ùˆ Ù‡Ùˆ ÙØ§Ø±Øº');
                }

                // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø§Øª
                try {
                    const inspectionsData = await readFromGoogleSheets('Inspections');
                    if (inspectionsData && inspectionsData.length > 1) { // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù‡ÙŠØ¯Ø±
                        const loadedInspections = inspectionsData.slice(1).map(row => ({
                            id: row[0] || '',
                            customerId: row[1] || '',
                            customerName: row[2] || '',
                            area: row[3] || '',
                            serviceType: row[4] || '',
                            propertyType: row[5] || '',
                            date: row[6] || '',
                            time: row[7] || '',
                            status: row[8] || 'Ù…Ø¹Ù„Ù‚',
                            approval: row[9] || 'ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
                            totalAmount: parseFloat(row[10]) || 0,
                            finalAmount: parseFloat(row[11]) || 0,
                            rating: parseInt(row[12]) || 0,
                            additionalNotes: row[13] || '',
                            inspectorNotes: row[14] || '',
                            createdAt: row[15] || new Date().toISOString()
                        })).filter(inspection => inspection.id && inspection.customerName); // ØªØµÙÙŠØ© Ø§Ù„ØµÙÙˆÙ Ø§Ù„ÙØ§Ø±ØºØ©
                        
                        if (loadedInspections.length > 0) {
                            inspections = loadedInspections;
                            console.log(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${inspections.length} Ù…Ø¹Ø§ÙŠÙ†Ø© Ù…Ù† Google Sheets`);
                        }
                    }
                } catch (error) {
                    console.log('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø´ÙŠØª Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø§Øª Ø£Ùˆ Ù‡Ùˆ ÙØ§Ø±Øº');
                }

                isConnected = true;
                updateConnectionStatus('connected');
                updateUI();
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                updateConnectionStatus('error');
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙƒØ¨Ø¯ÙŠÙ„
                loadLocalData();
                updateUI();
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
        function updateConnectionStatus(status) {
            const statusElement = document.getElementById('connectionStatus');
            
            switch (status) {
                case 'connecting':
                    if (environmentType === 'local' || environmentType === 'iframe') {
                        statusElement.textContent = 'ğŸ’¾ ÙŠØ¹Ù…Ù„ Ù…Ø­Ù„ÙŠØ§Ù‹ (Ø¨ÙŠØ¦Ø© Ù…Ø­Ø¯ÙˆØ¯Ø©)';
                        statusElement.className = 'connection-status status-local';
                    } else {
                        statusElement.textContent = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Google Sheets...';
                        statusElement.className = 'connection-status status-connecting';
                    }
                    break;
                case 'connected':
                    statusElement.textContent = 'ğŸ“– Ù…ØªØµÙ„ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© Ù…Ù† Google Sheets';
                    statusElement.className = 'connection-status status-connected';
                    break;
                case 'error':
                    if (environmentType === 'local' || environmentType === 'iframe') {
                        statusElement.textContent = 'ğŸ’¾ ÙŠØ¹Ù…Ù„ Ù…Ø­Ù„ÙŠØ§Ù‹ (Ø¨ÙŠØ¦Ø© Ù…Ø­Ø¯ÙˆØ¯Ø©)';
                        statusElement.className = 'connection-status status-local';
                    } else {
                        statusElement.textContent = 'ğŸ’¾ ÙŠØ¹Ù…Ù„ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·';
                        statusElement.className = 'connection-status status-error';
                    }
                    break;
            }
        }

        // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø· Ù…Ù† Google Sheets)
        async function syncWithGoogleSheets() {
            if (environmentType === 'local' || environmentType === 'iframe') {
                showNotification('Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Google Sheets ØºÙŠØ± Ù…ØªØ§Ø­ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ¦Ø©', 'error');
                return;
            }
            
            showNotification('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets...', 'info');
            await loadDataFromGoogleSheets();
            
            if (isConnected) {
                showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } else {
                showNotification('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ - ÙŠØ¹Ù…Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø­Ù„ÙŠØ§Ù‹', 'error');
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ­ÙØ¸Ù‡Ø§ Ù…Ø­Ù„ÙŠØ§Ù‹
        function updateData() {
            // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ Ø¯Ø§Ø¦Ù…Ø§Ù‹
            localStorage.setItem('customers', JSON.stringify(customers));
            localStorage.setItem('inspections', JSON.stringify(inspections));
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            updateUI();
            
            // Ø¥Ø¸Ù‡Ø§Ø± ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù„ØªØµØ¯ÙŠØ± Ø§Ù„ÙŠØ¯ÙˆÙŠ
            if (autoSaveEnabled && (customers.length > 0 || inspections.length > 0)) {
                showAutoExportReminder();
            }
        }

        // ØªØ°ÙƒÙŠØ± Ø¨Ø§Ù„ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        function showAutoExportReminder() {
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ°ÙƒÙŠØ± ÙƒÙ„ 10 Ø¥Ø¶Ø§ÙØ§Øª
            const totalRecords = customers.length + inspections.length;
            if (totalRecords % 10 === 0 && totalRecords > 0) {
                setTimeout(() => {
                    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø© Ø¥Ù„Ù‰ Ù…Ù„ÙØ§Øª CSV Ù„Ù†Ø³Ø®Ù‡Ø§ Ø¥Ù„Ù‰ Google SheetsØŸ')) {
                        exportAllDataToCSV();
                    }
                }, 1000);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        function loadLocalData() {
            const savedCustomers = localStorage.getItem('customers');
            const savedInspections = localStorage.getItem('inspections');
            
            if (savedCustomers) {
                customers = JSON.parse(savedCustomers);
            }
            
            if (savedInspections) {
                inspections = JSON.parse(savedInspections);
            }
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        async function initApp() {
            // ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ¦Ø© Ø£ÙˆÙ„Ø§Ù‹
            detectEnvironment();
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Google Sheets
            await loadDataFromGoogleSheets();
            
            // Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
            if (!isConnected) {
                loadLocalData();
                updateUI();
            }
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯
        function showSection(sectionName) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
            document.querySelectorAll('.section-content').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯
            document.getElementById(sectionName).classList.remove('hidden');
            
            // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600', 'font-semibold');
                btn.classList.add('text-gray-600');
            });
            
            event.target.classList.remove('text-gray-600');
            event.target.classList.add('text-blue-600', 'border-b-2', 'border-blue-600', 'font-semibold');
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…
            if (sectionName === 'dashboard') {
                updateDashboard();
            } else if (sectionName === 'customers') {
                updateCustomersTable();
            } else if (sectionName === 'inspections') {
                updateInspectionsTable();
            } else if (sectionName === 'reports') {
                updateReports();
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        function updateDashboard() {
            const totalCustomers = customers.length;
            const pendingInspections = inspections.filter(i => i.status === 'Ù…Ø¹Ù„Ù‚').length;
            const completedInspections = inspections.filter(i => i.status === 'Ù…ÙƒØªÙ…Ù„').length;
            const totalRevenue = inspections.reduce((sum, i) => sum + (parseFloat(i.finalAmount) || 0), 0);

            document.getElementById('dashTotalCustomers').textContent = totalCustomers;
            document.getElementById('dashPendingInspections').textContent = pendingInspections;
            document.getElementById('dashCompletedInspections').textContent = completedInspections;
            document.getElementById('dashTotalRevenue').textContent = totalRevenue.toFixed(2) + ' Ø¯.Ùƒ';

            updateCharts();
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
        function updateCharts() {
            // Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø§Øª
            const statusCounts = {
                'Ù…Ø¹Ù„Ù‚': inspections.filter(i => i.status === 'Ù…Ø¹Ù„Ù‚').length,
                'Ù…ÙƒØªÙ…Ù„': inspections.filter(i => i.status === 'Ù…ÙƒØªÙ…Ù„').length
            };

            const statusCtx = document.getElementById('statusChart').getContext('2d');
            new Chart(statusCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(statusCounts),
                    datasets: [{
                        data: Object.values(statusCounts),
                        backgroundColor: ['#f59e0b', '#10b981'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©
            const monthlyData = {};
            inspections.forEach(inspection => {
                const month = new Date(inspection.date).toLocaleDateString('ar-SA', { year: 'numeric', month: 'long' });
                monthlyData[month] = (monthlyData[month] || 0) + 1;
            });

            const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
            new Chart(monthlyCtx, {
                type: 'line',
                data: {
                    labels: Object.keys(monthlyData),
                    datasets: [{
                        label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø§Øª',
                        data: Object.values(monthlyData),
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„
        function showAddCustomerModal() {
            document.getElementById('addCustomerModal').classList.remove('hidden');
            document.getElementById('addCustomerModal').classList.add('flex');
        }

        // Ø¥Ø®ÙØ§Ø¡ Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„
        function hideAddCustomerModal() {
            document.getElementById('addCustomerModal').classList.add('hidden');
            document.getElementById('addCustomerModal').classList.remove('flex');
            document.getElementById('addCustomerForm').reset();
        }

        // Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
        async function addCustomer(event) {
            event.preventDefault();
            
            const spinner = document.getElementById('addCustomerSpinner');
            spinner.classList.remove('hidden');
            
            const name = document.getElementById('customerName').value;
            const phone = document.getElementById('customerPhone').value;
            
            const newCustomer = {
                id: 'CUST-' + Date.now(),
                name: name,
                phone: phone,
                createdAt: new Date().toISOString()
            };
            
            customers.push(newCustomer);
            await updateData();
            
            hideAddCustomerModal();
            showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            
            spinner.classList.add('hidden');
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§ÙŠÙ†Ø©
        function showAddInspectionModal() {
            // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
            const customerSelect = document.getElementById('inspectionCustomer');
            customerSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…ÙŠÙ„</option>';
            
            customers.forEach(customer => {
                const option = document.createElement('option');
                option.value = customer.id;
                option.textContent = `${customer.name} - ${customer.phone}`;
                customerSelect.appendChild(option);
            });
            
            document.getElementById('addInspectionModal').classList.remove('hidden');
            document.getElementById('addInspectionModal').classList.add('flex');
        }

        // Ø¥Ø®ÙØ§Ø¡ Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§ÙŠÙ†Ø©
        function hideAddInspectionModal() {
            document.getElementById('addInspectionModal').classList.add('hidden');
            document.getElementById('addInspectionModal').classList.remove('flex');
            document.getElementById('addInspectionForm').reset();
        }

        // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¬Ø¯ÙŠØ¯Ø©
        async function addInspection(event) {
            event.preventDefault();
            
            const spinner = document.getElementById('addInspectionSpinner');
            spinner.classList.remove('hidden');
            
            const customerId = document.getElementById('inspectionCustomer').value;
            const customer = customers.find(c => c.id === customerId);
            
            const newInspection = {
                id: 'INS-' + Date.now(),
                customerId: customerId,
                customerName: customer.name,
                area: document.getElementById('inspectionArea').value,
                serviceType: document.getElementById('inspectionServiceType').value,
                propertyType: document.getElementById('inspectionPropertyType').value,
                date: document.getElementById('inspectionDate').value,
                time: document.getElementById('inspectionTime').value,
                status: 'Ù…Ø¹Ù„Ù‚',
                approval: 'ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
                totalAmount: parseFloat(document.getElementById('inspectionTotalAmount').value) || 0,
                finalAmount: parseFloat(document.getElementById('inspectionFinalAmount').value) || 0,
                rating: 0,
                additionalNotes: document.getElementById('inspectionNotes').value,
                inspectorNotes: '',
                createdAt: new Date().toISOString()
            };
            
            inspections.push(newInspection);
            await updateData();
            
            hideAddInspectionModal();
            showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
            
            spinner.classList.add('hidden');
        }

        // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
        function updateCustomersTable() {
            const tbody = document.getElementById('customersTableBody');
            tbody.innerHTML = '';
            
            customers.forEach(customer => {
                const customerInspections = inspections.filter(i => i.customerId === customer.id);
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-colors';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${customer.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${customer.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${customer.phone}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${new Date(customer.createdAt).toLocaleDateString('ar-SA')}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${customerInspections.length}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="editCustomer('${customer.id}')" class="text-blue-600 hover:text-blue-900 ml-4">ØªØ¹Ø¯ÙŠÙ„</button>
                        <button onclick="deleteCustomer('${customer.id}')" class="text-red-600 hover:text-red-900">Ø­Ø°Ù</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø§Øª
        function updateInspectionsTable() {
            const tbody = document.getElementById('inspectionsTableBody');
            tbody.innerHTML = '';
            
            inspections.forEach(inspection => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-colors';
                
                const statusClass = inspection.status === 'Ù…Ø¹Ù„Ù‚' ? 'status-pending' : 'status-completed';
                const approvalClass = inspection.approval === 'Ù…ÙˆØ§ÙÙ‚' ? 'status-approved' : 
                                    inspection.approval === 'ØºÙŠØ± Ù…ÙˆØ§ÙÙ‚' ? 'status-rejected' : 'status-waiting';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${inspection.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${inspection.customerName}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${inspection.area}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${inspection.serviceType}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${new Date(inspection.date).toLocaleDateString('ar-SA')}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full text-white ${statusClass}">${inspection.status}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full text-white ${approvalClass}">${inspection.approval}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${inspection.finalAmount} Ø¯.Ùƒ</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="showInspectionDetails('${inspection.id}')" class="text-blue-600 hover:text-blue-900 ml-2">Ø¹Ø±Ø¶</button>
                        <button onclick="editInspection('${inspection.id}')" class="text-green-600 hover:text-green-900 ml-2">ØªØ¹Ø¯ÙŠÙ„</button>
                        <button onclick="deleteInspection('${inspection.id}')" class="text-red-600 hover:text-red-900">Ø­Ø°Ù</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
        function showInspectionDetails(inspectionId) {
            const inspection = inspections.find(i => i.id === inspectionId);
            if (!inspection) return;
            
            const content = document.getElementById('inspectionDetailsContent');
            content.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-2">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©</h4>
                        <div class="space-y-2 text-sm">
                            <p><span class="font-medium">Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©:</span> ${inspection.id}</p>
                            <p><span class="font-medium">Ø§Ù„Ø¹Ù…ÙŠÙ„:</span> ${inspection.customerName}</p>
                            <p><span class="font-medium">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</span> ${inspection.area}</p>
                            <p><span class="font-medium">Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©:</span> ${inspection.serviceType}</p>
                            <p><span class="font-medium">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±:</span> ${inspection.propertyType}</p>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-2">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙˆØ¹Ø¯</h4>
                        <div class="space-y-2 text-sm">
                            <p><span class="font-medium">Ø§Ù„ØªØ§Ø±ÙŠØ®:</span> ${new Date(inspection.date).toLocaleDateString('ar-SA')}</p>
                            <p><span class="font-medium">Ø§Ù„ÙˆÙ‚Øª:</span> ${inspection.time}</p>
                            <p><span class="font-medium">Ø§Ù„Ø­Ø§Ù„Ø©:</span> ${inspection.status}</p>
                            <p><span class="font-medium">Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©:</span> ${inspection.approval}</p>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-2">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h4>
                        <div class="space-y-2 text-sm">
                            <p><span class="font-medium">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span> ${inspection.totalAmount} Ø¯.Ùƒ</p>
                            <p><span class="font-medium">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</span> ${inspection.finalAmount} Ø¯.Ùƒ</p>
                            <p><span class="font-medium">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</span> ${inspection.rating}/5</p>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-2">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h4>
                        <div class="space-y-2 text-sm">
                            <p><span class="font-medium">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©:</span></p>
                            <p class="text-gray-600">${inspection.additionalNotes || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª'}</p>
                            <p><span class="font-medium">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…ÙØªØ´:</span></p>
                            <p class="text-gray-600">${inspection.inspectorNotes || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª'}</p>
                        </div>
                    </div>
                </div>
                <div class="mt-6 flex justify-end space-x-4 space-x-reverse">
                    <button onclick="updateInspectionStatus('${inspection.id}', 'Ù…ÙƒØªÙ…Ù„')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                        ØªØ­Ø¯ÙŠØ¯ ÙƒÙ…ÙƒØªÙ…Ù„
                    </button>
                    <button onclick="updateInspectionApproval('${inspection.id}', 'Ù…ÙˆØ§ÙÙ‚')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                        Ù…ÙˆØ§ÙÙ‚Ø©
                    </button>
                    <button onclick="updateInspectionApproval('${inspection.id}', 'ØºÙŠØ± Ù…ÙˆØ§ÙÙ‚')" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors">
                        Ø±ÙØ¶
                    </button>
                </div>
            `;
            
            document.getElementById('inspectionDetailsModal').classList.remove('hidden');
            document.getElementById('inspectionDetailsModal').classList.add('flex');
        }

        // Ø¥Ø®ÙØ§Ø¡ Ù…ÙˆØ¯Ø§Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
        function hideInspectionDetailsModal() {
            document.getElementById('inspectionDetailsModal').classList.add('hidden');
            document.getElementById('inspectionDetailsModal').classList.remove('flex');
        }

        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
        async function updateInspectionStatus(inspectionId, status) {
            const inspection = inspections.find(i => i.id === inspectionId);
            if (inspection) {
                inspection.status = status;
                await updateData();
                hideInspectionDetailsModal();
                showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©', 'success');
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
        async function updateInspectionApproval(inspectionId, approval) {
            const inspection = inspections.find(i => i.id === inspectionId);
            if (inspection) {
                inspection.approval = approval;
                await updateData();
                hideInspectionDetailsModal();
                showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©', 'success');
            }
        }

        // Ø­Ø°Ù Ø¹Ù…ÙŠÙ„
        async function deleteCustomer(customerId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŸ')) {
                customers = customers.filter(c => c.id !== customerId);
                // Ø­Ø°Ù Ù…Ø¹Ø§ÙŠÙ†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø£ÙŠØ¶Ø§Ù‹
                inspections = inspections.filter(i => i.customerId !== customerId);
                await updateData();
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }
        }

        // Ø­Ø°Ù Ù…Ø¹Ø§ÙŠÙ†Ø©
        async function deleteInspection(inspectionId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©ØŸ')) {
                inspections = inspections.filter(i => i.id !== inspectionId);
                await updateData();
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
        function updateReports() {
            const totalInspections = inspections.length;
            const approvedInspections = inspections.filter(i => i.approval === 'Ù…ÙˆØ§ÙÙ‚').length;
            const approvalRate = totalInspections > 0 ? ((approvedInspections / totalInspections) * 100).toFixed(1) : 0;
            
            const totalRevenue = inspections.reduce((sum, i) => sum + (parseFloat(i.finalAmount) || 0), 0);
            const avgInspectionValue = totalInspections > 0 ? (totalRevenue / totalInspections).toFixed(2) : 0;
            
            const ratingsSum = inspections.reduce((sum, i) => sum + (parseInt(i.rating) || 0), 0);
            const avgRating = totalInspections > 0 ? (ratingsSum / totalInspections).toFixed(1) : 0;
            
            document.getElementById('approvalRate').textContent = approvalRate + '%';
            document.getElementById('avgInspectionValue').textContent = avgInspectionValue + ' Ø¯.Ùƒ';
            document.getElementById('avgRating').textContent = avgRating + '/5';
        }

        // ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ€ CSV
        function exportAllDataToCSV() {
            const today = new Date().toISOString().split('T')[0];
            
            // ØªØµØ¯ÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
            if (customers.length > 0) {
                exportToCSV(customers, `customers-${today}.csv`);
            }
            
            // ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø§Øª
            if (inspections.length > 0) {
                exportToCSV(inspections, `inspections-${today}.csv`);
            }
            
            showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ù…Ù„ÙØ§Øª CSV - ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ù†Ø³Ø®Ù‡Ø§ Ø¥Ù„Ù‰ Google Sheets', 'success');
            
            // Ø¥Ø¸Ù‡Ø§Ø± ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ù†Ø³Ø®
            setTimeout(() => {
                alert(`ğŸ“‹ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ù†Ø³Ø® Ø¥Ù„Ù‰ Google Sheets:

1. Ø§ÙØªØ­ Google Sheets: https://sheets.google.com
2. Ø§ÙØªØ­ Ø§Ù„Ù…Ù„Ù: ${SPREADSHEET_ID}
3. Ø£Ù†Ø´Ø¦ Ø´ÙŠØª Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ø³Ù… "Customers" 
4. Ø§ÙØªØ­ Ù…Ù„Ù customers-${today}.csv ÙˆÙ†Ø³Ø® Ø§Ù„Ù…Ø­ØªÙˆÙ‰
5. Ø§Ù„ØµÙ‚ ÙÙŠ Ø´ÙŠØª "Customers"
6. ÙƒØ±Ø± Ù†ÙØ³ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù„Ù€ "Inspections"

âœ… Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø³ØªÙƒÙˆÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Google Sheets!`);
            }, 2000);
        }

        // ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ€ JSON (Ù„Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ)
        function exportData() {
            const data = {
                customers: customers,
                inspections: inspections,
                exportDate: new Date().toISOString(),
                environment: environmentType
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `wajha-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        // ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ (PDF)
        function exportCustomersReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø· Ø§Ù„Ø¹Ø±Ø¨ÙŠ (ØªÙ‚Ø±ÙŠØ¨ÙŠ)
            doc.setFont('helvetica');
            doc.setFontSize(16);
            doc.text('Customers Report - Wajha', 20, 20);
            
            let yPosition = 40;
            customers.forEach((customer, index) => {
                doc.setFontSize(12);
                doc.text(`${index + 1}. ${customer.name} - ${customer.phone}`, 20, yPosition);
                yPosition += 10;
                
                if (yPosition > 280) {
                    doc.addPage();
                    yPosition = 20;
                }
            });
            
            doc.save('customers-report.pdf');
            showNotification('ØªÙ… ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡', 'success');
        }

        // ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø§Øª (PDF)
        function exportInspectionsReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFont('helvetica');
            doc.setFontSize(16);
            doc.text('Inspections Report - Wajha', 20, 20);
            
            let yPosition = 40;
            inspections.forEach((inspection, index) => {
                doc.setFontSize(10);
                doc.text(`${index + 1}. ${inspection.customerName} - ${inspection.area} - ${inspection.finalAmount} KD`, 20, yPosition);
                yPosition += 8;
                
                if (yPosition > 280) {
                    doc.addPage();
                    yPosition = 20;
                }
            });
            
            doc.save('inspections-report.pdf');
            showNotification('ØªÙ… ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø§Øª', 'success');
        }

        // ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ (PDF)
        function exportFinancialReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const totalRevenue = inspections.reduce((sum, i) => sum + (parseFloat(i.finalAmount) || 0), 0);
            const approvedInspections = inspections.filter(i => i.approval === 'Ù…ÙˆØ§ÙÙ‚').length;
            
            doc.setFont('helvetica');
            doc.setFontSize(16);
            doc.text('Financial Report - Wajha', 20, 20);
            
            doc.setFontSize(12);
            doc.text(`Total Revenue: ${totalRevenue.toFixed(2)} KD`, 20, 40);
            doc.text(`Approved Inspections: ${approvedInspections}`, 20, 55);
            doc.text(`Total Inspections: ${inspections.length}`, 20, 70);
            
            doc.save('financial-report.pdf');
            showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠ', 'success');
        }

        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg text-white font-semibold transition-all duration-300 transform translate-x-full`;
            
            if (type === 'success') {
                notification.classList.add('bg-green-500');
            } else if (type === 'error') {
                notification.classList.add('bg-red-500');
            } else {
                notification.classList.add('bg-blue-500');
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        function updateUI() {
            document.getElementById('totalCustomers').textContent = customers.length;
            updateDashboard();
            updateCustomersTable();
            updateInspectionsTable();
            updateReports();
        }

        // ÙˆØ¸Ø§Ø¦Ù ÙØ§Ø±ØºØ© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ (ÙŠÙ…ÙƒÙ† ØªØ·ÙˆÙŠØ±Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹)
        function editCustomer(customerId) {
            showNotification('Ù…ÙŠØ²Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', 'info');
        }

        function editInspection(inspectionId) {
            showNotification('Ù…ÙŠØ²Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', 'info');
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        document.getElementById('addCustomerForm').addEventListener('submit', addCustomer);
        document.getElementById('addInspectionForm').addEventListener('submit', addInspection);

        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
        document.getElementById('customerSearch').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const rows = document.querySelectorAll('#customersTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        // ÙÙ„Ø§ØªØ± Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø§Øª
        ['inspectionSearch', 'statusFilter', 'approvalFilter', 'dateFilter'].forEach(filterId => {
            document.getElementById(filterId).addEventListener('input', filterInspections);
        });

        function filterInspections() {
            const searchTerm = document.getElementById('inspectionSearch').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const approvalFilter = document.getElementById('approvalFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;
            
            const rows = document.querySelectorAll('#inspectionsTableBody tr');
            
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                const text = row.textContent.toLowerCase();
                const status = cells[5]?.textContent.trim();
                const approval = cells[6]?.textContent.trim();
                const date = cells[4]?.textContent.trim();
                
                let show = true;
                
                if (searchTerm && !text.includes(searchTerm)) show = false;
                if (statusFilter && status !== statusFilter) show = false;
                if (approvalFilter && approval !== approvalFilter) show = false;
                if (dateFilter && !date.includes(new Date(dateFilter).toLocaleDateString('ar-SA'))) show = false;
                
                row.style.display = show ? '' : 'none';
            });
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98a3db7b843dc68b',t:'MTc1OTc0MDA2Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
